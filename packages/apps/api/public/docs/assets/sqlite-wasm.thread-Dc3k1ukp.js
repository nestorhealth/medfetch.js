var Lp=Object.defineProperty;var Nu=ot=>{throw TypeError(ot)};var Pp=(ot,ct,St)=>ct in ot?Lp(ot,ct,{enumerable:!0,configurable:!0,writable:!0,value:St}):ot[ct]=St;var Zt=(ot,ct,St)=>Pp(ot,typeof ct!="symbol"?ct+"":ct,St),Ll=(ot,ct,St)=>ct.has(ot)||Nu("Cannot "+St);var s=(ot,ct,St)=>(Ll(ot,ct,"read from private field"),St?St.call(ot):ct.get(ot)),z=(ot,ct,St)=>ct.has(ot)?Nu("Cannot add the same private member more than once"):ct instanceof WeakSet?ct.add(ot):ct.set(ot,St),J=(ot,ct,St,lo)=>(Ll(ot,ct,"write to private field"),lo?lo.call(ot,St):ct.set(ot,St),St),be=(ot,ct,St)=>(Ll(ot,ct,"access private method"),St);(function(){"use strict";var Ki,Ai,Mn,Un,Ur,Ws,Qn,Yi,Mo,qu,jn,Qr,Ar,Oi,it,Bs,Or,Ne,Ee,Zi,oo,Se,en,ao,oi,zn,Qo,Vn,tn,rn,ht,Pl,vu,xu,Eu,Nn,oa,Su,Us,Qs,$n,Hn,nn,js,Fl,Tt,Ye,ar,aa,qn,kr,Ii,Ve,li,Jn,Ti,on,an,ue,lr,Dr,Gn,Kn,Nt,Yn,Xn,Zn,es,jr,ts,zr,zs,Wl,ln,rs,Ci,is,ns,ss,$e,Tr,ci,Vs,Cr,pt,Et,nt,Vr,ui,Hs,Ue,vt,He,cr,Qe,Ft,zt,Vt,Go,mt,Wt,dr,fr,Dt,At,as,$r,Hr,di,Rt,Wi,fi,ls,hi,Xs,$t,Au,Ou,Dl,Rl,Bl,Zs,Di,Ko,ku,Ri,hn,Ct,Pr,pn,br,Jr,st,_n,hr,eo,Lt,Fr,Ht,Nr,la,Ml,Ul,mn,Mi,Zo,ds,yn,fs,gn,Ql,Iu;const ot={on:(r,e)=>{r&&e(),e()},info:console.info,error:console.error,warn:console.warn};function ct(r,e,t){const o={};for(const[p,L]of t.migrations){const C=e.vtab.setupModule({methods:{xCreate:0,xConnect:St(e,L,p),xBestIndex:lo(e),xDisconnect:Tu(e),xOpen:Cu(e,r,p),xClose:Lu(e),xNext:Pu(e),xColumn:Fu(e,t.index),xEof:Wu(e),xFilter:Du(e)}});if(!C.pointer)throw new Error(`failed to allocate module for ${p}`);o[p]=C}return o}function St(r,e,t){let o=r;return(...p)=>{let[L,C,ne,le,$]=p,fe=o.capi.SQLITE_OK;return fe+=o.capi.sqlite3_declare_vtab(L,e),fe||(o.vtab.xVtab.create($),ot.info(`medfetch virtual table ${t} xConnect() to ${t} OK`)),fe}}function lo(r){const e=r;return(...t)=>{const[,o]=t,p=e.vtab.xIndexInfo(o);return p.$idxNum=0,p.$estimatedCost=10,p.dispose(),e.capi.SQLITE_OK}}function Tu(r){return(...e)=>{let[t]=e,o=r;return o.vtab.xVtab.unget(t),o.capi.SQLITE_OK}}function Cu(r,e,t){let o=r;return(...p)=>{let[L,C]=p,ne=o.vtab.xCursor.create(C);ne.pVtab=L;const le=e(t).rows,$=[];let fe=0;return ne.page={rows:{next:()=>{if(fe<$.length)return{value:$[fe++],done:!1};const U=le.next();return U.done||($.push(U.value),fe++),U},reset:()=>{fe=0}}},o.capi.SQLITE_OK}}function Lu(r){let e=r;return(...t)=>{let[o]=t;return e.vtab.xCursor.unget(o),e.capi.SQLITE_OK}}function Pu(r){let e=r;return(...t)=>{let[o]=t,p=e.vtab.xCursor.get(o),L=p.page.rows.next();return p.peeked=L,e.capi.SQLITE_OK}}function Fu(r,e){let t=r;return(...o)=>{let[p,L,C]=o,le=t.vtab.xCursor.get(p).peeked;if(le.done||!le.value)return console.error("xColumn called on cursor with empty last peeked resource!"),t.capi.SQLITE_ERROR;const{value:$,dataType:fe}=e(le.value,C);if($===null)t.capi.sqlite3_result_null(L);else switch(fe){case"blob":case"text":{t.capi.sqlite3_result_text(L,$,-1,t.capi.SQLITE_TRANSIENT);break}case"integer":{t.capi.sqlite3_result_int(L,$);break}case"boolean":{const U=+!!$;t.capi.sqlite3_result_int(L,U);break}}return t.capi.SQLITE_OK}}function Wu(r){return(...e)=>{let[t]=e;const o=r.vtab.xCursor.get(t);if(o.peeked.done||!o.peeked.value){const p=o.page.next;if(!p)return 1;o.page=p,o.peeked=o.page.rows.next()}return r.capi.SQLITE_OK}}function Du(r){let e=r,{capi:t,vtab:o}=e;return(...p)=>{const[L,C,ne]=p,le=o.xCursor.get(L);return le?(le.peeked=le.page.rows.next(),le.peeked.done&&(le.page.rows.reset(),le.peeked=le.page.rows.next()),t.SQLITE_OK):t.SQLITE_ERROR}}function Ru(r,e){r.initWorker1API();const t=self.onmessage,o=p=>t==null?void 0:t.call(self,p);return self.onmessage=p=>{const L=()=>o(p);e?e(p,L):L()},0}var ca=(()=>{var r=self.location.href;return function(e={}){var t,o=e,p,L,C=new Promise((i,n)=>{p=i,L=n}),ne=typeof window=="object",le=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";const $=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,$.debugModule("globalThis.location =",globalThis.location);var fe=Object.assign({},o),U="./this.program",he="";function qe(i){return o.locateFile?o.locateFile(i,he):he+i}var Be,Me;(ne||le)&&(le?he=self.location.href:typeof document<"u"&&document.currentScript&&(he=document.currentScript.src),r&&(he=r),he.startsWith("blob:")?he="":he=he.substr(0,he.replace(/[?#].*/,"").lastIndexOf("/")+1),le&&(Me=i=>{var n=new XMLHttpRequest;return n.open("GET",i,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),Be=i=>fetch(i,{credentials:"same-origin"}).then(n=>n.ok?n.arrayBuffer():Promise.reject(new Error(n.status+" : "+n.url))));var Oe=o.print||console.log.bind(console),yt=o.printErr||console.error.bind(console);Object.assign(o,fe),fe=null,o.arguments&&o.arguments,o.thisProgram&&(U=o.thisProgram);var wt=o.wasmBinary,_t,qr=!1,Le,pr,Yt,De,V,S;function ge(){var i=_t.buffer;o.HEAP8=Le=new Int8Array(i),o.HEAP16=Yt=new Int16Array(i),o.HEAPU8=pr=new Uint8Array(i),o.HEAPU16=new Uint16Array(i),o.HEAP32=De=new Int32Array(i),o.HEAPU32=V=new Uint32Array(i),o.HEAPF32=new Float32Array(i),o.HEAPF64=new Float64Array(i),o.HEAP64=S=new BigInt64Array(i),o.HEAPU64=new BigUint64Array(i)}if(o.wasmMemory)_t=o.wasmMemory;else{var se=o.INITIAL_MEMORY||16777216;_t=new WebAssembly.Memory({initial:se/65536,maximum:32768})}ge();var Ot=[],Xt=[],Mt=[];function Ut(){var i=o.preRun;i&&(typeof i=="function"&&(i=[i]),i.forEach(Gr)),Al(Ot)}function _r(){!o.noFSInit&&!h.initialized&&h.init(),h.ignorePermissions=!1,Al(Xt)}function Ui(){var i=o.postRun;i&&(typeof i=="function"&&(i=[i]),i.forEach(xl)),Al(Mt)}function Gr(i){Ot.unshift(i)}function vl(i){Xt.unshift(i)}function xl(i){Mt.unshift(i)}var Wr=0,vr=null;function El(i){return i}function _i(i){var n;Wr++,(n=o.monitorRunDependencies)==null||n.call(o,Wr)}function Qi(i){var a;if(Wr--,(a=o.monitorRunDependencies)==null||a.call(o,Wr),Wr==0&&vr){var n=vr;vr=null,n()}}function wn(i){var a;(a=o.onAbort)==null||a.call(o,i),i="Aborted("+i+")",yt(i),qr=!0,i+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(i);throw L(n),n}var ea="data:application/octet-stream;base64,",ro=i=>i.startsWith(ea);function Sl(){if(o.locateFile){var i="sqlite3.wasm";return ro(i)?i:qe(i)}return new URL("/docs/assets/sqlite3-WT1HU0S9.wasm",self.location.href).href}var hs;function io(i){if(i==hs&&wt)return new Uint8Array(wt);if(Me)return Me(i);throw"both async and sync fetching of the wasm failed"}function ta(i){return wt?Promise.resolve().then(()=>io(i)):Be(i).then(n=>new Uint8Array(n),()=>io(i))}function cu(i,n,a){return ta(i).then(l=>WebAssembly.instantiate(l,n)).then(a,l=>{yt(`failed to asynchronously prepare wasm: ${l}`),wn(l)})}function xh(i,n,a,l){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!ro(n)&&typeof fetch=="function"?fetch(n,{credentials:"same-origin"}).then(c=>{var u=WebAssembly.instantiateStreaming(c,a);return u.then(l,function(w){return yt(`wasm streaming compile failed: ${w}`),yt("falling back to ArrayBuffer instantiation"),cu(n,a,l)})}):cu(n,a,l)}function Eh(){return{env:mu,wasi_snapshot_preview1:mu}}function Sh(){var i=Eh();function n(l,c){return N=l.exports,vl(N.__wasm_call_ctors),Qi(),N}_i();function a(l){n(l.instance)}if(o.instantiateWasm)try{return o.instantiateWasm(i,n)}catch(l){yt(`Module.instantiateWasm callback failed with error: ${l}`),L(l)}return hs??(hs=Sl()),xh(wt,hs,i,a).catch(L),{}}var Al=i=>{i.forEach(n=>n(o))};o.noExitRuntime;var Ze={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return n.exec(i).slice(1)},normalizeArray:(i,n)=>{for(var a=0,l=i.length-1;l>=0;l--){var c=i[l];c==="."?i.splice(l,1):c===".."?(i.splice(l,1),a++):a&&(i.splice(l,1),a--)}if(n)for(;a;a--)i.unshift("..");return i},normalize:i=>{var n=Ze.isAbs(i),a=i.substr(-1)==="/";return i=Ze.normalizeArray(i.split("/").filter(l=>!!l),!n).join("/"),!i&&!n&&(i="."),i&&a&&(i+="/"),(n?"/":"")+i},dirname:i=>{var n=Ze.splitPath(i),a=n[0],l=n[1];return!a&&!l?".":(l&&(l=l.substr(0,l.length-1)),a+l)},basename:i=>{if(i==="/")return"/";i=Ze.normalize(i),i=i.replace(/\/$/,"");var n=i.lastIndexOf("/");return n===-1?i:i.substr(n+1)},join:(...i)=>Ze.normalize(i.join("/")),join2:(i,n)=>Ze.normalize(i+"/"+n)},Ah=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);wn("initRandomDevice")},uu=i=>(uu=Ah())(i),mi={resolve:(...i)=>{for(var n="",a=!1,l=i.length-1;l>=-1&&!a;l--){var c=l>=0?i[l]:h.cwd();if(typeof c!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!c)return"";n=c+"/"+n,a=Ze.isAbs(c)}return n=Ze.normalizeArray(n.split("/").filter(u=>!!u),!a).join("/"),(a?"/":"")+n||"."},relative:(i,n)=>{i=mi.resolve(i).substr(1),n=mi.resolve(n).substr(1);function a(H){for(var oe=0;oe<H.length&&H[oe]==="";oe++);for(var ce=H.length-1;ce>=0&&H[ce]==="";ce--);return oe>ce?[]:H.slice(oe,ce-oe+1)}for(var l=a(i.split("/")),c=a(n.split("/")),u=Math.min(l.length,c.length),w=u,E=0;E<u;E++)if(l[E]!==c[E]){w=E;break}for(var j=[],E=w;E<l.length;E++)j.push("..");return j=j.concat(c.slice(w)),j.join("/")}},du=typeof TextDecoder<"u"?new TextDecoder:void 0,ps=(i,n=0,a=NaN)=>{for(var l=n+a,c=n;i[c]&&!(c>=l);)++c;if(c-n>16&&i.buffer&&du)return du.decode(i.subarray(n,c));for(var u="";n<c;){var w=i[n++];if(!(w&128)){u+=String.fromCharCode(w);continue}var E=i[n++]&63;if((w&224)==192){u+=String.fromCharCode((w&31)<<6|E);continue}var j=i[n++]&63;if((w&240)==224?w=(w&15)<<12|E<<6|j:w=(w&7)<<18|E<<12|j<<6|i[n++]&63,w<65536)u+=String.fromCharCode(w);else{var H=w-65536;u+=String.fromCharCode(55296|H>>10,56320|H&1023)}}return u},Ol=[],ra=i=>{for(var n=0,a=0;a<i.length;++a){var l=i.charCodeAt(a);l<=127?n++:l<=2047?n+=2:l>=55296&&l<=57343?(n+=4,++a):n+=3}return n},kl=(i,n,a,l)=>{if(!(l>0))return 0;for(var c=a,u=a+l-1,w=0;w<i.length;++w){var E=i.charCodeAt(w);if(E>=55296&&E<=57343){var j=i.charCodeAt(++w);E=65536+((E&1023)<<10)|j&1023}if(E<=127){if(a>=u)break;n[a++]=E}else if(E<=2047){if(a+1>=u)break;n[a++]=192|E>>6,n[a++]=128|E&63}else if(E<=65535){if(a+2>=u)break;n[a++]=224|E>>12,n[a++]=128|E>>6&63,n[a++]=128|E&63}else{if(a+3>=u)break;n[a++]=240|E>>18,n[a++]=128|E>>12&63,n[a++]=128|E>>6&63,n[a++]=128|E&63}}return n[a]=0,a-c};function fu(i,n,a){var l=ra(i)+1,c=new Array(l),u=kl(i,c,0,c.length);return c.length=u,c}var Oh=()=>{if(!Ol.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`)),!i)return null;Ol=fu(i)}return Ol.shift()},bn={ttys:[],init(){},shutdown(){},register(i,n){bn.ttys[i]={input:[],output:[],ops:n},h.registerDevice(i,bn.stream_ops)},stream_ops:{open(i){var n=bn.ttys[i.node.rdev];if(!n)throw new h.ErrnoError(43);i.tty=n,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,n,a,l,c){if(!i.tty||!i.tty.ops.get_char)throw new h.ErrnoError(60);for(var u=0,w=0;w<l;w++){var E;try{E=i.tty.ops.get_char(i.tty)}catch{throw new h.ErrnoError(29)}if(E===void 0&&u===0)throw new h.ErrnoError(6);if(E==null)break;u++,n[a+w]=E}return u&&(i.node.timestamp=Date.now()),u},write(i,n,a,l,c){if(!i.tty||!i.tty.ops.put_char)throw new h.ErrnoError(60);try{for(var u=0;u<l;u++)i.tty.ops.put_char(i.tty,n[a+u])}catch{throw new h.ErrnoError(29)}return l&&(i.node.timestamp=Date.now()),u}},default_tty_ops:{get_char(i){return Oh()},put_char(i,n){n===null||n===10?(Oe(ps(i.output)),i.output=[]):n!=0&&i.output.push(n)},fsync(i){i.output&&i.output.length>0&&(Oe(ps(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,n,a){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,n){n===null||n===10?(yt(ps(i.output)),i.output=[]):n!=0&&i.output.push(n)},fsync(i){i.output&&i.output.length>0&&(yt(ps(i.output)),i.output=[])}}},kh=(i,n)=>{pr.fill(0,i,i+n)},hu=(i,n)=>Math.ceil(i/n)*n,pu=i=>{i=hu(i,65536);var n=yu(65536,i);return n&&kh(n,i),n},Ce={ops_table:null,mount(i){return Ce.createNode(null,"/",16895,0)},createNode(i,n,a,l){if(h.isBlkdev(a)||h.isFIFO(a))throw new h.ErrnoError(63);Ce.ops_table||(Ce.ops_table={dir:{node:{getattr:Ce.node_ops.getattr,setattr:Ce.node_ops.setattr,lookup:Ce.node_ops.lookup,mknod:Ce.node_ops.mknod,rename:Ce.node_ops.rename,unlink:Ce.node_ops.unlink,rmdir:Ce.node_ops.rmdir,readdir:Ce.node_ops.readdir,symlink:Ce.node_ops.symlink},stream:{llseek:Ce.stream_ops.llseek}},file:{node:{getattr:Ce.node_ops.getattr,setattr:Ce.node_ops.setattr},stream:{llseek:Ce.stream_ops.llseek,read:Ce.stream_ops.read,write:Ce.stream_ops.write,allocate:Ce.stream_ops.allocate,mmap:Ce.stream_ops.mmap,msync:Ce.stream_ops.msync}},link:{node:{getattr:Ce.node_ops.getattr,setattr:Ce.node_ops.setattr,readlink:Ce.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ce.node_ops.getattr,setattr:Ce.node_ops.setattr},stream:h.chrdev_stream_ops}});var c=h.createNode(i,n,a,l);return h.isDir(c.mode)?(c.node_ops=Ce.ops_table.dir.node,c.stream_ops=Ce.ops_table.dir.stream,c.contents={}):h.isFile(c.mode)?(c.node_ops=Ce.ops_table.file.node,c.stream_ops=Ce.ops_table.file.stream,c.usedBytes=0,c.contents=null):h.isLink(c.mode)?(c.node_ops=Ce.ops_table.link.node,c.stream_ops=Ce.ops_table.link.stream):h.isChrdev(c.mode)&&(c.node_ops=Ce.ops_table.chrdev.node,c.stream_ops=Ce.ops_table.chrdev.stream),c.timestamp=Date.now(),i&&(i.contents[n]=c,i.timestamp=c.timestamp),c},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,n){var a=i.contents?i.contents.length:0;if(!(a>=n)){var l=1024*1024;n=Math.max(n,a*(a<l?2:1.125)>>>0),a!=0&&(n=Math.max(n,256));var c=i.contents;i.contents=new Uint8Array(n),i.usedBytes>0&&i.contents.set(c.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,n){if(i.usedBytes!=n)if(n==0)i.contents=null,i.usedBytes=0;else{var a=i.contents;i.contents=new Uint8Array(n),a&&i.contents.set(a.subarray(0,Math.min(n,i.usedBytes))),i.usedBytes=n}},node_ops:{getattr(i){var n={};return n.dev=h.isChrdev(i.mode)?i.id:1,n.ino=i.id,n.mode=i.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=i.rdev,h.isDir(i.mode)?n.size=4096:h.isFile(i.mode)?n.size=i.usedBytes:h.isLink(i.mode)?n.size=i.link.length:n.size=0,n.atime=new Date(i.timestamp),n.mtime=new Date(i.timestamp),n.ctime=new Date(i.timestamp),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},setattr(i,n){n.mode!==void 0&&(i.mode=n.mode),n.timestamp!==void 0&&(i.timestamp=n.timestamp),n.size!==void 0&&Ce.resizeFileStorage(i,n.size)},lookup(i,n){throw h.genericErrors[44]},mknod(i,n,a,l){return Ce.createNode(i,n,a,l)},rename(i,n,a){if(h.isDir(i.mode)){var l;try{l=h.lookupNode(n,a)}catch{}if(l)for(var c in l.contents)throw new h.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=a,n.contents[a]=i,n.timestamp=i.parent.timestamp},unlink(i,n){delete i.contents[n],i.timestamp=Date.now()},rmdir(i,n){var a=h.lookupNode(i,n);for(var l in a.contents)throw new h.ErrnoError(55);delete i.contents[n],i.timestamp=Date.now()},readdir(i){var n=[".",".."];for(var a of Object.keys(i.contents))n.push(a);return n},symlink(i,n,a){var l=Ce.createNode(i,n,41471,0);return l.link=a,l},readlink(i){if(!h.isLink(i.mode))throw new h.ErrnoError(28);return i.link}},stream_ops:{read(i,n,a,l,c){var u=i.node.contents;if(c>=i.node.usedBytes)return 0;var w=Math.min(i.node.usedBytes-c,l);if(w>8&&u.subarray)n.set(u.subarray(c,c+w),a);else for(var E=0;E<w;E++)n[a+E]=u[c+E];return w},write(i,n,a,l,c,u){if(n.buffer===Le.buffer&&(u=!1),!l)return 0;var w=i.node;if(w.timestamp=Date.now(),n.subarray&&(!w.contents||w.contents.subarray)){if(u)return w.contents=n.subarray(a,a+l),w.usedBytes=l,l;if(w.usedBytes===0&&c===0)return w.contents=n.slice(a,a+l),w.usedBytes=l,l;if(c+l<=w.usedBytes)return w.contents.set(n.subarray(a,a+l),c),l}if(Ce.expandFileStorage(w,c+l),w.contents.subarray&&n.subarray)w.contents.set(n.subarray(a,a+l),c);else for(var E=0;E<l;E++)w.contents[c+E]=n[a+E];return w.usedBytes=Math.max(w.usedBytes,c+l),l},llseek(i,n,a){var l=n;if(a===1?l+=i.position:a===2&&h.isFile(i.node.mode)&&(l+=i.node.usedBytes),l<0)throw new h.ErrnoError(28);return l},allocate(i,n,a){Ce.expandFileStorage(i.node,n+a),i.node.usedBytes=Math.max(i.node.usedBytes,n+a)},mmap(i,n,a,l,c){if(!h.isFile(i.node.mode))throw new h.ErrnoError(43);var u,w,E=i.node.contents;if(!(c&2)&&E&&E.buffer===Le.buffer)w=!1,u=E.byteOffset;else{if(w=!0,u=pu(n),!u)throw new h.ErrnoError(48);E&&((a>0||a+n<E.length)&&(E.subarray?E=E.subarray(a,a+n):E=Array.prototype.slice.call(E,a,a+n)),Le.set(E,u))}return{ptr:u,allocated:w}},msync(i,n,a,l,c){return Ce.stream_ops.write(i,n,0,l,a,!1),0}}},Ih=(i,n,a,l)=>{var c=`al ${i}`;Be(i).then(u=>{n(new Uint8Array(u)),c&&Qi()},u=>{if(a)a();else throw`Loading data file "${i}" failed.`}),c&&_i()},Th=(i,n,a,l,c,u)=>{h.createDataFile(i,n,a,l,c,u)},Ch=o.preloadPlugins||[],Lh=(i,n,a,l)=>{typeof Browser<"u"&&Browser.init();var c=!1;return Ch.forEach(u=>{c||u.canHandle(n)&&(u.handle(i,n,a,l),c=!0)}),c},Ph=(i,n,a,l,c,u,w,E,j,H)=>{var oe=n?mi.resolve(Ze.join2(i,n)):i;function ce(Q){function W(Y){H==null||H(),E||Th(i,n,Y,l,c,j),u==null||u(),Qi()}Lh(Q,oe,W,()=>{w==null||w(),Qi()})||W(Q)}_i(),typeof a=="string"?Ih(a,ce,w):ce(a)},Fh=i=>{var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=n[i];if(typeof a>"u")throw new Error(`Unknown file open mode: ${i}`);return a},Il=(i,n)=>{var a=0;return i&&(a|=365),n&&(a|=146),a},h={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(i){this.name="ErrnoError",this.errno=i}},genericErrors:{},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){this.shared={}}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,n,a,l){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=h.nextInode++,this.name=n,this.mode=a,this.node_ops={},this.stream_ops={},this.rdev=l,this.readMode=365,this.writeMode=146}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return h.isDir(this.mode)}get isDevice(){return h.isChrdev(this.mode)}},lookupPath(i,n={}){if(i=mi.resolve(i),!i)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(n=Object.assign(a,n),n.recurse_count>8)throw new h.ErrnoError(32);for(var l=i.split("/").filter(ce=>!!ce),c=h.root,u="/",w=0;w<l.length;w++){var E=w===l.length-1;if(E&&n.parent)break;if(c=h.lookupNode(c,l[w]),u=Ze.join2(u,l[w]),h.isMountpoint(c)&&(!E||E&&n.follow_mount)&&(c=c.mounted.root),!E||n.follow)for(var j=0;h.isLink(c.mode);){var H=h.readlink(u);u=mi.resolve(Ze.dirname(u),H);var oe=h.lookupPath(u,{recurse_count:n.recurse_count+1});if(c=oe.node,j++>40)throw new h.ErrnoError(32)}}return{path:u,node:c}},getPath(i){for(var n;;){if(h.isRoot(i)){var a=i.mount.mountpoint;return n?a[a.length-1]!=="/"?`${a}/${n}`:a+n:a}n=n?`${i.name}/${n}`:i.name,i=i.parent}},hashName(i,n){for(var a=0,l=0;l<n.length;l++)a=(a<<5)-a+n.charCodeAt(l)|0;return(i+a>>>0)%h.nameTable.length},hashAddNode(i){var n=h.hashName(i.parent.id,i.name);i.name_next=h.nameTable[n],h.nameTable[n]=i},hashRemoveNode(i){var n=h.hashName(i.parent.id,i.name);if(h.nameTable[n]===i)h.nameTable[n]=i.name_next;else for(var a=h.nameTable[n];a;){if(a.name_next===i){a.name_next=i.name_next;break}a=a.name_next}},lookupNode(i,n){var a=h.mayLookup(i);if(a)throw new h.ErrnoError(a);for(var l=h.hashName(i.id,n),c=h.nameTable[l];c;c=c.name_next){var u=c.name;if(c.parent.id===i.id&&u===n)return c}return h.lookup(i,n)},createNode(i,n,a,l){var c=new h.FSNode(i,n,a,l);return h.hashAddNode(c),c},destroyNode(i){h.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var n=["r","w","rw"][i&3];return i&512&&(n+="w"),n},nodePermissions(i,n){return h.ignorePermissions?0:n.includes("r")&&!(i.mode&292)||n.includes("w")&&!(i.mode&146)||n.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!h.isDir(i.mode))return 54;var n=h.nodePermissions(i,"x");return n||(i.node_ops.lookup?0:2)},mayCreate(i,n){try{var a=h.lookupNode(i,n);return 20}catch{}return h.nodePermissions(i,"wx")},mayDelete(i,n,a){var l;try{l=h.lookupNode(i,n)}catch(u){return u.errno}var c=h.nodePermissions(i,"wx");if(c)return c;if(a){if(!h.isDir(l.mode))return 54;if(h.isRoot(l)||h.getPath(l)===h.cwd())return 10}else if(h.isDir(l.mode))return 31;return 0},mayOpen(i,n){return i?h.isLink(i.mode)?32:h.isDir(i.mode)&&(h.flagsToPermissionString(n)!=="r"||n&512)?31:h.nodePermissions(i,h.flagsToPermissionString(n)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=h.MAX_OPEN_FDS;i++)if(!h.streams[i])return i;throw new h.ErrnoError(33)},getStreamChecked(i){var n=h.getStream(i);if(!n)throw new h.ErrnoError(8);return n},getStream:i=>h.streams[i],createStream(i,n=-1){return i=Object.assign(new h.FSStream,i),n==-1&&(n=h.nextfd()),i.fd=n,h.streams[n]=i,i},closeStream(i){h.streams[i]=null},dupStream(i,n=-1){var l,c;var a=h.createStream(i,n);return(c=(l=a.stream_ops)==null?void 0:l.dup)==null||c.call(l,a),a},chrdev_stream_ops:{open(i){var a,l;var n=h.getDevice(i.node.rdev);i.stream_ops=n.stream_ops,(l=(a=i.stream_ops).open)==null||l.call(a,i)},llseek(){throw new h.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,n)=>i<<8|n,registerDevice(i,n){h.devices[i]={stream_ops:n}},getDevice:i=>h.devices[i],getMounts(i){for(var n=[],a=[i];a.length;){var l=a.pop();n.push(l),a.push(...l.mounts)}return n},syncfs(i,n){typeof i=="function"&&(n=i,i=!1),h.syncFSRequests++,h.syncFSRequests>1&&yt(`warning: ${h.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=h.getMounts(h.root.mount),l=0;function c(w){return h.syncFSRequests--,n(w)}function u(w){if(w)return u.errored?void 0:(u.errored=!0,c(w));++l>=a.length&&c(null)}a.forEach(w=>{if(!w.type.syncfs)return u(null);w.type.syncfs(w,i,u)})},mount(i,n,a){var l=a==="/",c=!a,u;if(l&&h.root)throw new h.ErrnoError(10);if(!l&&!c){var w=h.lookupPath(a,{follow_mount:!1});if(a=w.path,u=w.node,h.isMountpoint(u))throw new h.ErrnoError(10);if(!h.isDir(u.mode))throw new h.ErrnoError(54)}var E={type:i,opts:n,mountpoint:a,mounts:[]},j=i.mount(E);return j.mount=E,E.root=j,l?h.root=j:u&&(u.mounted=E,u.mount&&u.mount.mounts.push(E)),j},unmount(i){var n=h.lookupPath(i,{follow_mount:!1});if(!h.isMountpoint(n.node))throw new h.ErrnoError(28);var a=n.node,l=a.mounted,c=h.getMounts(l);Object.keys(h.nameTable).forEach(w=>{for(var E=h.nameTable[w];E;){var j=E.name_next;c.includes(E.mount)&&h.destroyNode(E),E=j}}),a.mounted=null;var u=a.mount.mounts.indexOf(l);a.mount.mounts.splice(u,1)},lookup(i,n){return i.node_ops.lookup(i,n)},mknod(i,n,a){var l=h.lookupPath(i,{parent:!0}),c=l.node,u=Ze.basename(i);if(!u||u==="."||u==="..")throw new h.ErrnoError(28);var w=h.mayCreate(c,u);if(w)throw new h.ErrnoError(w);if(!c.node_ops.mknod)throw new h.ErrnoError(63);return c.node_ops.mknod(c,u,n,a)},create(i,n){return n=n!==void 0?n:438,n&=4095,n|=32768,h.mknod(i,n,0)},mkdir(i,n){return n=n!==void 0?n:511,n&=1023,n|=16384,h.mknod(i,n,0)},mkdirTree(i,n){for(var a=i.split("/"),l="",c=0;c<a.length;++c)if(a[c]){l+="/"+a[c];try{h.mkdir(l,n)}catch(u){if(u.errno!=20)throw u}}},mkdev(i,n,a){return typeof a>"u"&&(a=n,n=438),n|=8192,h.mknod(i,n,a)},symlink(i,n){if(!mi.resolve(i))throw new h.ErrnoError(44);var a=h.lookupPath(n,{parent:!0}),l=a.node;if(!l)throw new h.ErrnoError(44);var c=Ze.basename(n),u=h.mayCreate(l,c);if(u)throw new h.ErrnoError(u);if(!l.node_ops.symlink)throw new h.ErrnoError(63);return l.node_ops.symlink(l,c,i)},rename(i,n){var a=Ze.dirname(i),l=Ze.dirname(n),c=Ze.basename(i),u=Ze.basename(n),w,E,j;if(w=h.lookupPath(i,{parent:!0}),E=w.node,w=h.lookupPath(n,{parent:!0}),j=w.node,!E||!j)throw new h.ErrnoError(44);if(E.mount!==j.mount)throw new h.ErrnoError(75);var H=h.lookupNode(E,c),oe=mi.relative(i,l);if(oe.charAt(0)!==".")throw new h.ErrnoError(28);if(oe=mi.relative(n,a),oe.charAt(0)!==".")throw new h.ErrnoError(55);var ce;try{ce=h.lookupNode(j,u)}catch{}if(H!==ce){var Q=h.isDir(H.mode),W=h.mayDelete(E,c,Q);if(W)throw new h.ErrnoError(W);if(W=ce?h.mayDelete(j,u,Q):h.mayCreate(j,u),W)throw new h.ErrnoError(W);if(!E.node_ops.rename)throw new h.ErrnoError(63);if(h.isMountpoint(H)||ce&&h.isMountpoint(ce))throw new h.ErrnoError(10);if(j!==E&&(W=h.nodePermissions(E,"w"),W))throw new h.ErrnoError(W);h.hashRemoveNode(H);try{E.node_ops.rename(H,j,u),H.parent=j}catch(Y){throw Y}finally{h.hashAddNode(H)}}},rmdir(i){var n=h.lookupPath(i,{parent:!0}),a=n.node,l=Ze.basename(i),c=h.lookupNode(a,l),u=h.mayDelete(a,l,!0);if(u)throw new h.ErrnoError(u);if(!a.node_ops.rmdir)throw new h.ErrnoError(63);if(h.isMountpoint(c))throw new h.ErrnoError(10);a.node_ops.rmdir(a,l),h.destroyNode(c)},readdir(i){var n=h.lookupPath(i,{follow:!0}),a=n.node;if(!a.node_ops.readdir)throw new h.ErrnoError(54);return a.node_ops.readdir(a)},unlink(i){var n=h.lookupPath(i,{parent:!0}),a=n.node;if(!a)throw new h.ErrnoError(44);var l=Ze.basename(i),c=h.lookupNode(a,l),u=h.mayDelete(a,l,!1);if(u)throw new h.ErrnoError(u);if(!a.node_ops.unlink)throw new h.ErrnoError(63);if(h.isMountpoint(c))throw new h.ErrnoError(10);a.node_ops.unlink(a,l),h.destroyNode(c)},readlink(i){var n=h.lookupPath(i),a=n.node;if(!a)throw new h.ErrnoError(44);if(!a.node_ops.readlink)throw new h.ErrnoError(28);return mi.resolve(h.getPath(a.parent),a.node_ops.readlink(a))},stat(i,n){var a=h.lookupPath(i,{follow:!n}),l=a.node;if(!l)throw new h.ErrnoError(44);if(!l.node_ops.getattr)throw new h.ErrnoError(63);return l.node_ops.getattr(l)},lstat(i){return h.stat(i,!0)},chmod(i,n,a){var l;if(typeof i=="string"){var c=h.lookupPath(i,{follow:!a});l=c.node}else l=i;if(!l.node_ops.setattr)throw new h.ErrnoError(63);l.node_ops.setattr(l,{mode:n&4095|l.mode&-4096,timestamp:Date.now()})},lchmod(i,n){h.chmod(i,n,!0)},fchmod(i,n){var a=h.getStreamChecked(i);h.chmod(a.node,n)},chown(i,n,a,l){var c;if(typeof i=="string"){var u=h.lookupPath(i,{follow:!l});c=u.node}else c=i;if(!c.node_ops.setattr)throw new h.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown(i,n,a){h.chown(i,n,a,!0)},fchown(i,n,a){var l=h.getStreamChecked(i);h.chown(l.node,n,a)},truncate(i,n){if(n<0)throw new h.ErrnoError(28);var a;if(typeof i=="string"){var l=h.lookupPath(i,{follow:!0});a=l.node}else a=i;if(!a.node_ops.setattr)throw new h.ErrnoError(63);if(h.isDir(a.mode))throw new h.ErrnoError(31);if(!h.isFile(a.mode))throw new h.ErrnoError(28);var c=h.nodePermissions(a,"w");if(c)throw new h.ErrnoError(c);a.node_ops.setattr(a,{size:n,timestamp:Date.now()})},ftruncate(i,n){var a=h.getStreamChecked(i);if(!(a.flags&2097155))throw new h.ErrnoError(28);h.truncate(a.node,n)},utime(i,n,a){var l=h.lookupPath(i,{follow:!0}),c=l.node;c.node_ops.setattr(c,{timestamp:Math.max(n,a)})},open(i,n,a){if(i==="")throw new h.ErrnoError(44);n=typeof n=="string"?Fh(n):n,n&64?(a=typeof a>"u"?438:a,a=a&4095|32768):a=0;var l;if(typeof i=="object")l=i;else{i=Ze.normalize(i);try{var c=h.lookupPath(i,{follow:!(n&131072)});l=c.node}catch{}}var u=!1;if(n&64)if(l){if(n&128)throw new h.ErrnoError(20)}else l=h.mknod(i,a,0),u=!0;if(!l)throw new h.ErrnoError(44);if(h.isChrdev(l.mode)&&(n&=-513),n&65536&&!h.isDir(l.mode))throw new h.ErrnoError(54);if(!u){var w=h.mayOpen(l,n);if(w)throw new h.ErrnoError(w)}n&512&&!u&&h.truncate(l,0),n&=-131713;var E=h.createStream({node:l,path:h.getPath(l),flags:n,seekable:!0,position:0,stream_ops:l.stream_ops,ungotten:[],error:!1});return E.stream_ops.open&&E.stream_ops.open(E),o.logReadFiles&&!(n&1)&&(i in h.readFiles||(h.readFiles[i]=1)),E},close(i){if(h.isClosed(i))throw new h.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(n){throw n}finally{h.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,n,a){if(h.isClosed(i))throw new h.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new h.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new h.ErrnoError(28);return i.position=i.stream_ops.llseek(i,n,a),i.ungotten=[],i.position},read(i,n,a,l,c){if(l<0||c<0)throw new h.ErrnoError(28);if(h.isClosed(i))throw new h.ErrnoError(8);if((i.flags&2097155)===1)throw new h.ErrnoError(8);if(h.isDir(i.node.mode))throw new h.ErrnoError(31);if(!i.stream_ops.read)throw new h.ErrnoError(28);var u=typeof c<"u";if(!u)c=i.position;else if(!i.seekable)throw new h.ErrnoError(70);var w=i.stream_ops.read(i,n,a,l,c);return u||(i.position+=w),w},write(i,n,a,l,c,u){if(l<0||c<0)throw new h.ErrnoError(28);if(h.isClosed(i))throw new h.ErrnoError(8);if(!(i.flags&2097155))throw new h.ErrnoError(8);if(h.isDir(i.node.mode))throw new h.ErrnoError(31);if(!i.stream_ops.write)throw new h.ErrnoError(28);i.seekable&&i.flags&1024&&h.llseek(i,0,2);var w=typeof c<"u";if(!w)c=i.position;else if(!i.seekable)throw new h.ErrnoError(70);var E=i.stream_ops.write(i,n,a,l,c,u);return w||(i.position+=E),E},allocate(i,n,a){if(h.isClosed(i))throw new h.ErrnoError(8);if(n<0||a<=0)throw new h.ErrnoError(28);if(!(i.flags&2097155))throw new h.ErrnoError(8);if(!h.isFile(i.node.mode)&&!h.isDir(i.node.mode))throw new h.ErrnoError(43);if(!i.stream_ops.allocate)throw new h.ErrnoError(138);i.stream_ops.allocate(i,n,a)},mmap(i,n,a,l,c){if(l&2&&!(c&2)&&(i.flags&2097155)!==2)throw new h.ErrnoError(2);if((i.flags&2097155)===1)throw new h.ErrnoError(2);if(!i.stream_ops.mmap)throw new h.ErrnoError(43);if(!n)throw new h.ErrnoError(28);return i.stream_ops.mmap(i,n,a,l,c)},msync(i,n,a,l,c){return i.stream_ops.msync?i.stream_ops.msync(i,n,a,l,c):0},ioctl(i,n,a){if(!i.stream_ops.ioctl)throw new h.ErrnoError(59);return i.stream_ops.ioctl(i,n,a)},readFile(i,n={}){if(n.flags=n.flags||0,n.encoding=n.encoding||"binary",n.encoding!=="utf8"&&n.encoding!=="binary")throw new Error(`Invalid encoding type "${n.encoding}"`);var a,l=h.open(i,n.flags),c=h.stat(i),u=c.size,w=new Uint8Array(u);return h.read(l,w,0,u,0),n.encoding==="utf8"?a=ps(w):n.encoding==="binary"&&(a=w),h.close(l),a},writeFile(i,n,a={}){a.flags=a.flags||577;var l=h.open(i,a.flags,a.mode);if(typeof n=="string"){var c=new Uint8Array(ra(n)+1),u=kl(n,c,0,c.length);h.write(l,c,0,u,void 0,a.canOwn)}else if(ArrayBuffer.isView(n))h.write(l,n,0,n.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");h.close(l)},cwd:()=>h.currentPath,chdir(i){var n=h.lookupPath(i,{follow:!0});if(n.node===null)throw new h.ErrnoError(44);if(!h.isDir(n.node.mode))throw new h.ErrnoError(54);var a=h.nodePermissions(n.node,"x");if(a)throw new h.ErrnoError(a);h.currentPath=n.path},createDefaultDirectories(){h.mkdir("/tmp"),h.mkdir("/home"),h.mkdir("/home/web_user")},createDefaultDevices(){h.mkdir("/dev"),h.registerDevice(h.makedev(1,3),{read:()=>0,write:(l,c,u,w,E)=>w}),h.mkdev("/dev/null",h.makedev(1,3)),bn.register(h.makedev(5,0),bn.default_tty_ops),bn.register(h.makedev(6,0),bn.default_tty1_ops),h.mkdev("/dev/tty",h.makedev(5,0)),h.mkdev("/dev/tty1",h.makedev(6,0));var i=new Uint8Array(1024),n=0,a=()=>(n===0&&(n=uu(i).byteLength),i[--n]);h.createDevice("/dev","random",a),h.createDevice("/dev","urandom",a),h.mkdir("/dev/shm"),h.mkdir("/dev/shm/tmp")},createSpecialDirectories(){h.mkdir("/proc");var i=h.mkdir("/proc/self");h.mkdir("/proc/self/fd"),h.mount({mount(){var n=h.createNode(i,"fd",16895,73);return n.node_ops={lookup(a,l){var c=+l,u=h.getStreamChecked(c),w={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>u.path}};return w.parent=w,w}},n}},{},"/proc/self/fd")},createStandardStreams(i,n,a){i?h.createDevice("/dev","stdin",i):h.symlink("/dev/tty","/dev/stdin"),n?h.createDevice("/dev","stdout",null,n):h.symlink("/dev/tty","/dev/stdout"),a?h.createDevice("/dev","stderr",null,a):h.symlink("/dev/tty1","/dev/stderr"),h.open("/dev/stdin",0),h.open("/dev/stdout",1),h.open("/dev/stderr",1)},staticInit(){[44].forEach(i=>{h.genericErrors[i]=new h.ErrnoError(i),h.genericErrors[i].stack="<generic error, no stack>"}),h.nameTable=new Array(4096),h.mount(Ce,{},"/"),h.createDefaultDirectories(),h.createDefaultDevices(),h.createSpecialDirectories(),h.filesystems={MEMFS:Ce}},init(i,n,a){h.initialized=!0,i??(i=o.stdin),n??(n=o.stdout),a??(a=o.stderr),h.createStandardStreams(i,n,a)},quit(){h.initialized=!1;for(var i=0;i<h.streams.length;i++){var n=h.streams[i];n&&h.close(n)}},findObject(i,n){var a=h.analyzePath(i,n);return a.exists?a.object:null},analyzePath(i,n){try{var a=h.lookupPath(i,{follow:!n});i=a.path}catch{}var l={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=h.lookupPath(i,{parent:!0});l.parentExists=!0,l.parentPath=a.path,l.parentObject=a.node,l.name=Ze.basename(i),a=h.lookupPath(i,{follow:!n}),l.exists=!0,l.path=a.path,l.object=a.node,l.name=a.node.name,l.isRoot=a.path==="/"}catch(c){l.error=c.errno}return l},createPath(i,n,a,l){i=typeof i=="string"?i:h.getPath(i);for(var c=n.split("/").reverse();c.length;){var u=c.pop();if(u){var w=Ze.join2(i,u);try{h.mkdir(w)}catch{}i=w}}return w},createFile(i,n,a,l,c){var u=Ze.join2(typeof i=="string"?i:h.getPath(i),n),w=Il(l,c);return h.create(u,w)},createDataFile(i,n,a,l,c,u){var w=n;i&&(i=typeof i=="string"?i:h.getPath(i),w=n?Ze.join2(i,n):i);var E=Il(l,c),j=h.create(w,E);if(a){if(typeof a=="string"){for(var H=new Array(a.length),oe=0,ce=a.length;oe<ce;++oe)H[oe]=a.charCodeAt(oe);a=H}h.chmod(j,E|146);var Q=h.open(j,577);h.write(Q,a,0,a.length,0,u),h.close(Q),h.chmod(j,E)}},createDevice(i,n,a,l){var E;var c=Ze.join2(typeof i=="string"?i:h.getPath(i),n),u=Il(!!a,!!l);(E=h.createDevice).major??(E.major=64);var w=h.makedev(h.createDevice.major++,0);return h.registerDevice(w,{open(j){j.seekable=!1},close(j){var H;(H=l==null?void 0:l.buffer)!=null&&H.length&&l(10)},read(j,H,oe,ce,Q){for(var W=0,Y=0;Y<ce;Y++){var k;try{k=a()}catch{throw new h.ErrnoError(29)}if(k===void 0&&W===0)throw new h.ErrnoError(6);if(k==null)break;W++,H[oe+Y]=k}return W&&(j.node.timestamp=Date.now()),W},write(j,H,oe,ce,Q){for(var W=0;W<ce;W++)try{l(H[oe+W])}catch{throw new h.ErrnoError(29)}return ce&&(j.node.timestamp=Date.now()),W}}),h.mkdev(c,u,w)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=Me(i.url),i.usedBytes=i.contents.length}catch{throw new h.ErrnoError(29)}},createLazyFile(i,n,a,l,c){class u{constructor(){this.lengthKnown=!1,this.chunks=[]}get(W){if(!(W>this.length-1||W<0)){var Y=W%this.chunkSize,k=W/this.chunkSize|0;return this.getter(k)[Y]}}setDataGetter(W){this.getter=W}cacheLength(){var W=new XMLHttpRequest;if(W.open("HEAD",a,!1),W.send(null),!(W.status>=200&&W.status<300||W.status===304))throw new Error("Couldn't load "+a+". Status: "+W.status);var Y=Number(W.getResponseHeader("Content-length")),k,T=(k=W.getResponseHeader("Accept-Ranges"))&&k==="bytes",R=(k=W.getResponseHeader("Content-Encoding"))&&k==="gzip",B=1024*1024;T||(B=Y);var G=(X,ae)=>{if(X>ae)throw new Error("invalid range ("+X+", "+ae+") or no bytes requested!");if(ae>Y-1)throw new Error("only "+Y+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",a,!1),Y!==B&&_.setRequestHeader("Range","bytes="+X+"-"+ae),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw new Error("Couldn't load "+a+". Status: "+_.status);return _.response!==void 0?new Uint8Array(_.response||[]):fu(_.responseText||"")},F=this;F.setDataGetter(X=>{var ae=X*B,_=(X+1)*B-1;if(_=Math.min(_,Y-1),typeof F.chunks[X]>"u"&&(F.chunks[X]=G(ae,_)),typeof F.chunks[X]>"u")throw new Error("doXHR failed!");return F.chunks[X]}),(R||!Y)&&(B=Y=1,Y=this.getter(0).length,B=Y,Oe("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Y,this._chunkSize=B,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!le)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var w=new u,E={isDevice:!1,contents:w}}else var E={isDevice:!1,url:a};var j=h.createFile(i,n,E,l,c);E.contents?j.contents=E.contents:E.url&&(j.contents=null,j.url=E.url),Object.defineProperties(j,{usedBytes:{get:function(){return this.contents.length}}});var H={},oe=Object.keys(j.stream_ops);oe.forEach(Q=>{var W=j.stream_ops[Q];H[Q]=(...Y)=>(h.forceLoadFile(j),W(...Y))});function ce(Q,W,Y,k,T){var R=Q.node.contents;if(T>=R.length)return 0;var B=Math.min(R.length-T,k);if(R.slice)for(var G=0;G<B;G++)W[Y+G]=R[T+G];else for(var G=0;G<B;G++)W[Y+G]=R.get(T+G);return B}return H.read=(Q,W,Y,k,T)=>(h.forceLoadFile(j),ce(Q,W,Y,k,T)),H.mmap=(Q,W,Y,k,T)=>{h.forceLoadFile(j);var R=pu(W);if(!R)throw new h.ErrnoError(48);return ce(Q,Le,R,W,Y),{ptr:R,allocated:!0}},j.stream_ops=H,j}},Wh=(i,n)=>i?ps(pr,i,n):"",We={DEFAULT_POLLMASK:5,calculateAt(i,n,a){if(Ze.isAbs(n))return n;var l;if(i===-100)l=h.cwd();else{var c=We.getStreamFromFD(i);l=c.path}if(n.length==0){if(!a)throw new h.ErrnoError(44);return l}return Ze.join2(l,n)},doStat(i,n,a){var l=i(n);De[a>>2]=l.dev,De[a+4>>2]=l.mode,V[a+8>>2]=l.nlink,De[a+12>>2]=l.uid,De[a+16>>2]=l.gid,De[a+20>>2]=l.rdev,S[a+24>>3]=BigInt(l.size),De[a+32>>2]=4096,De[a+36>>2]=l.blocks;var c=l.atime.getTime(),u=l.mtime.getTime(),w=l.ctime.getTime();return S[a+40>>3]=BigInt(Math.floor(c/1e3)),V[a+48>>2]=c%1e3*1e3*1e3,S[a+56>>3]=BigInt(Math.floor(u/1e3)),V[a+64>>2]=u%1e3*1e3*1e3,S[a+72>>3]=BigInt(Math.floor(w/1e3)),V[a+80>>2]=w%1e3*1e3*1e3,S[a+88>>3]=BigInt(l.ino),0},doMsync(i,n,a,l,c){if(!h.isFile(n.node.mode))throw new h.ErrnoError(43);if(l&2)return 0;var u=pr.slice(i,i+a);h.msync(n,u,c,a,l)},getStreamFromFD(i){var n=h.getStreamChecked(i);return n},varargs:void 0,getStr(i){var n=Wh(i);return n}};function Dh(i,n){try{return i=We.getStr(i),h.chmod(i,n),0}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Rh(i,n,a,l){try{if(n=We.getStr(n),n=We.calculateAt(i,n),a&-8)return-28;var c=h.lookupPath(n,{follow:!0}),u=c.node;if(!u)return-44;var w="";return a&4&&(w+="r"),a&2&&(w+="w"),a&1&&(w+="x"),w&&h.nodePermissions(u,w)?-2:0}catch(E){if(typeof h>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}function Bh(i,n){try{return h.fchmod(i,n),0}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Mh(i,n,a){try{return h.fchown(i,n,a),0}catch(l){if(typeof h>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function ia(){var i=De[+We.varargs>>2];return We.varargs+=4,i}var _s=ia;function Uh(i,n,a){We.varargs=a;try{var l=We.getStreamFromFD(i);switch(n){case 0:{var c=ia();if(c<0)return-28;for(;h.streams[c];)c++;var u;return u=h.dupStream(l,c),u.fd}case 1:case 2:return 0;case 3:return l.flags;case 4:{var c=ia();return l.flags|=c,0}case 12:{var c=_s(),w=0;return Yt[c+w>>1]=2,0}case 13:case 14:return 0}return-28}catch(E){if(typeof h>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}function Qh(i,n){try{var a=We.getStreamFromFD(i);return We.doStat(h.stat,a.path,n)}catch(l){if(typeof h>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}var jh=9007199254740992,zh=-9007199254740992,no=i=>i<zh||i>jh?NaN:Number(i);function Vh(i,n){n=no(n);try{return isNaN(n)?61:(h.ftruncate(i,n),0)}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var ms=(i,n,a)=>kl(i,pr,n,a);function $h(i,n){try{if(n===0)return-28;var a=h.cwd(),l=ra(a)+1;return n<l?-68:(ms(a,i,n),l)}catch(c){if(typeof h>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Hh(i,n,a){We.varargs=a;try{var l=We.getStreamFromFD(i);switch(n){case 21509:return l.tty?0:-59;case 21505:{if(!l.tty)return-59;if(l.tty.ops.ioctl_tcgets){var c=l.tty.ops.ioctl_tcgets(l),u=_s();De[u>>2]=c.c_iflag||0,De[u+4>>2]=c.c_oflag||0,De[u+8>>2]=c.c_cflag||0,De[u+12>>2]=c.c_lflag||0;for(var w=0;w<32;w++)Le[u+w+17]=c.c_cc[w]||0;return 0}return 0}case 21510:case 21511:case 21512:return l.tty?0:-59;case 21506:case 21507:case 21508:{if(!l.tty)return-59;if(l.tty.ops.ioctl_tcsets){for(var u=_s(),E=De[u>>2],j=De[u+4>>2],H=De[u+8>>2],oe=De[u+12>>2],ce=[],w=0;w<32;w++)ce.push(Le[u+w+17]);return l.tty.ops.ioctl_tcsets(l.tty,n,{c_iflag:E,c_oflag:j,c_cflag:H,c_lflag:oe,c_cc:ce})}return 0}case 21519:{if(!l.tty)return-59;var u=_s();return De[u>>2]=0,0}case 21520:return l.tty?-28:-59;case 21531:{var u=_s();return h.ioctl(l,n,u)}case 21523:{if(!l.tty)return-59;if(l.tty.ops.ioctl_tiocgwinsz){var Q=l.tty.ops.ioctl_tiocgwinsz(l.tty),u=_s();Yt[u>>1]=Q[0],Yt[u+2>>1]=Q[1]}return 0}case 21524:return l.tty?0:-59;case 21515:return l.tty?0:-59;default:return-28}}catch(W){if(typeof h>"u"||W.name!=="ErrnoError")throw W;return-W.errno}}function Jh(i,n){try{return i=We.getStr(i),We.doStat(h.lstat,i,n)}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Gh(i,n,a){try{return n=We.getStr(n),n=We.calculateAt(i,n),n=Ze.normalize(n),n[n.length-1]==="/"&&(n=n.substr(0,n.length-1)),h.mkdir(n,a,0),0}catch(l){if(typeof h>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function Kh(i,n,a,l){try{n=We.getStr(n);var c=l&256,u=l&4096;return l=l&-6401,n=We.calculateAt(i,n,u),We.doStat(c?h.lstat:h.stat,n,a)}catch(w){if(typeof h>"u"||w.name!=="ErrnoError")throw w;return-w.errno}}function Yh(i,n,a,l){We.varargs=l;try{n=We.getStr(n),n=We.calculateAt(i,n);var c=l?ia():0;return h.open(n,a,c).fd}catch(u){if(typeof h>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Xh(i,n,a,l){try{if(n=We.getStr(n),n=We.calculateAt(i,n),l<=0)return-28;var c=h.readlink(n),u=Math.min(l,ra(c)),w=Le[a+u];return ms(c,a,l+1),Le[a+u]=w,u}catch(E){if(typeof h>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}function Zh(i){try{return i=We.getStr(i),h.rmdir(i),0}catch(n){if(typeof h>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function ep(i,n){try{return i=We.getStr(i),We.doStat(h.stat,i,n)}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function tp(i,n,a){try{return n=We.getStr(n),n=We.calculateAt(i,n),a===0?h.unlink(n):a===512?h.rmdir(n):wn("Invalid flags passed to unlinkat"),0}catch(l){if(typeof h>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}var _u=i=>V[i>>2]+De[i+4>>2]*4294967296;function rp(i,n,a,l){try{n=We.getStr(n),n=We.calculateAt(i,n,!0);var c=Date.now(),u,w;if(!a)u=c,w=c;else{var E=_u(a),j=De[a+8>>2];j==1073741823?u=c:j==1073741822?u=-1:u=E*1e3+j/(1e3*1e3),a+=16,E=_u(a),j=De[a+8>>2],j==1073741823?w=c:j==1073741822?w=-1:w=E*1e3+j/(1e3*1e3)}return(w!=-1||u!=-1)&&h.utime(n,u,w),0}catch(H){if(typeof h>"u"||H.name!=="ErrnoError")throw H;return-H.errno}}var ip=1,np=()=>ip,sp=i=>i%4===0&&(i%100!==0||i%400===0),op=[0,31,60,91,121,152,182,213,244,274,305,335],ap=[0,31,59,90,120,151,181,212,243,273,304,334],lp=i=>{var n=sp(i.getFullYear()),a=n?op:ap,l=a[i.getMonth()]+i.getDate()-1;return l};function cp(i,n){i=no(i);var a=new Date(i*1e3);De[n>>2]=a.getSeconds(),De[n+4>>2]=a.getMinutes(),De[n+8>>2]=a.getHours(),De[n+12>>2]=a.getDate(),De[n+16>>2]=a.getMonth(),De[n+20>>2]=a.getFullYear()-1900,De[n+24>>2]=a.getDay();var l=lp(a)|0;De[n+28>>2]=l,De[n+36>>2]=-(a.getTimezoneOffset()*60);var c=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),w=c.getTimezoneOffset(),E=(u!=w&&a.getTimezoneOffset()==Math.min(w,u))|0;De[n+32>>2]=E}function up(i,n,a,l,c,u,w){c=no(c);try{if(isNaN(c))return 61;var E=We.getStreamFromFD(l),j=h.mmap(E,i,c,n,a),H=j.ptr;return De[u>>2]=j.allocated,V[w>>2]=H,0}catch(oe){if(typeof h>"u"||oe.name!=="ErrnoError")throw oe;return-oe.errno}}function dp(i,n,a,l,c,u){u=no(u);try{var w=We.getStreamFromFD(c);a&2&&We.doMsync(i,w,n,l,u)}catch(E){if(typeof h>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}var fp=(i,n,a,l)=>{var c=new Date().getFullYear(),u=new Date(c,0,1),w=new Date(c,6,1),E=u.getTimezoneOffset(),j=w.getTimezoneOffset(),H=Math.max(E,j);V[i>>2]=H*60,De[n>>2]=+(E!=j);var oe=W=>{var Y=W>=0?"-":"+",k=Math.abs(W),T=String(Math.floor(k/60)).padStart(2,"0"),R=String(k%60).padStart(2,"0");return`UTC${Y}${T}${R}`},ce=oe(E),Q=oe(j);j<E?(ms(ce,a,17),ms(Q,l,17)):(ms(ce,l,17),ms(Q,a,17))},hp=()=>Date.now(),pp=()=>performance.now(),_p=()=>2147483648,mp=i=>{var n=_t.buffer,a=(i-n.byteLength+65535)/65536|0;try{return _t.grow(a),ge(),1}catch{}},yp=i=>{var n=pr.length;i>>>=0;var a=_p();if(i>a)return!1;for(var l=1;l<=4;l*=2){var c=n*(1+.2/l);c=Math.min(c,i+100663296);var u=Math.min(a,hu(Math.max(i,c),65536)),w=mp(u);if(w)return!0}return!1},Tl={},gp=()=>U||"./this.program",so=()=>{if(!so.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:gp()};for(var a in Tl)Tl[a]===void 0?delete n[a]:n[a]=Tl[a];var l=[];for(var a in n)l.push(`${a}=${n[a]}`);so.strings=l}return so.strings},wp=(i,n)=>{for(var a=0;a<i.length;++a)Le[n++]=i.charCodeAt(a);Le[n]=0},bp=(i,n)=>{var a=0;return so().forEach((l,c)=>{var u=n+a;V[i+c*4>>2]=u,wp(l,u),a+=l.length+1}),0},Np=(i,n)=>{var a=so();V[i>>2]=a.length;var l=0;return a.forEach(c=>l+=c.length+1),V[n>>2]=l,0};function qp(i){try{var n=We.getStreamFromFD(i);return h.close(n),0}catch(a){if(typeof h>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function vp(i,n){try{var a=0,l=0,c=0,u=We.getStreamFromFD(i),w=u.tty?2:h.isDir(u.mode)?3:h.isLink(u.mode)?7:4;return Le[n]=w,Yt[n+2>>1]=c,S[n+8>>3]=BigInt(a),S[n+16>>3]=BigInt(l),0}catch(E){if(typeof h>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var xp=(i,n,a,l)=>{for(var c=0,u=0;u<a;u++){var w=V[n>>2],E=V[n+4>>2];n+=8;var j=h.read(i,Le,w,E,l);if(j<0)return-1;if(c+=j,j<E)break}return c};function Ep(i,n,a,l){try{var c=We.getStreamFromFD(i),u=xp(c,n,a);return V[l>>2]=u,0}catch(w){if(typeof h>"u"||w.name!=="ErrnoError")throw w;return w.errno}}function Sp(i,n,a,l){n=no(n);try{if(isNaN(n))return 61;var c=We.getStreamFromFD(i);return h.llseek(c,n,a),S[l>>3]=BigInt(c.position),c.getdents&&n===0&&a===0&&(c.getdents=null),0}catch(u){if(typeof h>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function Ap(i){var a;try{var n=We.getStreamFromFD(i);return(a=n.stream_ops)!=null&&a.fsync?n.stream_ops.fsync(n):0}catch(l){if(typeof h>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var Op=(i,n,a,l)=>{for(var c=0,u=0;u<a;u++){var w=V[n>>2],E=V[n+4>>2];n+=8;var j=h.write(i,Le,w,E,l);if(j<0)return-1;if(c+=j,j<E)break}return c};function kp(i,n,a,l){try{var c=We.getStreamFromFD(i),u=Op(c,n,a);return V[l>>2]=u,0}catch(w){if(typeof h>"u"||w.name!=="ErrnoError")throw w;return w.errno}}h.createPreloadedFile=Ph,h.staticInit();var mu={__syscall_chmod:Dh,__syscall_faccessat:Rh,__syscall_fchmod:Bh,__syscall_fchown32:Mh,__syscall_fcntl64:Uh,__syscall_fstat64:Qh,__syscall_ftruncate64:Vh,__syscall_getcwd:$h,__syscall_ioctl:Hh,__syscall_lstat64:Jh,__syscall_mkdirat:Gh,__syscall_newfstatat:Kh,__syscall_openat:Yh,__syscall_readlinkat:Xh,__syscall_rmdir:Zh,__syscall_stat64:ep,__syscall_unlinkat:tp,__syscall_utimensat:rp,_emscripten_get_now_is_monotonic:np,_localtime_js:cp,_mmap_js:up,_munmap_js:dp,_tzset_js:fp,emscripten_date_now:hp,emscripten_get_now:pp,emscripten_resize_heap:yp,environ_get:bp,environ_sizes_get:Np,fd_close:qp,fd_fdstat_get:vp,fd_read:Ep,fd_seek:Sp,fd_sync:Ap,fd_write:kp,memory:_t},N=Sh();o._sqlite3_status64=(i,n,a,l)=>(o._sqlite3_status64=N.sqlite3_status64)(i,n,a,l),o._sqlite3_status=(i,n,a,l)=>(o._sqlite3_status=N.sqlite3_status)(i,n,a,l),o._sqlite3_db_status=(i,n,a,l,c)=>(o._sqlite3_db_status=N.sqlite3_db_status)(i,n,a,l,c),o._sqlite3_msize=i=>(o._sqlite3_msize=N.sqlite3_msize)(i),o._sqlite3_vfs_find=i=>(o._sqlite3_vfs_find=N.sqlite3_vfs_find)(i),o._sqlite3_initialize=()=>(o._sqlite3_initialize=N.sqlite3_initialize)(),o._sqlite3_malloc=i=>(o._sqlite3_malloc=N.sqlite3_malloc)(i),o._sqlite3_free=i=>(o._sqlite3_free=N.sqlite3_free)(i),o._sqlite3_vfs_register=(i,n)=>(o._sqlite3_vfs_register=N.sqlite3_vfs_register)(i,n),o._sqlite3_vfs_unregister=i=>(o._sqlite3_vfs_unregister=N.sqlite3_vfs_unregister)(i),o._sqlite3_malloc64=i=>(o._sqlite3_malloc64=N.sqlite3_malloc64)(i),o._sqlite3_realloc=(i,n)=>(o._sqlite3_realloc=N.sqlite3_realloc)(i,n),o._sqlite3_realloc64=(i,n)=>(o._sqlite3_realloc64=N.sqlite3_realloc64)(i,n),o._sqlite3_value_text=i=>(o._sqlite3_value_text=N.sqlite3_value_text)(i),o._sqlite3_randomness=(i,n)=>(o._sqlite3_randomness=N.sqlite3_randomness)(i,n),o._sqlite3_stricmp=(i,n)=>(o._sqlite3_stricmp=N.sqlite3_stricmp)(i,n),o._sqlite3_strnicmp=(i,n,a)=>(o._sqlite3_strnicmp=N.sqlite3_strnicmp)(i,n,a),o._sqlite3_uri_parameter=(i,n)=>(o._sqlite3_uri_parameter=N.sqlite3_uri_parameter)(i,n),o._sqlite3_uri_boolean=(i,n,a)=>(o._sqlite3_uri_boolean=N.sqlite3_uri_boolean)(i,n,a),o._sqlite3_serialize=(i,n,a,l)=>(o._sqlite3_serialize=N.sqlite3_serialize)(i,n,a,l),o._sqlite3_prepare_v2=(i,n,a,l,c)=>(o._sqlite3_prepare_v2=N.sqlite3_prepare_v2)(i,n,a,l,c),o._sqlite3_step=i=>(o._sqlite3_step=N.sqlite3_step)(i),o._sqlite3_column_int64=(i,n)=>(o._sqlite3_column_int64=N.sqlite3_column_int64)(i,n),o._sqlite3_reset=i=>(o._sqlite3_reset=N.sqlite3_reset)(i),o._sqlite3_exec=(i,n,a,l,c)=>(o._sqlite3_exec=N.sqlite3_exec)(i,n,a,l,c),o._sqlite3_column_int=(i,n)=>(o._sqlite3_column_int=N.sqlite3_column_int)(i,n),o._sqlite3_finalize=i=>(o._sqlite3_finalize=N.sqlite3_finalize)(i),o._sqlite3_file_control=(i,n,a,l)=>(o._sqlite3_file_control=N.sqlite3_file_control)(i,n,a,l),o._sqlite3_column_name=(i,n)=>(o._sqlite3_column_name=N.sqlite3_column_name)(i,n),o._sqlite3_column_text=(i,n)=>(o._sqlite3_column_text=N.sqlite3_column_text)(i,n),o._sqlite3_column_type=(i,n)=>(o._sqlite3_column_type=N.sqlite3_column_type)(i,n),o._sqlite3_errmsg=i=>(o._sqlite3_errmsg=N.sqlite3_errmsg)(i),o._sqlite3_deserialize=(i,n,a,l,c,u)=>(o._sqlite3_deserialize=N.sqlite3_deserialize)(i,n,a,l,c,u),o._sqlite3_clear_bindings=i=>(o._sqlite3_clear_bindings=N.sqlite3_clear_bindings)(i),o._sqlite3_value_blob=i=>(o._sqlite3_value_blob=N.sqlite3_value_blob)(i),o._sqlite3_value_bytes=i=>(o._sqlite3_value_bytes=N.sqlite3_value_bytes)(i),o._sqlite3_value_double=i=>(o._sqlite3_value_double=N.sqlite3_value_double)(i),o._sqlite3_value_int=i=>(o._sqlite3_value_int=N.sqlite3_value_int)(i),o._sqlite3_value_int64=i=>(o._sqlite3_value_int64=N.sqlite3_value_int64)(i),o._sqlite3_value_subtype=i=>(o._sqlite3_value_subtype=N.sqlite3_value_subtype)(i),o._sqlite3_value_pointer=(i,n)=>(o._sqlite3_value_pointer=N.sqlite3_value_pointer)(i,n),o._sqlite3_value_type=i=>(o._sqlite3_value_type=N.sqlite3_value_type)(i),o._sqlite3_value_nochange=i=>(o._sqlite3_value_nochange=N.sqlite3_value_nochange)(i),o._sqlite3_value_frombind=i=>(o._sqlite3_value_frombind=N.sqlite3_value_frombind)(i),o._sqlite3_value_dup=i=>(o._sqlite3_value_dup=N.sqlite3_value_dup)(i),o._sqlite3_value_free=i=>(o._sqlite3_value_free=N.sqlite3_value_free)(i),o._sqlite3_result_blob=(i,n,a,l)=>(o._sqlite3_result_blob=N.sqlite3_result_blob)(i,n,a,l),o._sqlite3_result_error_toobig=i=>(o._sqlite3_result_error_toobig=N.sqlite3_result_error_toobig)(i),o._sqlite3_result_error_nomem=i=>(o._sqlite3_result_error_nomem=N.sqlite3_result_error_nomem)(i),o._sqlite3_result_double=(i,n)=>(o._sqlite3_result_double=N.sqlite3_result_double)(i,n),o._sqlite3_result_error=(i,n,a)=>(o._sqlite3_result_error=N.sqlite3_result_error)(i,n,a),o._sqlite3_result_int=(i,n)=>(o._sqlite3_result_int=N.sqlite3_result_int)(i,n),o._sqlite3_result_int64=(i,n)=>(o._sqlite3_result_int64=N.sqlite3_result_int64)(i,n),o._sqlite3_result_null=i=>(o._sqlite3_result_null=N.sqlite3_result_null)(i),o._sqlite3_result_pointer=(i,n,a,l)=>(o._sqlite3_result_pointer=N.sqlite3_result_pointer)(i,n,a,l),o._sqlite3_result_subtype=(i,n)=>(o._sqlite3_result_subtype=N.sqlite3_result_subtype)(i,n),o._sqlite3_result_text=(i,n,a,l)=>(o._sqlite3_result_text=N.sqlite3_result_text)(i,n,a,l),o._sqlite3_result_zeroblob=(i,n)=>(o._sqlite3_result_zeroblob=N.sqlite3_result_zeroblob)(i,n),o._sqlite3_result_zeroblob64=(i,n)=>(o._sqlite3_result_zeroblob64=N.sqlite3_result_zeroblob64)(i,n),o._sqlite3_result_error_code=(i,n)=>(o._sqlite3_result_error_code=N.sqlite3_result_error_code)(i,n),o._sqlite3_user_data=i=>(o._sqlite3_user_data=N.sqlite3_user_data)(i),o._sqlite3_context_db_handle=i=>(o._sqlite3_context_db_handle=N.sqlite3_context_db_handle)(i),o._sqlite3_vtab_nochange=i=>(o._sqlite3_vtab_nochange=N.sqlite3_vtab_nochange)(i),o._sqlite3_vtab_in_first=(i,n)=>(o._sqlite3_vtab_in_first=N.sqlite3_vtab_in_first)(i,n),o._sqlite3_vtab_in_next=(i,n)=>(o._sqlite3_vtab_in_next=N.sqlite3_vtab_in_next)(i,n),o._sqlite3_aggregate_context=(i,n)=>(o._sqlite3_aggregate_context=N.sqlite3_aggregate_context)(i,n),o._sqlite3_get_auxdata=(i,n)=>(o._sqlite3_get_auxdata=N.sqlite3_get_auxdata)(i,n),o._sqlite3_set_auxdata=(i,n,a,l)=>(o._sqlite3_set_auxdata=N.sqlite3_set_auxdata)(i,n,a,l),o._sqlite3_column_count=i=>(o._sqlite3_column_count=N.sqlite3_column_count)(i),o._sqlite3_data_count=i=>(o._sqlite3_data_count=N.sqlite3_data_count)(i),o._sqlite3_column_blob=(i,n)=>(o._sqlite3_column_blob=N.sqlite3_column_blob)(i,n),o._sqlite3_column_bytes=(i,n)=>(o._sqlite3_column_bytes=N.sqlite3_column_bytes)(i,n),o._sqlite3_column_double=(i,n)=>(o._sqlite3_column_double=N.sqlite3_column_double)(i,n),o._sqlite3_column_value=(i,n)=>(o._sqlite3_column_value=N.sqlite3_column_value)(i,n),o._sqlite3_column_decltype=(i,n)=>(o._sqlite3_column_decltype=N.sqlite3_column_decltype)(i,n),o._sqlite3_bind_blob=(i,n,a,l,c)=>(o._sqlite3_bind_blob=N.sqlite3_bind_blob)(i,n,a,l,c),o._sqlite3_bind_double=(i,n,a)=>(o._sqlite3_bind_double=N.sqlite3_bind_double)(i,n,a),o._sqlite3_bind_int=(i,n,a)=>(o._sqlite3_bind_int=N.sqlite3_bind_int)(i,n,a),o._sqlite3_bind_int64=(i,n,a)=>(o._sqlite3_bind_int64=N.sqlite3_bind_int64)(i,n,a),o._sqlite3_bind_null=(i,n)=>(o._sqlite3_bind_null=N.sqlite3_bind_null)(i,n),o._sqlite3_bind_pointer=(i,n,a,l,c)=>(o._sqlite3_bind_pointer=N.sqlite3_bind_pointer)(i,n,a,l,c),o._sqlite3_bind_text=(i,n,a,l,c)=>(o._sqlite3_bind_text=N.sqlite3_bind_text)(i,n,a,l,c),o._sqlite3_bind_parameter_count=i=>(o._sqlite3_bind_parameter_count=N.sqlite3_bind_parameter_count)(i),o._sqlite3_bind_parameter_name=(i,n)=>(o._sqlite3_bind_parameter_name=N.sqlite3_bind_parameter_name)(i,n),o._sqlite3_bind_parameter_index=(i,n)=>(o._sqlite3_bind_parameter_index=N.sqlite3_bind_parameter_index)(i,n),o._sqlite3_db_handle=i=>(o._sqlite3_db_handle=N.sqlite3_db_handle)(i),o._sqlite3_stmt_readonly=i=>(o._sqlite3_stmt_readonly=N.sqlite3_stmt_readonly)(i),o._sqlite3_stmt_isexplain=i=>(o._sqlite3_stmt_isexplain=N.sqlite3_stmt_isexplain)(i),o._sqlite3_stmt_explain=(i,n)=>(o._sqlite3_stmt_explain=N.sqlite3_stmt_explain)(i,n),o._sqlite3_stmt_busy=i=>(o._sqlite3_stmt_busy=N.sqlite3_stmt_busy)(i),o._sqlite3_stmt_status=(i,n,a)=>(o._sqlite3_stmt_status=N.sqlite3_stmt_status)(i,n,a),o._sqlite3_sql=i=>(o._sqlite3_sql=N.sqlite3_sql)(i),o._sqlite3_expanded_sql=i=>(o._sqlite3_expanded_sql=N.sqlite3_expanded_sql)(i),o._sqlite3_preupdate_old=(i,n,a)=>(o._sqlite3_preupdate_old=N.sqlite3_preupdate_old)(i,n,a),o._sqlite3_preupdate_count=i=>(o._sqlite3_preupdate_count=N.sqlite3_preupdate_count)(i),o._sqlite3_preupdate_depth=i=>(o._sqlite3_preupdate_depth=N.sqlite3_preupdate_depth)(i),o._sqlite3_preupdate_blobwrite=i=>(o._sqlite3_preupdate_blobwrite=N.sqlite3_preupdate_blobwrite)(i),o._sqlite3_preupdate_new=(i,n,a)=>(o._sqlite3_preupdate_new=N.sqlite3_preupdate_new)(i,n,a),o._sqlite3_value_numeric_type=i=>(o._sqlite3_value_numeric_type=N.sqlite3_value_numeric_type)(i),o._sqlite3_set_authorizer=(i,n,a)=>(o._sqlite3_set_authorizer=N.sqlite3_set_authorizer)(i,n,a),o._sqlite3_strglob=(i,n)=>(o._sqlite3_strglob=N.sqlite3_strglob)(i,n),o._sqlite3_strlike=(i,n,a)=>(o._sqlite3_strlike=N.sqlite3_strlike)(i,n,a),o._sqlite3_auto_extension=i=>(o._sqlite3_auto_extension=N.sqlite3_auto_extension)(i),o._sqlite3_cancel_auto_extension=i=>(o._sqlite3_cancel_auto_extension=N.sqlite3_cancel_auto_extension)(i),o._sqlite3_reset_auto_extension=()=>(o._sqlite3_reset_auto_extension=N.sqlite3_reset_auto_extension)(),o._sqlite3_prepare_v3=(i,n,a,l,c,u)=>(o._sqlite3_prepare_v3=N.sqlite3_prepare_v3)(i,n,a,l,c,u),o._sqlite3_create_module=(i,n,a,l)=>(o._sqlite3_create_module=N.sqlite3_create_module)(i,n,a,l),o._sqlite3_create_module_v2=(i,n,a,l,c)=>(o._sqlite3_create_module_v2=N.sqlite3_create_module_v2)(i,n,a,l,c),o._sqlite3_drop_modules=(i,n)=>(o._sqlite3_drop_modules=N.sqlite3_drop_modules)(i,n),o._sqlite3_declare_vtab=(i,n)=>(o._sqlite3_declare_vtab=N.sqlite3_declare_vtab)(i,n),o._sqlite3_vtab_on_conflict=i=>(o._sqlite3_vtab_on_conflict=N.sqlite3_vtab_on_conflict)(i),o._sqlite3_vtab_collation=(i,n)=>(o._sqlite3_vtab_collation=N.sqlite3_vtab_collation)(i,n),o._sqlite3_vtab_in=(i,n,a)=>(o._sqlite3_vtab_in=N.sqlite3_vtab_in)(i,n,a),o._sqlite3_vtab_rhs_value=(i,n,a)=>(o._sqlite3_vtab_rhs_value=N.sqlite3_vtab_rhs_value)(i,n,a),o._sqlite3_vtab_distinct=i=>(o._sqlite3_vtab_distinct=N.sqlite3_vtab_distinct)(i),o._sqlite3_keyword_name=(i,n,a)=>(o._sqlite3_keyword_name=N.sqlite3_keyword_name)(i,n,a),o._sqlite3_keyword_count=()=>(o._sqlite3_keyword_count=N.sqlite3_keyword_count)(),o._sqlite3_keyword_check=(i,n)=>(o._sqlite3_keyword_check=N.sqlite3_keyword_check)(i,n),o._sqlite3_complete=i=>(o._sqlite3_complete=N.sqlite3_complete)(i),o._sqlite3_libversion=()=>(o._sqlite3_libversion=N.sqlite3_libversion)(),o._sqlite3_libversion_number=()=>(o._sqlite3_libversion_number=N.sqlite3_libversion_number)(),o._sqlite3_shutdown=()=>(o._sqlite3_shutdown=N.sqlite3_shutdown)(),o._sqlite3_last_insert_rowid=i=>(o._sqlite3_last_insert_rowid=N.sqlite3_last_insert_rowid)(i),o._sqlite3_set_last_insert_rowid=(i,n)=>(o._sqlite3_set_last_insert_rowid=N.sqlite3_set_last_insert_rowid)(i,n),o._sqlite3_changes64=i=>(o._sqlite3_changes64=N.sqlite3_changes64)(i),o._sqlite3_changes=i=>(o._sqlite3_changes=N.sqlite3_changes)(i),o._sqlite3_total_changes64=i=>(o._sqlite3_total_changes64=N.sqlite3_total_changes64)(i),o._sqlite3_total_changes=i=>(o._sqlite3_total_changes=N.sqlite3_total_changes)(i),o._sqlite3_txn_state=(i,n)=>(o._sqlite3_txn_state=N.sqlite3_txn_state)(i,n),o._sqlite3_close_v2=i=>(o._sqlite3_close_v2=N.sqlite3_close_v2)(i),o._sqlite3_busy_handler=(i,n,a)=>(o._sqlite3_busy_handler=N.sqlite3_busy_handler)(i,n,a),o._sqlite3_progress_handler=(i,n,a,l)=>(o._sqlite3_progress_handler=N.sqlite3_progress_handler)(i,n,a,l),o._sqlite3_busy_timeout=(i,n)=>(o._sqlite3_busy_timeout=N.sqlite3_busy_timeout)(i,n),o._sqlite3_interrupt=i=>(o._sqlite3_interrupt=N.sqlite3_interrupt)(i),o._sqlite3_is_interrupted=i=>(o._sqlite3_is_interrupted=N.sqlite3_is_interrupted)(i),o._sqlite3_create_function=(i,n,a,l,c,u,w,E)=>(o._sqlite3_create_function=N.sqlite3_create_function)(i,n,a,l,c,u,w,E),o._sqlite3_create_function_v2=(i,n,a,l,c,u,w,E,j)=>(o._sqlite3_create_function_v2=N.sqlite3_create_function_v2)(i,n,a,l,c,u,w,E,j),o._sqlite3_create_window_function=(i,n,a,l,c,u,w,E,j,H)=>(o._sqlite3_create_window_function=N.sqlite3_create_window_function)(i,n,a,l,c,u,w,E,j,H),o._sqlite3_overload_function=(i,n,a)=>(o._sqlite3_overload_function=N.sqlite3_overload_function)(i,n,a),o._sqlite3_trace_v2=(i,n,a,l)=>(o._sqlite3_trace_v2=N.sqlite3_trace_v2)(i,n,a,l),o._sqlite3_commit_hook=(i,n,a)=>(o._sqlite3_commit_hook=N.sqlite3_commit_hook)(i,n,a),o._sqlite3_update_hook=(i,n,a)=>(o._sqlite3_update_hook=N.sqlite3_update_hook)(i,n,a),o._sqlite3_rollback_hook=(i,n,a)=>(o._sqlite3_rollback_hook=N.sqlite3_rollback_hook)(i,n,a),o._sqlite3_preupdate_hook=(i,n,a)=>(o._sqlite3_preupdate_hook=N.sqlite3_preupdate_hook)(i,n,a),o._sqlite3_error_offset=i=>(o._sqlite3_error_offset=N.sqlite3_error_offset)(i),o._sqlite3_errcode=i=>(o._sqlite3_errcode=N.sqlite3_errcode)(i),o._sqlite3_extended_errcode=i=>(o._sqlite3_extended_errcode=N.sqlite3_extended_errcode)(i),o._sqlite3_errstr=i=>(o._sqlite3_errstr=N.sqlite3_errstr)(i),o._sqlite3_limit=(i,n,a)=>(o._sqlite3_limit=N.sqlite3_limit)(i,n,a),o._sqlite3_open=(i,n)=>(o._sqlite3_open=N.sqlite3_open)(i,n),o._sqlite3_open_v2=(i,n,a,l)=>(o._sqlite3_open_v2=N.sqlite3_open_v2)(i,n,a,l),o._sqlite3_create_collation=(i,n,a,l,c)=>(o._sqlite3_create_collation=N.sqlite3_create_collation)(i,n,a,l,c),o._sqlite3_create_collation_v2=(i,n,a,l,c,u)=>(o._sqlite3_create_collation_v2=N.sqlite3_create_collation_v2)(i,n,a,l,c,u),o._sqlite3_collation_needed=(i,n,a)=>(o._sqlite3_collation_needed=N.sqlite3_collation_needed)(i,n,a),o._sqlite3_get_autocommit=i=>(o._sqlite3_get_autocommit=N.sqlite3_get_autocommit)(i),o._sqlite3_table_column_metadata=(i,n,a,l,c,u,w,E,j)=>(o._sqlite3_table_column_metadata=N.sqlite3_table_column_metadata)(i,n,a,l,c,u,w,E,j),o._sqlite3_extended_result_codes=(i,n)=>(o._sqlite3_extended_result_codes=N.sqlite3_extended_result_codes)(i,n),o._sqlite3_uri_key=(i,n)=>(o._sqlite3_uri_key=N.sqlite3_uri_key)(i,n),o._sqlite3_uri_int64=(i,n,a)=>(o._sqlite3_uri_int64=N.sqlite3_uri_int64)(i,n,a),o._sqlite3_db_name=(i,n)=>(o._sqlite3_db_name=N.sqlite3_db_name)(i,n),o._sqlite3_db_filename=(i,n)=>(o._sqlite3_db_filename=N.sqlite3_db_filename)(i,n),o._sqlite3_db_readonly=(i,n)=>(o._sqlite3_db_readonly=N.sqlite3_db_readonly)(i,n),o._sqlite3_compileoption_used=i=>(o._sqlite3_compileoption_used=N.sqlite3_compileoption_used)(i),o._sqlite3_compileoption_get=i=>(o._sqlite3_compileoption_get=N.sqlite3_compileoption_get)(i),o._sqlite3session_diff=(i,n,a,l)=>(o._sqlite3session_diff=N.sqlite3session_diff)(i,n,a,l),o._sqlite3session_attach=(i,n)=>(o._sqlite3session_attach=N.sqlite3session_attach)(i,n),o._sqlite3session_create=(i,n,a)=>(o._sqlite3session_create=N.sqlite3session_create)(i,n,a),o._sqlite3session_delete=i=>(o._sqlite3session_delete=N.sqlite3session_delete)(i),o._sqlite3session_table_filter=(i,n,a)=>(o._sqlite3session_table_filter=N.sqlite3session_table_filter)(i,n,a),o._sqlite3session_changeset=(i,n,a)=>(o._sqlite3session_changeset=N.sqlite3session_changeset)(i,n,a),o._sqlite3session_changeset_strm=(i,n,a)=>(o._sqlite3session_changeset_strm=N.sqlite3session_changeset_strm)(i,n,a),o._sqlite3session_patchset_strm=(i,n,a)=>(o._sqlite3session_patchset_strm=N.sqlite3session_patchset_strm)(i,n,a),o._sqlite3session_patchset=(i,n,a)=>(o._sqlite3session_patchset=N.sqlite3session_patchset)(i,n,a),o._sqlite3session_enable=(i,n)=>(o._sqlite3session_enable=N.sqlite3session_enable)(i,n),o._sqlite3session_indirect=(i,n)=>(o._sqlite3session_indirect=N.sqlite3session_indirect)(i,n),o._sqlite3session_isempty=i=>(o._sqlite3session_isempty=N.sqlite3session_isempty)(i),o._sqlite3session_memory_used=i=>(o._sqlite3session_memory_used=N.sqlite3session_memory_used)(i),o._sqlite3session_object_config=(i,n,a)=>(o._sqlite3session_object_config=N.sqlite3session_object_config)(i,n,a),o._sqlite3session_changeset_size=i=>(o._sqlite3session_changeset_size=N.sqlite3session_changeset_size)(i),o._sqlite3changeset_start=(i,n,a)=>(o._sqlite3changeset_start=N.sqlite3changeset_start)(i,n,a),o._sqlite3changeset_start_v2=(i,n,a,l)=>(o._sqlite3changeset_start_v2=N.sqlite3changeset_start_v2)(i,n,a,l),o._sqlite3changeset_start_strm=(i,n,a)=>(o._sqlite3changeset_start_strm=N.sqlite3changeset_start_strm)(i,n,a),o._sqlite3changeset_start_v2_strm=(i,n,a,l)=>(o._sqlite3changeset_start_v2_strm=N.sqlite3changeset_start_v2_strm)(i,n,a,l),o._sqlite3changeset_next=i=>(o._sqlite3changeset_next=N.sqlite3changeset_next)(i),o._sqlite3changeset_op=(i,n,a,l,c)=>(o._sqlite3changeset_op=N.sqlite3changeset_op)(i,n,a,l,c),o._sqlite3changeset_pk=(i,n,a)=>(o._sqlite3changeset_pk=N.sqlite3changeset_pk)(i,n,a),o._sqlite3changeset_old=(i,n,a)=>(o._sqlite3changeset_old=N.sqlite3changeset_old)(i,n,a),o._sqlite3changeset_new=(i,n,a)=>(o._sqlite3changeset_new=N.sqlite3changeset_new)(i,n,a),o._sqlite3changeset_conflict=(i,n,a)=>(o._sqlite3changeset_conflict=N.sqlite3changeset_conflict)(i,n,a),o._sqlite3changeset_fk_conflicts=(i,n)=>(o._sqlite3changeset_fk_conflicts=N.sqlite3changeset_fk_conflicts)(i,n),o._sqlite3changeset_finalize=i=>(o._sqlite3changeset_finalize=N.sqlite3changeset_finalize)(i),o._sqlite3changeset_invert=(i,n,a,l)=>(o._sqlite3changeset_invert=N.sqlite3changeset_invert)(i,n,a,l),o._sqlite3changeset_invert_strm=(i,n,a,l)=>(o._sqlite3changeset_invert_strm=N.sqlite3changeset_invert_strm)(i,n,a,l),o._sqlite3changeset_apply_v2=(i,n,a,l,c,u,w,E,j)=>(o._sqlite3changeset_apply_v2=N.sqlite3changeset_apply_v2)(i,n,a,l,c,u,w,E,j),o._sqlite3changeset_apply=(i,n,a,l,c,u)=>(o._sqlite3changeset_apply=N.sqlite3changeset_apply)(i,n,a,l,c,u),o._sqlite3changeset_apply_v2_strm=(i,n,a,l,c,u,w,E,j)=>(o._sqlite3changeset_apply_v2_strm=N.sqlite3changeset_apply_v2_strm)(i,n,a,l,c,u,w,E,j),o._sqlite3changeset_apply_strm=(i,n,a,l,c,u)=>(o._sqlite3changeset_apply_strm=N.sqlite3changeset_apply_strm)(i,n,a,l,c,u),o._sqlite3changegroup_new=i=>(o._sqlite3changegroup_new=N.sqlite3changegroup_new)(i),o._sqlite3changegroup_add=(i,n,a)=>(o._sqlite3changegroup_add=N.sqlite3changegroup_add)(i,n,a),o._sqlite3changegroup_output=(i,n,a)=>(o._sqlite3changegroup_output=N.sqlite3changegroup_output)(i,n,a),o._sqlite3changegroup_add_strm=(i,n,a)=>(o._sqlite3changegroup_add_strm=N.sqlite3changegroup_add_strm)(i,n,a),o._sqlite3changegroup_output_strm=(i,n,a)=>(o._sqlite3changegroup_output_strm=N.sqlite3changegroup_output_strm)(i,n,a),o._sqlite3changegroup_delete=i=>(o._sqlite3changegroup_delete=N.sqlite3changegroup_delete)(i),o._sqlite3changeset_concat=(i,n,a,l,c,u)=>(o._sqlite3changeset_concat=N.sqlite3changeset_concat)(i,n,a,l,c,u),o._sqlite3changeset_concat_strm=(i,n,a,l,c,u)=>(o._sqlite3changeset_concat_strm=N.sqlite3changeset_concat_strm)(i,n,a,l,c,u),o._sqlite3session_config=(i,n)=>(o._sqlite3session_config=N.sqlite3session_config)(i,n),o._sqlite3_sourceid=()=>(o._sqlite3_sourceid=N.sqlite3_sourceid)(),o._sqlite3__wasm_pstack_ptr=()=>(o._sqlite3__wasm_pstack_ptr=N.sqlite3__wasm_pstack_ptr)(),o._sqlite3__wasm_pstack_restore=i=>(o._sqlite3__wasm_pstack_restore=N.sqlite3__wasm_pstack_restore)(i),o._sqlite3__wasm_pstack_alloc=i=>(o._sqlite3__wasm_pstack_alloc=N.sqlite3__wasm_pstack_alloc)(i),o._sqlite3__wasm_pstack_remaining=()=>(o._sqlite3__wasm_pstack_remaining=N.sqlite3__wasm_pstack_remaining)(),o._sqlite3__wasm_pstack_quota=()=>(o._sqlite3__wasm_pstack_quota=N.sqlite3__wasm_pstack_quota)(),o._sqlite3__wasm_db_error=(i,n,a)=>(o._sqlite3__wasm_db_error=N.sqlite3__wasm_db_error)(i,n,a),o._sqlite3__wasm_test_struct=i=>(o._sqlite3__wasm_test_struct=N.sqlite3__wasm_test_struct)(i),o._sqlite3__wasm_enum_json=()=>(o._sqlite3__wasm_enum_json=N.sqlite3__wasm_enum_json)(),o._sqlite3__wasm_vfs_unlink=(i,n)=>(o._sqlite3__wasm_vfs_unlink=N.sqlite3__wasm_vfs_unlink)(i,n),o._sqlite3__wasm_db_vfs=(i,n)=>(o._sqlite3__wasm_db_vfs=N.sqlite3__wasm_db_vfs)(i,n),o._sqlite3__wasm_db_reset=i=>(o._sqlite3__wasm_db_reset=N.sqlite3__wasm_db_reset)(i),o._sqlite3__wasm_db_export_chunked=(i,n)=>(o._sqlite3__wasm_db_export_chunked=N.sqlite3__wasm_db_export_chunked)(i,n),o._sqlite3__wasm_db_serialize=(i,n,a,l,c)=>(o._sqlite3__wasm_db_serialize=N.sqlite3__wasm_db_serialize)(i,n,a,l,c),o._sqlite3__wasm_vfs_create_file=(i,n,a,l)=>(o._sqlite3__wasm_vfs_create_file=N.sqlite3__wasm_vfs_create_file)(i,n,a,l),o._sqlite3__wasm_posix_create_file=(i,n,a)=>(o._sqlite3__wasm_posix_create_file=N.sqlite3__wasm_posix_create_file)(i,n,a),o._sqlite3__wasm_kvvfsMakeKeyOnPstack=(i,n)=>(o._sqlite3__wasm_kvvfsMakeKeyOnPstack=N.sqlite3__wasm_kvvfsMakeKeyOnPstack)(i,n),o._sqlite3__wasm_kvvfs_methods=()=>(o._sqlite3__wasm_kvvfs_methods=N.sqlite3__wasm_kvvfs_methods)(),o._sqlite3__wasm_vtab_config=(i,n,a)=>(o._sqlite3__wasm_vtab_config=N.sqlite3__wasm_vtab_config)(i,n,a),o._sqlite3__wasm_db_config_ip=(i,n,a,l)=>(o._sqlite3__wasm_db_config_ip=N.sqlite3__wasm_db_config_ip)(i,n,a,l),o._sqlite3__wasm_db_config_pii=(i,n,a,l,c)=>(o._sqlite3__wasm_db_config_pii=N.sqlite3__wasm_db_config_pii)(i,n,a,l,c),o._sqlite3__wasm_db_config_s=(i,n,a)=>(o._sqlite3__wasm_db_config_s=N.sqlite3__wasm_db_config_s)(i,n,a),o._sqlite3__wasm_config_i=(i,n)=>(o._sqlite3__wasm_config_i=N.sqlite3__wasm_config_i)(i,n),o._sqlite3__wasm_config_ii=(i,n,a)=>(o._sqlite3__wasm_config_ii=N.sqlite3__wasm_config_ii)(i,n,a),o._sqlite3__wasm_config_j=(i,n)=>(o._sqlite3__wasm_config_j=N.sqlite3__wasm_config_j)(i,n),o._sqlite3__wasm_qfmt_token=(i,n)=>(o._sqlite3__wasm_qfmt_token=N.sqlite3__wasm_qfmt_token)(i,n),o._sqlite3__wasm_init_wasmfs=i=>(o._sqlite3__wasm_init_wasmfs=N.sqlite3__wasm_init_wasmfs)(i),o._sqlite3__wasm_test_intptr=i=>(o._sqlite3__wasm_test_intptr=N.sqlite3__wasm_test_intptr)(i),o._sqlite3__wasm_test_voidptr=i=>(o._sqlite3__wasm_test_voidptr=N.sqlite3__wasm_test_voidptr)(i),o._sqlite3__wasm_test_int64_max=()=>(o._sqlite3__wasm_test_int64_max=N.sqlite3__wasm_test_int64_max)(),o._sqlite3__wasm_test_int64_min=()=>(o._sqlite3__wasm_test_int64_min=N.sqlite3__wasm_test_int64_min)(),o._sqlite3__wasm_test_int64_times2=i=>(o._sqlite3__wasm_test_int64_times2=N.sqlite3__wasm_test_int64_times2)(i),o._sqlite3__wasm_test_int64_minmax=(i,n)=>(o._sqlite3__wasm_test_int64_minmax=N.sqlite3__wasm_test_int64_minmax)(i,n),o._sqlite3__wasm_test_int64ptr=i=>(o._sqlite3__wasm_test_int64ptr=N.sqlite3__wasm_test_int64ptr)(i),o._sqlite3__wasm_test_stack_overflow=i=>(o._sqlite3__wasm_test_stack_overflow=N.sqlite3__wasm_test_stack_overflow)(i),o._sqlite3__wasm_test_str_hello=i=>(o._sqlite3__wasm_test_str_hello=N.sqlite3__wasm_test_str_hello)(i),o._sqlite3__wasm_SQLTester_strglob=(i,n)=>(o._sqlite3__wasm_SQLTester_strglob=N.sqlite3__wasm_SQLTester_strglob)(i,n),o._malloc=i=>(o._malloc=N.malloc)(i),o._free=i=>(o._free=N.free)(i),o._realloc=(i,n)=>(o._realloc=N.realloc)(i,n);var yu=(i,n)=>(yu=N.emscripten_builtin_memalign)(i,n);o.wasmMemory=_t;var na,gu;vr=function i(){na||wu(),na||(vr=i)};function wu(){if(Wr>0||!gu&&(gu=1,Ut(),Wr>0))return;function i(){var n;na||(na=1,o.calledRun=1,!qr&&(_r(),p(o),(n=o.onRuntimeInitialized)==null||n.call(o),Ui()))}o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),i()},1)):i()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return wu(),o.runSQLite3PostLoadInit=function(i){if(globalThis.sqlite3ApiBootstrap=function n(a=globalThis.sqlite3ApiConfig||n.defaultConfig){if(n.sqlite3)return(n.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),n.sqlite3;const l=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof o<"u"&&o.HEAPU64?!0:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},a||{});Object.assign(l,{allocExportName:l.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:l.useStdAlloc?"free":"sqlite3_free",reallocExportName:l.useStdAlloc?"realloc":"sqlite3_realloc"},l),["exports","memory","wasmfsOpfsDir"].forEach(f=>{typeof l[f]=="function"&&(l[f]=l[f]())}),delete globalThis.sqlite3ApiConfig,delete n.defaultConfig;const c=Object.create(null),u=Object.create(null),w=f=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(f)||"Unknown result code #"+f,E=f=>typeof f=="number"&&f===(f|0);class j extends Error{constructor(...m){let A;if(m.length)if(E(m[0]))if(A=m[0],m.length===1)super(w(m[0]));else{const O=w(A);typeof m[1]=="object"?super(O,m[1]):(m[0]=O+":",super(m.join(" ")))}else m.length===2&&typeof m[1]=="object"?super(...m):super(m.join(" "));this.resultCode=A||c.SQLITE_ERROR,this.name="SQLite3Error"}}j.toss=(...f)=>{throw new j(...f)};const H=j.toss;l.wasmfsOpfsDir&&!/^\/[^/]+$/.test(l.wasmfsOpfsDir)&&H("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const oe=f=>typeof f!="bigint"&&f===(f|0)&&f<=2147483647&&f>=-2147483648,ce=function f(m){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),m>=f._min&&m<=f._max},Q=f=>f>=-0x7fffffffn-1n&&f<=0x7fffffffn,W=function f(m){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),m>=f._min&&m<=f._max},Y=f=>f&&f.constructor&&oe(f.constructor.BYTES_PER_ELEMENT)?f:!1,k=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,T=f=>f.buffer instanceof k,R=(f,m,A)=>T(f)?f.slice(m,A):f.subarray(m,A),B=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),G=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),F=f=>B(f)||H("Value is not of a supported TypedArray type."),X=new TextDecoder("utf-8"),ae=function(f,m,A){return X.decode(R(f,m,A))},_=function(f){return G(f)?ae(f instanceof ArrayBuffer?new Uint8Array(f):f):Array.isArray(f)?f.join(""):(u.isPtr(f)&&(f=u.cstrToJs(f)),f)};class x extends Error{constructor(...m){m.length===2&&typeof m[1]=="object"?super(...m):m.length?super(m.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}x.toss=(...f)=>{throw new x(...f)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,m,A,O,te,me,xe,Ie,Ae)=>{},sqlite3_create_function:(f,m,A,O,te,me,xe,Ie)=>{},sqlite3_create_window_function:(f,m,A,O,te,me,xe,Ie,Ae,ke)=>{},sqlite3_prepare_v3:(f,m,A,O,te,me)=>{},sqlite3_prepare_v2:(f,m,A,O,te)=>{},sqlite3_exec:(f,m,A,O,te)=>{},sqlite3_randomness:(f,m)=>{}});const I={affirmBindableTypedArray:F,flexibleString:_,bigIntFits32:Q,bigIntFits64:ce,bigIntFitsDouble:W,isBindableTypedArray:B,isInt32:oe,isSQLableTypedArray:G,isTypedArray:Y,typedArrayToString:ae,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:T,toss:function(...f){throw new Error(f.join(" "))},toss3:H,typedArrayPart:R,affirmDbHeader:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m="SQLite format 3";m.length>f.byteLength&&H("Input does not contain an SQLite3 database header.");for(let A=0;A<m.length;++A)m.charCodeAt(A)!==f[A]&&H("Input does not contain an SQLite3 database header.")},affirmIsDb:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m=f.byteLength;(m<512||m%512!==0)&&H("Byte array size",m,"is invalid for an SQLite3 db."),I.affirmDbHeader(f)}};Object.assign(u,{ptrSizeof:l.wasmPtrSizeof||4,ptrIR:l.wasmPtrIR||"i32",bigIntEnabled:!!l.bigIntEnabled,exports:l.exports||H("Missing API config.exports (WASM module exports)."),memory:l.memory||l.exports.memory||H("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),u.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),F(f);const m=u.alloc(f.byteLength||1);return u.heapForSize(f.constructor).set(f.byteLength?f:[0],m),m};{const f=l.allocExportName,m=l.deallocExportName,A=l.reallocExportName;for(const O of[f,m,A])u.exports[O]instanceof Function||H("Missing required exports[",O,"] function.");u.alloc=function O(te){return O.impl(te)||x.toss("Failed to allocate",te," bytes.")},u.alloc.impl=u.exports[f],u.realloc=function O(te,me){const xe=O.impl(te,me);return me?xe||x.toss("Failed to reallocate",me," bytes."):0},u.realloc.impl=u.exports[A],u.dealloc=u.exports[m]}u.compileOptionUsed=function f(m){if(arguments.length){if(Array.isArray(m)){const A={};return m.forEach(O=>{A[O]=c.sqlite3_compileoption_used(O)}),A}else if(typeof m=="object")return Object.keys(m).forEach(A=>{m[A]=c.sqlite3_compileoption_used(A)}),m}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(xe,Ie){const Ae=f._rx.exec(xe);Ie[0]=Ae?Ae[1]:xe,Ie[1]=Ae?f._rxInt.test(Ae[2])?+Ae[2]:Ae[2]:!0});const A={},O=[0,0];let te=0,me;for(;me=c.sqlite3_compileoption_get(te++);)f._opt(me,O),A[O[0]]=O[1];return f._result=A}return typeof m=="string"?!!c.sqlite3_compileoption_used(m):!1},u.pstack=Object.assign(Object.create(null),{restore:u.exports.sqlite3__wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=u.sizeofIR(f))&&x.toss("Invalid value for pstack.alloc(",arguments[0],")"),u.exports.sqlite3__wasm_pstack_alloc(f)||x.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,m){typeof m=="string"&&!(m=u.sizeofIR(m))&&x.toss("Invalid size value for allocChunks(",arguments[1],")");const A=u.pstack.alloc(f*m),O=[];let te=0,me=0;for(;te<f;++te,me+=m)O.push(A+me);return O},allocPtr:(f=1,m=!0)=>f===1?u.pstack.alloc(m?8:u.ptrSizeof):u.pstack.allocChunks(f,m?8:u.ptrSizeof),call:function(f){const m=u.pstack.pointer;try{return f(q)}finally{u.pstack.restore(m)}}}),Object.defineProperties(u.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_remaining}}),c.sqlite3_randomness=(...f)=>{if(f.length===1&&I.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const m=f[0];if(m.byteLength===0)return u.exports.sqlite3_randomness(0,0),m;const A=u.pstack.pointer;try{let O=m.byteLength,te=0;const me=u.exports.sqlite3_randomness,xe=u.heap8u(),Ie=O<512?O:512,Ae=u.pstack.alloc(Ie);do{const ke=O>Ie?Ie:O;me(ke,Ae),m.set(R(xe,Ae,Ae+ke),te),O-=ke,te+=ke}while(O>0)}catch(O){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",O)}finally{u.pstack.restore(A)}return m}u.exports.sqlite3_randomness(...f)};let re;if(c.sqlite3_wasmfs_opfs_dir=function(){if(re!==void 0)return re;const f=l.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return re="";try{return f&&u.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],f)===0?re=f:re=""}catch{return re=""}},c.sqlite3_wasmfs_filename_is_persistent=function(f){const m=c.sqlite3_wasmfs_opfs_dir();return m&&f?f.startsWith(m+"/"):!1},c.sqlite3_js_db_uses_vfs=function(f,m,A=0){try{const O=c.sqlite3_vfs_find(m);return O?f?O===c.sqlite3_js_db_vfs(f,A)?O:!1:O===c.sqlite3_vfs_find(0)?O:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const f=[];let m=c.sqlite3_vfs_find(0);for(;m;){const A=new c.sqlite3_vfs(m);f.push(u.cstrToJs(A.$zName)),m=A.$pNext,A.dispose()}return f},c.sqlite3_js_db_export=function(f,m=0){f=u.xWrap.testConvertArg("sqlite3*",f),f||H("Invalid sqlite3* argument."),u.bigIntEnabled||H("BigInt64 support is not enabled.");const A=u.scopedAllocPush();let O;try{const te=u.scopedAlloc(8+u.ptrSizeof),me=te+8,xe=m?u.isPtr(m)?m:u.scopedAllocCString(""+m):0;let Ie=u.exports.sqlite3__wasm_db_serialize(f,xe,me,te,0);Ie&&H("Database serialization failed with code",q.capi.sqlite3_js_rc_str(Ie)),O=u.peekPtr(me);const Ae=u.peek(te,"i64");return Ie=Ae?u.heap8u().slice(O,O+Number(Ae)):new Uint8Array,Ie}finally{O&&u.exports.sqlite3_free(O),u.scopedAllocPop(A)}},c.sqlite3_js_db_vfs=(f,m=0)=>I.sqlite3__wasm_db_vfs(f,m),c.sqlite3_js_aggregate_context=(f,m)=>c.sqlite3_aggregate_context(f,m)||(m?x.toss("Cannot allocate",m,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(f,m,A){let O;m&&u.isPtr(m)?O=m:m instanceof ArrayBuffer||m instanceof Uint8Array?(O=u.allocFromTypedArray(m),(arguments.length<3||!I.isInt32(A)||A<0)&&(A=m.byteLength)):j.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!I.isInt32(A)||A<0)&&j.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const te=I.sqlite3__wasm_posix_create_file(f,O,A);te&&j.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(te))}finally{u.dealloc(O)}},c.sqlite3_js_vfs_create_file=function(f,m,A,O){l.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let te;A?(u.isPtr(A)?te=A:A instanceof ArrayBuffer&&(A=new Uint8Array(A)),A instanceof Uint8Array?(te=u.allocFromTypedArray(A),(arguments.length<4||!I.isInt32(O)||O<0)&&(O=A.byteLength)):j.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):te=0,(!I.isInt32(O)||O<0)&&(u.dealloc(te),j.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const me=I.sqlite3__wasm_vfs_create_file(f,m,te,O);me&&j.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(me))}finally{u.dealloc(te)}},c.sqlite3_js_sql_to_string=f=>{if(typeof f=="string")return f;const m=_(v);return m===v?void 0:m},I.isUIThread()){const f=function(m){const A=Object.create(null);return A.prefix="kvvfs-"+m,A.stores=[],(m==="session"||m==="")&&A.stores.push(globalThis.sessionStorage),(m==="local"||m==="")&&A.stores.push(globalThis.localStorage),A};c.sqlite3_js_kvvfs_clear=function(m=""){let A=0;const O=f(m);return O.stores.forEach(te=>{const me=[];let xe;for(xe=0;xe<te.length;++xe){const Ie=te.key(xe);Ie.startsWith(O.prefix)&&me.push(Ie)}me.forEach(Ie=>te.removeItem(Ie)),A+=me.length}),A},c.sqlite3_js_kvvfs_size=function(m=""){let A=0;const O=f(m);return O.stores.forEach(te=>{let me;for(me=0;me<te.length;++me){const xe=te.key(me);xe.startsWith(O.prefix)&&(A+=xe.length,A+=te.getItem(xe).length)}}),A*2}}c.sqlite3_db_config=(function(f,m,...A){switch(m){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:case c.SQLITE_DBCONFIG_ENABLE_ATTACH_CREATE:case c.SQLITE_DBCONFIG_ENABLE_ATTACH_WRITE:case c.SQLITE_DBCONFIG_ENABLE_COMMENTS:return this.ip||(this.ip=u.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),this.ip(f,m,A[0],A[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii||(this.pii=u.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"])),this.pii(f,m,A[0],A[1],A[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s||(this.s=u.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"])),this.s(f,m,A[0]);default:return c.SQLITE_MISUSE}}).bind(Object.create(null)),c.sqlite3_value_to_js=function(f,m=!0){let A;const O=c.sqlite3_value_type(f);switch(O){case c.SQLITE_INTEGER:u.bigIntEnabled?(A=c.sqlite3_value_int64(f),I.bigIntFitsDouble(A)&&(A=Number(A))):A=c.sqlite3_value_double(f);break;case c.SQLITE_FLOAT:A=c.sqlite3_value_double(f);break;case c.SQLITE_TEXT:A=c.sqlite3_value_text(f);break;case c.SQLITE_BLOB:{const te=c.sqlite3_value_bytes(f),me=c.sqlite3_value_blob(f);te&&!me&&q.WasmAllocError.toss("Cannot allocate memory for blob argument of",te,"byte(s)"),A=te?u.heap8u().slice(me,me+Number(te)):null;break}case c.SQLITE_NULL:A=null;break;default:m&&H(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",O),A=void 0}return A},c.sqlite3_values_to_js=function(f,m,A=!0){let O;const te=[];for(O=0;O<f;++O)te.push(c.sqlite3_value_to_js(u.peekPtr(m+u.ptrSizeof*O),A));return te},c.sqlite3_result_error_js=function(f,m){m instanceof x?c.sqlite3_result_error_nomem(f):c.sqlite3_result_error(f,""+m,-1)},c.sqlite3_result_js=function(f,m){if(m instanceof Error){c.sqlite3_result_error_js(f,m);return}try{switch(typeof m){case"undefined":break;case"boolean":c.sqlite3_result_int(f,m?1:0);break;case"bigint":I.bigIntFits32(m)?c.sqlite3_result_int(f,Number(m)):I.bigIntFitsDouble(m)?c.sqlite3_result_double(f,Number(m)):u.bigIntEnabled?I.bigIntFits64(m)?c.sqlite3_result_int64(f,m):H("BigInt value",m.toString(),"is too BigInt for int64."):H("BigInt value",m.toString(),"is too BigInt.");break;case"number":{let A;I.isInt32(m)?A=c.sqlite3_result_int:u.bigIntEnabled&&Number.isInteger(m)&&I.bigIntFits64(BigInt(m))?A=c.sqlite3_result_int64:A=c.sqlite3_result_double,A(f,m);break}case"string":{const[A,O]=u.allocCString(m,!0);c.sqlite3_result_text(f,A,O,c.SQLITE_WASM_DEALLOC);break}case"object":if(m===null){c.sqlite3_result_null(f);break}else if(I.isBindableTypedArray(m)){const A=u.allocFromTypedArray(m);c.sqlite3_result_blob(f,A,m.byteLength,c.SQLITE_WASM_DEALLOC);break}default:H("Don't not how to handle this UDF result value:",typeof m,m)}}catch(A){c.sqlite3_result_error_js(f,A)}},c.sqlite3_column_js=function(f,m,A=!0){const O=c.sqlite3_column_value(f,m);return O===0?void 0:c.sqlite3_value_to_js(O,A)};const y=(function(f,m,A){A=c[A],this.ptr?u.pokePtr(this.ptr,0):this.ptr=u.allocPtr();const O=A(f,m,this.ptr);if(O)return j.toss(O,arguments[2]+"() failed with code "+O);const te=u.peekPtr(this.ptr);return te?c.sqlite3_value_to_js(te,!0):void 0}).bind(Object.create(null));c.sqlite3_preupdate_new_js=(f,m)=>y(f,m,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(f,m)=>y(f,m,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(f,m)=>y(f,m,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(f,m)=>y(f,m,"sqlite3changeset_old");const q={WasmAllocError:x,SQLite3Error:j,capi:c,util:I,wasm:u,config:l,version:Object.create(null),client:void 0,asyncPostInit:async function f(){if(f.isReady instanceof Promise)return f.isReady;let m=n.initializersAsync;delete n.initializersAsync;const A=async()=>(q.__isUnderTest||(delete q.util,delete q.StructBinder),q),O=me=>{throw l.error("an async sqlite3 initializer failed:",me),me};if(!m||!m.length)return f.isReady=A().catch(O);m=m.map(me=>me instanceof Function?async xe=>me(q):me),m.push(A);let te=Promise.resolve(q);for(;m.length;)te=te.then(m.shift());return f.isReady=te.catch(O)},scriptInfo:void 0};try{n.initializers.forEach(f=>{f(q)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}return delete n.initializers,n.sqlite3=q,q},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(n){n.bigIntEnabled===void 0&&(n.bigIntEnabled=!!globalThis.BigInt64Array);const a=(..._)=>{throw new Error(_.join(" "))};n.exports||Object.defineProperty(n,"exports",{enumerable:!0,configurable:!0,get:()=>n.instance&&n.instance.exports});const l=n.pointerIR||"i32",c=n.ptrSizeof=l==="i32"?4:l==="i64"?8:a("Unhandled ptrSizeof:",l),u=Object.create(null);u.heapSize=0,u.memory=null,u.freeFuncIndexes=[],u.scopedAlloc=[],u.utf8Decoder=new TextDecoder,u.utf8Encoder=new TextEncoder("utf-8"),n.sizeofIR=_=>{switch(_){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+_).endsWith("*")?c:void 0}};const w=function(){if(!u.memory)u.memory=n.memory instanceof WebAssembly.Memory?n.memory:n.exports.memory;else if(u.heapSize===u.memory.buffer.byteLength)return u;const _=u.memory.buffer;return u.HEAP8=new Int8Array(_),u.HEAP8U=new Uint8Array(_),u.HEAP16=new Int16Array(_),u.HEAP16U=new Uint16Array(_),u.HEAP32=new Int32Array(_),u.HEAP32U=new Uint32Array(_),n.bigIntEnabled&&(u.HEAP64=new BigInt64Array(_),u.HEAP64U=new BigUint64Array(_)),u.HEAP32F=new Float32Array(_),u.HEAP64F=new Float64Array(_),u.heapSize=_.byteLength,u};n.heap8=()=>w().HEAP8,n.heap8u=()=>w().HEAP8U,n.heap16=()=>w().HEAP16,n.heap16u=()=>w().HEAP16U,n.heap32=()=>w().HEAP32,n.heap32u=()=>w().HEAP32U,n.heapForSize=function(_,x=!0){const I=u.memory&&u.heapSize===u.memory.buffer.byteLength?u:w();switch(_){case Int8Array:return I.HEAP8;case Uint8Array:return I.HEAP8U;case Int16Array:return I.HEAP16;case Uint16Array:return I.HEAP16U;case Int32Array:return I.HEAP32;case Uint32Array:return I.HEAP32U;case 8:return x?I.HEAP8U:I.HEAP8;case 16:return x?I.HEAP16U:I.HEAP16;case 32:return x?I.HEAP32U:I.HEAP32;case 64:if(I.HEAP64)return x?I.HEAP64U:I.HEAP64;break;default:if(n.bigIntEnabled){if(_===globalThis.BigUint64Array)return I.HEAP64U;if(_===globalThis.BigInt64Array)return I.HEAP64;break}}a("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},n.functionTable=function(){return n.exports.__indirect_function_table},n.functionEntry=function(_){const x=n.functionTable();return _<x.length?x.get(_):void 0},n.jsFuncToWasm=function _(x,I){if(_._||(_._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(q,f,m){m<128?q[f](m):q[f](m%128|128,m>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(q){const f=_._.rxJSig.exec(q);return f?f[2]:q.substr(1)},letterType:q=>_._.sigTypes[q]||a("Invalid signature letter:",q),pushSigType:(q,f)=>q.push(_._.typeCodes[_._.letterType(f)])}),typeof x=="string"){const q=I;I=x,x=q}const re=_._.sigParams(I),y=[1,96];_._.uleb128Encode(y,"push",re.length);for(const q of re)_._.pushSigType(y,q);return I[0]==="v"?y.push(0):(y.push(1),_._.pushSigType(y,I[0])),_._.uleb128Encode(y,"unshift",y.length),y.unshift(0,97,115,109,1,0,0,0,1),y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(y)),{e:{f:x}}).exports.f};const E=function(x,I,re){if(re&&!u.scopedAlloc.length&&a("No scopedAllocPush() scope is active."),typeof x=="string"){const m=I;I=x,x=m}(typeof I!="string"||!(x instanceof Function))&&a("Invalid arguments: expecting (function,signature) or (signature,function).");const y=n.functionTable(),q=y.length;let f;for(;u.freeFuncIndexes.length&&(f=u.freeFuncIndexes.pop(),y.get(f));){f=null;continue}f||(f=q,y.grow(1));try{return y.set(f,x),re&&u.scopedAlloc[u.scopedAlloc.length-1].push(f),f}catch(m){if(!(m instanceof TypeError))throw f===q&&u.freeFuncIndexes.push(q),m}try{const m=n.jsFuncToWasm(x,I);y.set(f,m),re&&u.scopedAlloc[u.scopedAlloc.length-1].push(f)}catch(m){throw f===q&&u.freeFuncIndexes.push(q),m}return f};n.installFunction=(_,x)=>E(_,x,!1),n.scopedInstallFunction=(_,x)=>E(_,x,!0),n.uninstallFunction=function(_){if(!_&&_!==0)return;const x=u.freeFuncIndexes,I=n.functionTable();x.push(_);const re=I.get(_);return I.set(_,null),re},n.peek=function(x,I="i8"){I.endsWith("*")&&(I=l);const re=u.memory&&u.heapSize===u.memory.buffer.byteLength?u:w(),y=Array.isArray(x)?[]:void 0;let q;do{switch(y&&(x=arguments[0].shift()),I){case"i1":case"i8":q=re.HEAP8[x>>0];break;case"i16":q=re.HEAP16[x>>1];break;case"i32":q=re.HEAP32[x>>2];break;case"float":case"f32":q=re.HEAP32F[x>>2];break;case"double":case"f64":q=Number(re.HEAP64F[x>>3]);break;case"i64":if(n.bigIntEnabled){q=BigInt(re.HEAP64[x>>3]);break}default:a("Invalid type for peek():",I)}y&&y.push(q)}while(y&&arguments[0].length);return y||q},n.poke=function(_,x,I="i8"){I.endsWith("*")&&(I=l);const re=u.memory&&u.heapSize===u.memory.buffer.byteLength?u:w();for(const y of Array.isArray(_)?_:[_])switch(I){case"i1":case"i8":re.HEAP8[y>>0]=x;continue;case"i16":re.HEAP16[y>>1]=x;continue;case"i32":re.HEAP32[y>>2]=x;continue;case"float":case"f32":re.HEAP32F[y>>2]=x;continue;case"double":case"f64":re.HEAP64F[y>>3]=x;continue;case"i64":if(re.HEAP64){re.HEAP64[y>>3]=BigInt(x);continue}default:a("Invalid type for poke(): "+I)}return this},n.peekPtr=(..._)=>n.peek(_.length===1?_[0]:_,l),n.pokePtr=(_,x=0)=>n.poke(_,x,l),n.peek8=(..._)=>n.peek(_.length===1?_[0]:_,"i8"),n.poke8=(_,x)=>n.poke(_,x,"i8"),n.peek16=(..._)=>n.peek(_.length===1?_[0]:_,"i16"),n.poke16=(_,x)=>n.poke(_,x,"i16"),n.peek32=(..._)=>n.peek(_.length===1?_[0]:_,"i32"),n.poke32=(_,x)=>n.poke(_,x,"i32"),n.peek64=(..._)=>n.peek(_.length===1?_[0]:_,"i64"),n.poke64=(_,x)=>n.poke(_,x,"i64"),n.peek32f=(..._)=>n.peek(_.length===1?_[0]:_,"f32"),n.poke32f=(_,x)=>n.poke(_,x,"f32"),n.peek64f=(..._)=>n.peek(_.length===1?_[0]:_,"f64"),n.poke64f=(_,x)=>n.poke(_,x,"f64"),n.getMemValue=n.peek,n.getPtrValue=n.peekPtr,n.setMemValue=n.poke,n.setPtrValue=n.pokePtr,n.isPtr32=_=>typeof _=="number"&&_===(_|0)&&_>=0,n.isPtr=n.isPtr32,n.cstrlen=function(_){if(!_||!n.isPtr(_))return null;const x=w().HEAP8U;let I=_;for(;x[I]!==0;++I);return I-_};const j=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,H=function(_,x,I){return u.utf8Decoder.decode(_.buffer instanceof j?_.slice(x,I):_.subarray(x,I))};n.cstrToJs=function(_){const x=n.cstrlen(_);return x?H(w().HEAP8U,_,_+x):x===null?x:""},n.jstrlen=function(_){if(typeof _!="string")return null;const x=_.length;let I=0;for(let re=0;re<x;++re){let y=_.charCodeAt(re);y>=55296&&y<=57343&&(y=65536+((y&1023)<<10)|_.charCodeAt(++re)&1023),y<=127?++I:y<=2047?I+=2:y<=65535?I+=3:I+=4}return I},n.jstrcpy=function(_,x,I=0,re=-1,y=!0){if((!x||!(x instanceof Int8Array)&&!(x instanceof Uint8Array))&&a("jstrcpy() target must be an Int8Array or Uint8Array."),re<0&&(re=x.length-I),!(re>0)||!(I>=0))return 0;let q=0,f=_.length;const m=I,A=I+re-(y?1:0);for(;q<f&&I<A;++q){let O=_.charCodeAt(q);if(O>=55296&&O<=57343&&(O=65536+((O&1023)<<10)|_.charCodeAt(++q)&1023),O<=127){if(I>=A)break;x[I++]=O}else if(O<=2047){if(I+1>=A)break;x[I++]=192|O>>6,x[I++]=128|O&63}else if(O<=65535){if(I+2>=A)break;x[I++]=224|O>>12,x[I++]=128|O>>6&63,x[I++]=128|O&63}else{if(I+3>=A)break;x[I++]=240|O>>18,x[I++]=128|O>>12&63,x[I++]=128|O>>6&63,x[I++]=128|O&63}}return y&&(x[I++]=0),I-m},n.cstrncpy=function(_,x,I){if((!_||!x)&&a("cstrncpy() does not accept NULL strings."),I<0)I=n.cstrlen(strPtr)+1;else if(!(I>0))return 0;const re=n.heap8u();let y=0,q;for(;y<I&&(q=re[x+y]);++y)re[_+y]=q;return y<I&&(re[_+y++]=0),y},n.jstrToUintArray=(_,x=!1)=>u.utf8Encoder.encode(x?_+"\0":_);const oe=(_,x)=>{(!(_.alloc instanceof Function)||!(_.dealloc instanceof Function))&&a("Object is missing alloc() and/or dealloc() function(s)","required by",x+"().")},ce=function(_,x,I,re){if(oe(n,re),typeof _!="string")return null;{const y=u.utf8Encoder.encode(_),q=I(y.length+1),f=w().HEAP8U;return f.set(y,q),f[q+y.length]=0,x?[q,y.length]:q}};n.allocCString=(_,x=!1)=>ce(_,x,n.alloc,"allocCString()"),n.scopedAllocPush=function(){oe(n,"scopedAllocPush");const _=[];return u.scopedAlloc.push(_),_},n.scopedAllocPop=function(_){oe(n,"scopedAllocPop");const x=arguments.length?u.scopedAlloc.indexOf(_):u.scopedAlloc.length-1;x<0&&a("Invalid state object for scopedAllocPop()."),arguments.length===0&&(_=u.scopedAlloc[x]),u.scopedAlloc.splice(x,1);for(let I;I=_.pop();)n.functionEntry(I)?n.uninstallFunction(I):n.dealloc(I)},n.scopedAlloc=function(_){u.scopedAlloc.length||a("No scopedAllocPush() scope is active.");const x=n.alloc(_);return u.scopedAlloc[u.scopedAlloc.length-1].push(x),x},Object.defineProperty(n.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>u.scopedAlloc.length,set:()=>a("The 'active' property is read-only.")}),n.scopedAllocCString=(_,x=!1)=>ce(_,x,n.scopedAlloc,"scopedAllocCString()");const Q=function(_,x){const I=n[_?"scopedAlloc":"alloc"]((x.length+1)*n.ptrSizeof);let re=0;return x.forEach(y=>{n.pokePtr(I+n.ptrSizeof*re++,n[_?"scopedAllocCString":"allocCString"](""+y))}),n.pokePtr(I+n.ptrSizeof*re,0),I};n.scopedAllocMainArgv=_=>Q(!0,_),n.allocMainArgv=_=>Q(!1,_),n.cArgvToJs=(_,x)=>{const I=[];for(let re=0;re<_;++re){const y=n.peekPtr(x+n.ptrSizeof*re);I.push(y?n.cstrToJs(y):null)}return I},n.scopedAllocCall=function(_){n.scopedAllocPush();try{return _()}finally{n.scopedAllocPop()}};const W=function(_,x,I){oe(n,I);const re=x?"i64":l;let y=n[I](_*(x?8:c));if(n.poke(y,0,re),_===1)return y;const q=[y];for(let f=1;f<_;++f)y+=x?8:c,q[f]=y,n.poke(y,0,re);return q};n.allocPtr=(_=1,x=!0)=>W(_,x,"alloc"),n.scopedAllocPtr=(_=1,x=!0)=>W(_,x,"scopedAlloc"),n.xGet=function(_){return n.exports[_]||a("Cannot find exported symbol:",_)};const Y=(_,x)=>a(_+"() requires",x,"argument(s).");n.xCall=function(_,...x){const I=_ instanceof Function?_:n.xGet(_);return I instanceof Function||a("Exported symbol",_,"is not a function."),I.length!==x.length&&Y(I===_?I.name:_,I.length),arguments.length===2&&Array.isArray(arguments[1])?I.apply(null,arguments[1]):I.apply(null,x)},u.xWrap=Object.create(null),u.xWrap.convert=Object.create(null),u.xWrap.convert.arg=new Map,u.xWrap.convert.result=new Map;const k=u.xWrap.convert.arg,T=u.xWrap.convert.result;n.bigIntEnabled&&k.set("i64",_=>BigInt(_));const R=l==="i32"?_=>_|0:_=>BigInt(_)|BigInt(0);k.set("i32",R).set("i16",_=>(_|0)&65535).set("i8",_=>(_|0)&255).set("f32",_=>Number(_).valueOf()).set("float",k.get("f32")).set("f64",k.get("f32")).set("double",k.get("f64")).set("int",k.get("i32")).set("null",_=>_).set(null,k.get("null")).set("**",R).set("*",R),T.set("*",R).set("pointer",R).set("number",_=>Number(_)).set("void",_=>{}).set("null",_=>_).set(null,T.get("null"));{const _=["i8","i16","i32","int","f32","float","f64","double"];n.bigIntEnabled&&_.push("i64");const x=k.get(l);for(const I of _)k.set(I+"*",x),T.set(I+"*",x),T.set(I,k.get(I)||a("Missing arg converter:",I))}const B=function(_){return typeof _=="string"?n.scopedAllocCString(_):_?R(_):null};k.set("string",B).set("utf8",B).set("pointer",B),T.set("string",_=>n.cstrToJs(_)).set("utf8",T.get("string")).set("string:dealloc",_=>{try{return _?n.cstrToJs(_):null}finally{n.dealloc(_)}}).set("utf8:dealloc",T.get("string:dealloc")).set("json",_=>JSON.parse(n.cstrToJs(_))).set("json:dealloc",_=>{try{return _?JSON.parse(n.cstrToJs(_)):null}finally{n.dealloc(_)}});const G=class{constructor(_){this.name=_.name||"unnamed adapter"}convertArg(_,x,I){a("AbstractArgAdapter must be subclassed.")}};k.FuncPtrAdapter=class yi extends G{constructor(x){super(x),k.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",x),this.name=x.name||"unnamed",this.signature=x.signature,x.contextKey instanceof Function&&(this.contextKey=x.contextKey,x.bindScope||(x.bindScope="context")),this.bindScope=x.bindScope||a("FuncPtrAdapter options requires a bindScope (explicit or implied)."),yi.bindScopes.indexOf(x.bindScope)<0&&a("Invalid options.bindScope ("+x.bindMod+") for FuncPtrAdapter. Expecting one of: ("+yi.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=x.callProxy instanceof Function?x.callProxy:void 0}contextKey(x,I){return this}contextMap(x){const I=this.__cmap||(this.__cmap=new Map);let re=I.get(x);return re===void 0&&I.set(x,re=[]),re}convertArg(x,I,re){let y=this.singleton;if(!y&&this.isContext&&(y=this.contextMap(this.contextKey(I,re))),y&&y[0]===x)return y[1];if(x instanceof Function){this.callProxy&&(x=this.callProxy(x));const q=E(x,this.signature,this.isTransient);if(yi.debugFuncInstall&&yi.debugOut("FuncPtrAdapter installed",this,this.contextKey(I,re),"@"+q,x),y){if(y[1]){yi.debugFuncInstall&&yi.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(I,re),"@"+y[1],x);try{u.scopedAlloc[u.scopedAlloc.length-1].push(y[1])}catch{}}y[0]=x,y[1]=q}return q}else if(n.isPtr(x)||x===null||x===void 0){if(y&&y[1]&&y[1]!==x){yi.debugFuncInstall&&yi.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(I,re),"@"+y[1],x);try{u.scopedAlloc[u.scopedAlloc.length-1].push(y[1])}catch{}y[0]=y[1]=x|0}return x||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},k.FuncPtrAdapter.warnOnUse=!1,k.FuncPtrAdapter.debugFuncInstall=!1,k.FuncPtrAdapter.debugOut=console.debug.bind(console),k.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const F=_=>k.get(_)||a("Argument adapter not found:",_),X=_=>T.get(_)||a("Result adapter not found:",_);u.xWrap.convertArg=(_,...x)=>F(_)(...x),u.xWrap.convertArgNoCheck=(_,...x)=>k.get(_)(...x),u.xWrap.convertResult=(_,x)=>_===null?x:_?X(_)(x):void 0,u.xWrap.convertResultNoCheck=(_,x)=>_===null?x:_?T.get(_)(x):void 0,n.xWrap=function(_,x,...I){arguments.length===3&&Array.isArray(arguments[2])&&(I=arguments[2]),n.isPtr(_)&&(_=n.functionEntry(_)||a("Function pointer not found in WASM function table."));const re=_ instanceof Function,y=re?_:n.xGet(_);if(re&&(_=y.name||"unnamed function"),I.length!==y.length&&Y(_,y.length),x===null&&y.length===0)return y;x!=null&&X(x);for(const f of I)f instanceof G?k.set(f,(...m)=>f.convertArg(...m)):F(f);const q=u.xWrap;return y.length===0?(...f)=>f.length?Y(_,y.length):q.convertResult(x,y.call(null)):function(...f){f.length!==y.length&&Y(_,y.length);const m=n.scopedAllocPush();try{let A=0;for(;A<f.length;++A)f[A]=q.convertArgNoCheck(I[A],f[A],f,A);return q.convertResultNoCheck(x,y.apply(null,f))}finally{n.scopedAllocPop(m)}}};const ae=function(_,x,I,re,y,q){if(typeof I=="string"){if(x===1)return q.get(I);if(x===2){if(re)re instanceof Function||a(y,"requires a function argument.");else return q.delete(I),_;return q.set(I,re),_}}a("Invalid arguments to",y)};return n.xWrap.resultAdapter=function _(x,I){return ae(_,arguments.length,x,I,"resultAdapter()",T)},n.xWrap.argAdapter=function _(x,I){return ae(_,arguments.length,x,I,"argAdapter()",k)},n.xWrap.FuncPtrAdapter=k.FuncPtrAdapter,n.xCallWrapped=function(_,x,I,...re){return Array.isArray(arguments[3])&&(re=arguments[3]),n.xWrap(_,x,I||[]).apply(null,re||[])},n.xWrap.testConvertArg=u.xWrap.convertArg,n.xWrap.testConvertResult=u.xWrap.convertResult,n},globalThis.WhWasmUtilInstaller.yawl=(function(n){const a=()=>fetch(n.uri,{credentials:"same-origin"}),l=this,c=function(w){if(n.wasmUtilTarget){const E=(...H)=>{throw new Error(H.join(" "))},j=n.wasmUtilTarget;if(j.module=w.module,j.instance=w.instance,j.instance.exports.memory||(j.memory=n.imports&&n.imports.env&&n.imports.env.memory||E("Missing 'memory' object!")),!j.alloc&&w.instance.exports.malloc){const H=w.instance.exports;j.alloc=function(oe){return H.malloc(oe)||E("Allocation of",oe,"bytes failed.")},j.dealloc=function(oe){H.free(oe)}}l(j)}return n.onload&&n.onload(w,n),w};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(a(),n.imports||{}).then(c)}:function(){return a().then(E=>E.arrayBuffer()).then(E=>WebAssembly.instantiate(E,n.imports||{})).then(c)}}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function n(a){const l=(...g)=>{throw new Error(g.join(" "))};!(a.heap instanceof WebAssembly.Memory)&&!(a.heap instanceof Function)&&l("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(g){a[g]instanceof Function||l("Config option '"+g+"' must be a function.")});const c=n,u=a.heap instanceof Function?a.heap:()=>new Uint8Array(a.heap.buffer),w=a.alloc,E=a.dealloc,j=a.log||console.log.bind(console),H=a.memberPrefix||"",oe=a.memberSuffix||"",ce=a.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!a.bigIntEnabled,Q=globalThis.BigInt,W=globalThis.BigInt64Array,Y=a.ptrSizeof||4,k=a.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(g=null){g&&g.__flags&&(g=g.__flags);const P=function D(K){return arguments.length===0?D.__flags:(K<0?(delete D.__flags.getter,delete D.__flags.setter,delete D.__flags.alloc,delete D.__flags.dealloc):(D.__flags.getter=(1&K)!==0,D.__flags.setter=(2&K)!==0,D.__flags.alloc=(4&K)!==0,D.__flags.dealloc=(8&K)!==0),D._flags)};return Object.defineProperty(P,"__flags",{iterable:!1,writable:!1,value:Object.create(g)}),g||P(0),P},c.debugFlags=c.__makeDebugFlags());const T=function(){const g=new ArrayBuffer(2);return new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256}(),R=g=>g[1]==="(",B=g=>g==="P",G=g=>R(g)?"p":g[0],F=function(g){switch(G(g)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return k;case"j":return"i64";case"f":return"float";case"d":return"double"}l("Unhandled signature IR:",g)},X=W?()=>!0:()=>l("BigInt64Array is not available."),ae=function(g){switch(G(g)){case"p":case"P":case"s":{switch(Y){case 4:return"getInt32";case 8:return X()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return X()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}l("Unhandled DataView getter for signature:",g)},_=function(g){switch(G(g)){case"p":case"P":case"s":{switch(Y){case 4:return"setInt32";case 8:return X()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return X()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}l("Unhandled DataView setter for signature:",g)},x=function(g){switch(G(g)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return X()&&Q;case"p":case"P":case"s":switch(Y){case 4:return Number;case 8:return X()&&Q}break}l("Unhandled DataView set wrapper for signature:",g)},I=(g,P)=>g+"::"+P,re=function(g,P){return()=>l(I(g,P),"is read-only.")},y=new WeakMap,q="(pointer-is-external)",f=function(g,P,D){if(D||(D=y.get(P)),D){if(y.delete(P),Array.isArray(P.ondispose)){let K;for(;K=P.ondispose.shift();)try{K instanceof Function?K.call(P):K instanceof de?K.dispose():typeof K=="number"&&E(K)}catch(pe){console.warn("ondispose() for",g.structName,"@",D,"threw. NOT propagating it.",pe)}}else if(P.ondispose instanceof Function)try{P.ondispose()}catch(K){console.warn("ondispose() for",g.structName,"@",D,"threw. NOT propagating it.",K)}delete P.ondispose,g.debugFlags.__flags.dealloc&&j("debug.dealloc:",P[q]?"EXTERNAL":"",g.structName,"instance:",g.structInfo.sizeof,"bytes @"+D),P[q]||E(D)}},m=g=>({configurable:!1,writable:!1,iterable:!1,value:g}),A=function(g,P,D){let K=!D;D?Object.defineProperty(P,q,m(D)):(D=w(g.structInfo.sizeof),D||l("Allocation of",g.structName,"structure failed."));try{g.debugFlags.__flags.alloc&&j("debug.alloc:",K?"":"EXTERNAL",g.structName,"instance:",g.structInfo.sizeof,"bytes @"+D),K&&u().fill(0,D,D+g.structInfo.sizeof),y.set(P,D)}catch(pe){throw f(g,P,D),pe}},O=function(){const g=this.pointer;return g?new Uint8Array(u().slice(g,g+this.structInfo.sizeof)):null},me=m(g=>H+g+oe),xe=function(g,P,D=!0){let K=g.members[P];if(!K&&(H||oe)){for(const pe of Object.values(g.members))if(pe.key===P){K=pe;break}!K&&D&&l(I(g.name,P),"is not a mapped struct member.")}return K},Ie=function g(P,D,K=!1){g._||(g._=ve=>ve.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const pe=xe(P.structInfo,D,!0);return K?g._(pe.signature):pe.signature},Ae={configurable:!1,enumerable:!1,get:function(){return y.get(this)},set:()=>l("Cannot assign the 'pointer' property of a struct.")},ke=m(function(){const g=[];for(const P of Object.keys(this.structInfo.members))g.push(this.memberKey(P));return g}),Pe=new TextDecoder("utf-8"),Re=new TextEncoder,Je=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,Ge=function(g,P,D){return Pe.decode(g.buffer instanceof Je?g.slice(P,D):g.subarray(P,D))},Bt=function(g,P,D=!1){const K=xe(g.structInfo,P,D);return K&&K.signature.length===1&&K.signature[0]==="s"?K:!1},lt=function(g){g.signature!=="s"&&l("Invalid member type signature for C-string value:",JSON.stringify(g))},M=function(P,D){const K=xe(P.structInfo,D,!0);lt(K);const pe=P[K.key];if(!pe)return null;let ve=pe;const Fe=u();for(;Fe[ve]!==0;++ve);return pe===ve?"":Ge(Fe,pe,ve)},Z=function(g,...P){g.ondispose?Array.isArray(g.ondispose)||(g.ondispose=[g.ondispose]):g.ondispose=[],g.ondispose.push(...P)},ie=function(g){const P=Re.encode(g),D=w(P.length+1);D||l("Allocation error while duplicating string:",g);const K=u();return K.set(P,D),K[D+P.length]=0,D},_e=function(g,P,D){const K=xe(g.structInfo,P,!0);lt(K);const pe=ie(D);return g[K.key]=pe,Z(g,pe),g},de=function(P,D){arguments[2]!==m&&l("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:m(P),structInfo:m(D)})};de.prototype=Object.create(null,{dispose:m(function(){f(this.constructor,this)}),lookupMember:m(function(g,P=!0){return xe(this.structInfo,g,P)}),memberToJsString:m(function(g){return M(this,g)}),memberIsString:m(function(g,P=!0){return Bt(this,g,P)}),memberKey:me,memberKeys:ke,memberSignature:m(function(g,P=!1){return Ie(this,g,P)}),memoryDump:m(O),pointer:Ae,setMemberCString:m(function(g,P){return _e(this,g,P)})}),Object.assign(de.prototype,{addOnDispose:function(...g){return Z(this,...g),this}}),Object.defineProperties(de,{allocCString:m(ie),isA:m(g=>g instanceof de),hasExternalPointer:m(g=>g instanceof de&&!!g[q]),memberKey:me});const we=g=>Number.isFinite(g)||g instanceof(Q||Number),ee=function g(P,D,K){if(!g._){g._={getters:{},setters:{},sw:{}};const Jt=["i","c","C","p","P","s","f","d","v()"];ce&&Jt.push("j"),Jt.forEach(function(Kr){g._.getters[Kr]=ae(Kr),g._.setters[Kr]=_(Kr),g._.sw[Kr]=x(Kr)});const Ip=/^[ipPsjfdcC]$/,Tp=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;g.sigCheck=function(Kr,Cp,bu,Cl){Object.prototype.hasOwnProperty.call(Kr,bu)&&l(Kr.structName,"already has a property named",bu+"."),Ip.test(Cl)||Tp.test(Cl)||l("Malformed signature for",I(Kr.structName,Cp)+":",Cl)}}const pe=P.memberKey(D);g.sigCheck(P.prototype,D,pe,K.signature),K.key=pe,K.name=D;const ve=G(K.signature),Fe=I(P.prototype.structName,pe),je=P.prototype.debugFlags.__flags,mr=Object.create(null);mr.configurable=!1,mr.enumerable=!1,mr.get=function(){je.getter&&j("debug.getter:",g._.getters[ve],"for",F(ve),Fe,"@",this.pointer,"+",K.offset,"sz",K.sizeof);let Jt=new DataView(u().buffer,this.pointer+K.offset,K.sizeof)[g._.getters[ve]](0,T);return je.getter&&j("debug.getter:",Fe,"result =",Jt),Jt},K.readOnly?mr.set=re(P.prototype.structName,pe):mr.set=function(Jt){if(je.setter&&j("debug.setter:",g._.setters[ve],"for",F(ve),Fe,"@",this.pointer,"+",K.offset,"sz",K.sizeof,Jt),this.pointer||l("Cannot set struct property on disposed instance."),Jt===null)Jt=0;else for(;!we(Jt);){if(B(K.signature)&&Jt instanceof de){Jt=Jt.pointer||0,je.setter&&j("debug.setter:",Fe,"resolved to",Jt);break}l("Invalid value for pointer-type",Fe+".")}new DataView(u().buffer,this.pointer+K.offset,K.sizeof)[g._.setters[ve]](0,g._.sw[ve](Jt),T)},Object.defineProperty(P.prototype,pe,mr)},b=function g(P,D){arguments.length===1?(D=P,P=D.name):D.name||(D.name=P),P||l("Struct name is required.");let K=!1;Object.keys(D.members).forEach(Fe=>{const je=D.members[Fe];je.sizeof?je.sizeof===1?je.signature==="c"||je.signature==="C"||l("Unexpected sizeof==1 member",I(D.name,Fe),"with signature",je.signature):(je.sizeof%4!==0&&(console.warn("Invalid struct member description =",je,"from",D),l(P,"member",Fe,"sizeof is not aligned. sizeof="+je.sizeof)),je.offset%4!==0&&(console.warn("Invalid struct member description =",je,"from",D),l(P,"member",Fe,"offset is not aligned. offset="+je.offset))):l(P,"member",Fe,"is missing sizeof."),(!K||K.offset<je.offset)&&(K=je)}),K?D.sizeof<K.offset+K.sizeof&&l("Invalid struct config:",P,"max member offset ("+K.offset+") ","extends past end of struct (sizeof="+D.sizeof+")."):l("No member property descriptions found.");const pe=m(c.__makeDebugFlags(g.debugFlags)),ve=function Fe(je){this instanceof Fe?arguments.length?((je!==(je|0)||je<=0)&&l("Invalid pointer value for",P,"constructor."),A(Fe,this,je)):A(Fe,this):l("The",P,"constructor may only be called via 'new'.")};return Object.defineProperties(ve,{debugFlags:pe,isA:m(Fe=>Fe instanceof ve),memberKey:me,memberKeys:ke,methodInfoForKey:m(function(Fe){}),structInfo:m(D),structName:m(P)}),ve.prototype=new de(P,D,m),Object.defineProperties(ve.prototype,{debugFlags:pe,constructor:m(ve)}),Object.keys(D.members).forEach(Fe=>ee(ve,Fe,D.members[Fe])),ve};return b.StructType=de,b.config=a,b.allocCString=ie,b.debugFlags||(b.debugFlags=c.__makeDebugFlags(c.debugFlags)),b},globalThis.sqlite3ApiBootstrap.initializers.push(function(n){const a=(...k)=>{throw new Error(k.join(" "))};n.SQLite3Error.toss;const l=n.capi,c=n.wasm,u=n.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_parameter_name","string","sqlite3_stmt*","int"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(k,T)=>k[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_decltype","string","sqlite3_stmt*","int"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:k=>k[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_readonly","int","sqlite3*","string"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:k=>{let T;return(R,B,G,F)=>{try{const X=c.cArgvToJs(B,G);return T||(T=c.cArgvToJs(B,F)),k(X,T)|0}catch(X){return X.resultCode||l.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_interrupt",void 0,"sqlite3*"],["sqlite3_is_interrupted","int","sqlite3*"],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:k=>k[0]}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*","*"]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_busy","int","sqlite3_stmt*"],["sqlite3_stmt_readonly","int","sqlite3_stmt*"],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(k,T)=>k[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_progress_handler&&c.bindingSignatures.push(["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(k,T)=>k[0]}),"*"]]),c.exports.sqlite3_stmt_explain&&c.bindingSignatures.push(["sqlite3_stmt_explain","int","sqlite3_stmt*","int"],["sqlite3_stmt_isexplain","int","sqlite3_stmt*"]),c.exports.sqlite3_set_authorizer&&c.bindingSignatures.push(["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(k,T)=>k[0],callProxy:k=>(T,R,B,G,F,X)=>{try{return B=B&&c.cstrToJs(B),G=G&&c.cstrToJs(G),F=F&&c.cstrToJs(F),X=X&&c.cstrToJs(X),k(T,R,B,G,F,X)||0}catch(ae){return ae.resultCode||l.SQLITE_ERROR}}}),"*"]]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:k=>k[0],callProxy:k=>(T,R,B,G,F)=>{k(T,R,c.cstrToJs(B),c.cstrToJs(G),F)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"]],c.bigIntEnabled&&c.exports.sqlite3_declare_vtab&&c.bindingSignatures.int64.push(["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]),c.bigIntEnabled&&c.exports.sqlite3_preupdate_hook&&c.bindingSignatures.int64.push(["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:k=>k[0],callProxy:k=>(T,R,B,G,F,X,ae)=>{k(T,R,B,c.cstrToJs(G),c.cstrToJs(F),X,ae)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]]),c.bigIntEnabled&&c.exports.sqlite3changegroup_add&&c.exports.sqlite3session_create&&c.exports.sqlite3_preupdate_hook){const k={signature:"i(ps)",callProxy:T=>(R,B)=>{try{return T(R,c.cstrToJs(B))|0}catch(G){return G.resultCode||l.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...k}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...k}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...k}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...k}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...k,contextKey:(T,R)=>T[0]}),"*"]])}c.bindingSignatures.wasmInternal=[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]],n.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const k=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",F=>k(u.flexibleString(F))),c.xWrap.argAdapter("string:static",(function(F){return c.isPtr(F)?F:(F=""+F,this[F]||(this[F]=c.allocCString(F)))}).bind(Object.create(null)));const T=c.xWrap.argAdapter("*"),R=function(){};c.xWrap.argAdapter("sqlite3_filename",T)("sqlite3_context*",T)("sqlite3_value*",T)("void*",T)("sqlite3_changegroup*",T)("sqlite3_changeset_iter*",T)("sqlite3_session*",T)("sqlite3_stmt*",F=>{var X;return T(F instanceof(((X=n==null?void 0:n.oo1)==null?void 0:X.Stmt)||R)?F.pointer:F)})("sqlite3*",F=>{var X;return T(F instanceof(((X=n==null?void 0:n.oo1)==null?void 0:X.DB)||R)?F.pointer:F)})("sqlite3_vfs*",F=>typeof F=="string"?l.sqlite3_vfs_find(F)||n.SQLite3Error.toss(l.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",F):T(F instanceof(l.sqlite3_vfs||R)?F.pointer:F)),c.exports.sqlite3_declare_vtab&&c.xWrap.argAdapter("sqlite3_index_info*",F=>T(F instanceof(l.sqlite3_index_info||R)?F.pointer:F))("sqlite3_module*",F=>T(F instanceof(l.sqlite3_module||R)?F.pointer:F));const B=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",B)("sqlite3_context*",B)("sqlite3_stmt*",B)("sqlite3_value*",B)("sqlite3_vfs*",B)("void*",B),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,n.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const F of c.bindingSignatures)l[F[0]]=c.xWrap.apply(null,F);for(const F of c.bindingSignatures.wasmInternal)u[F[0]]=c.xWrap.apply(null,F);const G=function(F){return()=>a(F+"() is unavailable due to lack","of BigInt support in this build.")};for(const F of c.bindingSignatures.int64)l[F[0]]=c.bigIntEnabled?c.xWrap.apply(null,F):G(F[0]);if(delete c.bindingSignatures,c.exports.sqlite3__wasm_db_error){const F=c.xWrap("sqlite3__wasm_db_error","int","sqlite3*","int","string");u.sqlite3__wasm_db_error=function(X,ae,_){return ae instanceof n.WasmAllocError?(ae=l.SQLITE_NOMEM,_=0):ae instanceof Error&&(_=_||""+ae,ae=ae.resultCode||l.SQLITE_ERROR),X?F(X,ae,_):ae}}else u.sqlite3__wasm_db_error=function(F,X,ae){return console.warn("sqlite3__wasm_db_error() is not exported.",arguments),X}}{const k=c.xCall("sqlite3__wasm_enum_json");k||a("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(k));const T=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&T.push("serialize","session","vtab");for(const G of T)for(const F of Object.entries(c.ctype[G]))l[F[0]]=F[1];c.functionEntry(l.SQLITE_WASM_DEALLOC)||a("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+l.SQLITE_WASM_DEALLOC+").");const R=Object.create(null);for(const G of["resultCodes"])for(const F of Object.entries(c.ctype[G]))R[F[1]]=F[0];l.sqlite3_js_rc_str=G=>R[G];const B=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!u.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const G of c.ctype.structs)B[G.name]||(l[G.name]=n.StructBinder(G));if(l.sqlite3_index_info){for(const G of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])l.sqlite3_index_info[G]=l[G],delete l[G];l.sqlite3_vtab_config=c.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const w=(k,T,R)=>u.sqlite3__wasm_db_error(k,l.SQLITE_MISUSE,T+"() requires "+R+" argument"+(R===1?"":"s")+"."),E=k=>u.sqlite3__wasm_db_error(k,l.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),j=k=>c.xWrap.argAdapter("sqlite3*")(k),H=k=>c.isPtr(k)?c.cstrToJs(k):k,oe=(function(k,T){k=j(k);let R=this.dbMap.get(k);if(T)!R&&T>0&&this.dbMap.set(k,R=Object.create(null));else return this.dbMap.delete(k),R;return R}).bind(Object.assign(Object.create(null),{dbMap:new Map}));oe.addCollation=function(k,T){const R=oe(k,1);R.collation||(R.collation=new Set),R.collation.add(H(T).toLowerCase())},oe._addUDF=function(k,T,R,B){T=H(T).toLowerCase();let G=B.get(T);G||B.set(T,G=new Set),G.add(R<0?-1:R)},oe.addFunction=function(k,T,R){const B=oe(k,1);B.udf||(B.udf=new Map),this._addUDF(k,T,R,B.udf)},c.exports.sqlite3_create_window_function&&(oe.addWindowFunc=function(k,T,R){const B=oe(k,1);B.wudf||(B.wudf=new Map),this._addUDF(k,T,R,B.wudf)}),oe.cleanup=function(k){k=j(k);const T=[k];for(const G of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const F=c.exports[G];if(F){T.length=F.length;try{l[G](...T)}catch(X){n.config.warn("close-time call of",G+"(",T,") threw:",X)}}}const R=oe(k,0);if(!R)return;if(R.collation){for(const G of R.collation)try{l.sqlite3_create_collation_v2(k,G,l.SQLITE_UTF8,0,0,0)}catch{}delete R.collation}let B;for(B=0;B<2;++B){const G=B?R.wudf:R.udf;if(!G)continue;const F=B?l.sqlite3_create_window_function:l.sqlite3_create_function_v2;for(const X of G){const ae=X[0],_=X[1],x=[k,ae,0,l.SQLITE_UTF8,0,0,0,0,0];B&&x.push(0);for(const I of _)try{x[2]=I,F.apply(null,x)}catch{}_.clear()}G.clear()}delete R.udf,delete R.wudf};{const k=c.xWrap("sqlite3_close_v2","int","sqlite3*");l.sqlite3_close_v2=function(T){if(arguments.length!==1)return w(T,"sqlite3_close_v2",1);if(T)try{oe.cleanup(T)}catch{}return k(T)}}if(l.sqlite3session_create){const k=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);l.sqlite3session_delete=function(T){if(arguments.length!==1)return w(pDb,"sqlite3session_delete",1);T&&l.sqlite3session_table_filter(T,0,0),k(T)}}{const k=(R,B)=>"argv["+B+"]:"+R[0]+":"+c.cstrToJs(R[1]).toLowerCase(),T=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:k}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:k})]);l.sqlite3_create_collation_v2=function(R,B,G,F,X,ae){if(arguments.length!==6)return w(R,"sqlite3_create_collation_v2",6);if(!(G&15))G|=l.SQLITE_UTF8;else if(l.SQLITE_UTF8!==(G&15))return E(R);try{const _=T(R,B,G,F,X,ae);return _===0&&X instanceof Function&&oe.addCollation(R,B),_}catch(_){return u.sqlite3__wasm_db_error(R,_)}},l.sqlite3_create_collation=(R,B,G,F,X)=>arguments.length===5?l.sqlite3_create_collation_v2(R,B,G,F,X,0):w(R,"sqlite3_create_collation",5)}{const k=function(G,F){return G[0]+":"+(G[2]<0?-1:G[2])+":"+F+":"+c.cstrToJs(G[1]).toLowerCase()},T=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:k,callProxy:G=>(F,X,ae)=>{try{G(F,...l.sqlite3_values_to_js(X,ae))}catch(_){l.sqlite3_result_error_js(F,_)}}},xFinalAndValue:{signature:"v(p)",contextKey:k,callProxy:G=>F=>{try{l.sqlite3_result_js(F,G(F))}catch(X){l.sqlite3_result_error_js(F,X)}}},xFunc:{signature:"v(pip)",contextKey:k,callProxy:G=>(F,X,ae)=>{try{l.sqlite3_result_js(F,G(F,...l.sqlite3_values_to_js(X,ae)))}catch(_){l.sqlite3_result_error_js(F,_)}}},xDestroy:{signature:"v(p)",contextKey:k,callProxy:G=>F=>{try{G(F)}catch(X){console.error("UDF xDestroy method threw:",X)}}}}),R=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...T.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...T.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...T.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...T.xDestroy})]),B=c.exports.sqlite3_create_window_function?c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...T.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...T.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...T.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...T.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...T.xDestroy})]):void 0;l.sqlite3_create_function_v2=function G(F,X,ae,_,x,I,re,y,q){if(G.length!==arguments.length)return w(F,"sqlite3_create_function_v2",G.length);if(!(_&15))_|=l.SQLITE_UTF8;else if(l.SQLITE_UTF8!==(_&15))return E(F);try{const f=R(F,X,ae,_,x,I,re,y,q);return f===0&&(I instanceof Function||re instanceof Function||y instanceof Function||q instanceof Function)&&oe.addFunction(F,X,ae),f}catch(f){return console.error("sqlite3_create_function_v2() setup threw:",f),u.sqlite3__wasm_db_error(F,f,"Creation of UDF threw: "+f)}},l.sqlite3_create_function=function G(F,X,ae,_,x,I,re,y){return G.length===arguments.length?l.sqlite3_create_function_v2(F,X,ae,_,x,I,re,y,0):w(F,"sqlite3_create_function",G.length)},B?l.sqlite3_create_window_function=function G(F,X,ae,_,x,I,re,y,q,f){if(G.length!==arguments.length)return w(F,"sqlite3_create_window_function",G.length);if(!(_&15))_|=l.SQLITE_UTF8;else if(l.SQLITE_UTF8!==(_&15))return E(F);try{const m=B(F,X,ae,_,x,I,re,y,q,f);return m===0&&(I instanceof Function||re instanceof Function||y instanceof Function||q instanceof Function||f instanceof Function)&&oe.addWindowFunc(F,X,ae),m}catch(m){return console.error("sqlite3_create_window_function() setup threw:",m),u.sqlite3__wasm_db_error(F,m,"Creation of UDF threw: "+m)}}:delete l.sqlite3_create_window_function,l.sqlite3_create_function_v2.udfSetResult=l.sqlite3_create_function.udfSetResult=l.sqlite3_result_js,l.sqlite3_create_window_function&&(l.sqlite3_create_window_function.udfSetResult=l.sqlite3_result_js),l.sqlite3_create_function_v2.udfConvertArgs=l.sqlite3_create_function.udfConvertArgs=l.sqlite3_values_to_js,l.sqlite3_create_window_function&&(l.sqlite3_create_window_function.udfConvertArgs=l.sqlite3_values_to_js),l.sqlite3_create_function_v2.udfSetError=l.sqlite3_create_function.udfSetError=l.sqlite3_result_error_js,l.sqlite3_create_window_function&&(l.sqlite3_create_window_function.udfSetError=l.sqlite3_result_error_js)}{const k=(R,B)=>(typeof R=="string"?B=-1:u.isSQLableTypedArray(R)?(B=R.byteLength,R=u.typedArrayToString(R instanceof ArrayBuffer?new Uint8Array(R):R)):Array.isArray(R)&&(R=R.join(""),B=-1),[R,B]),T={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};l.sqlite3_prepare_v3=function R(B,G,F,X,ae,_){if(R.length!==arguments.length)return w(B,"sqlite3_prepare_v3",R.length);const[x,I]=k(G,F);switch(typeof x){case"string":return T.basic(B,x,I,X,ae,null);case"number":return T.full(B,x,I,X,ae,_);default:return u.sqlite3__wasm_db_error(B,l.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},l.sqlite3_prepare_v2=function R(B,G,F,X,ae){return R.length===arguments.length?l.sqlite3_prepare_v3(B,G,F,0,X,ae):w(B,"sqlite3_prepare_v2",R.length)}}{const k=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),T=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);l.sqlite3_bind_text=function R(B,G,F,X,ae){if(R.length!==arguments.length)return w(l.sqlite3_db_handle(B),"sqlite3_bind_text",R.length);if(c.isPtr(F)||F===null)return k(B,G,F,X,ae);F instanceof ArrayBuffer?F=new Uint8Array(F):Array.isArray(pMem)&&(F=pMem.join(""));let _,x;try{if(u.isSQLableTypedArray(F))_=c.allocFromTypedArray(F),x=F.byteLength;else if(typeof F=="string")[_,x]=c.allocCString(F);else return u.sqlite3__wasm_db_error(l.sqlite3_db_handle(B),l.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return k(B,G,_,x,l.SQLITE_WASM_DEALLOC)}catch(I){return c.dealloc(_),u.sqlite3__wasm_db_error(l.sqlite3_db_handle(B),I)}},l.sqlite3_bind_blob=function R(B,G,F,X,ae){if(R.length!==arguments.length)return w(l.sqlite3_db_handle(B),"sqlite3_bind_blob",R.length);if(c.isPtr(F)||F===null)return T(B,G,F,X,ae);F instanceof ArrayBuffer?F=new Uint8Array(F):Array.isArray(F)&&(F=F.join(""));let _,x;try{if(u.isBindableTypedArray(F))_=c.allocFromTypedArray(F),x=X>=0?X:F.byteLength;else if(typeof F=="string")[_,x]=c.allocCString(F);else return u.sqlite3__wasm_db_error(l.sqlite3_db_handle(B),l.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return T(B,G,_,x,l.SQLITE_WASM_DEALLOC)}catch(I){return c.dealloc(_),u.sqlite3__wasm_db_error(l.sqlite3_db_handle(B),I)}}}l.sqlite3_config=function(k,...T){if(arguments.length<2)return l.SQLITE_MISUSE;switch(k){case l.SQLITE_CONFIG_COVERING_INDEX_SCAN:case l.SQLITE_CONFIG_MEMSTATUS:case l.SQLITE_CONFIG_SMALL_MALLOC:case l.SQLITE_CONFIG_SORTERREF_SIZE:case l.SQLITE_CONFIG_STMTJRNL_SPILL:case l.SQLITE_CONFIG_URI:return c.exports.sqlite3__wasm_config_i(k,T[0]);case l.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3__wasm_config_ii(k,T[0],T[1]);case l.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3__wasm_config_j(k,T[0]);case l.SQLITE_CONFIG_GETMALLOC:case l.SQLITE_CONFIG_GETMUTEX:case l.SQLITE_CONFIG_GETPCACHE2:case l.SQLITE_CONFIG_GETPCACHE:case l.SQLITE_CONFIG_HEAP:case l.SQLITE_CONFIG_LOG:case l.SQLITE_CONFIG_MALLOC:case l.SQLITE_CONFIG_MMAP_SIZE:case l.SQLITE_CONFIG_MULTITHREAD:case l.SQLITE_CONFIG_MUTEX:case l.SQLITE_CONFIG_PAGECACHE:case l.SQLITE_CONFIG_PCACHE2:case l.SQLITE_CONFIG_PCACHE:case l.SQLITE_CONFIG_PCACHE_HDRSZ:case l.SQLITE_CONFIG_PMASZ:case l.SQLITE_CONFIG_SERIALIZED:case l.SQLITE_CONFIG_SINGLETHREAD:case l.SQLITE_CONFIG_SQLLOG:case l.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return l.SQLITE_NOTFOUND}};{const k=new Set;l.sqlite3_auto_extension=function(T){if(T instanceof Function)T=c.installFunction("i(ppp)",T);else if(arguments.length!==1||!c.isPtr(T))return l.SQLITE_MISUSE;const R=c.exports.sqlite3_auto_extension(T);return T!==arguments[0]&&(R===0?k.add(T):c.uninstallFunction(T)),R},l.sqlite3_cancel_auto_extension=function(T){return!T||arguments.length!==1||!c.isPtr(T)?0:c.exports.sqlite3_cancel_auto_extension(T)},l.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const T of k)c.uninstallFunction(T);k.clear()}}const ce=l.sqlite3_vfs_find("kvvfs");if(ce)if(u.isUIThread()){const k=new l.sqlite3_kvvfs_methods(c.exports.sqlite3__wasm_kvvfs_methods());delete l.sqlite3_kvvfs_methods;const T=c.exports.sqlite3__wasm_kvvfsMakeKeyOnPstack,R=c.pstack,B=F=>c.peek(F)===115?sessionStorage:localStorage,G={xRead:(F,X,ae,_)=>{const x=R.pointer,I=c.scopedAllocPush();try{const re=T(F,X);if(!re)return-3;const y=c.cstrToJs(re),q=B(F).getItem(y);if(!q)return-1;const f=q.length;if(_<=0)return f;if(_===1)return c.poke(ae,0),f;const m=c.scopedAllocCString(q);return _>f+1&&(_=f+1),c.heap8u().copyWithin(ae,m,m+_-1),c.poke(ae+_-1,0),_-1}catch(re){return console.error("kvstorageRead()",re),-2}finally{R.restore(x),c.scopedAllocPop(I)}},xWrite:(F,X,ae)=>{const _=R.pointer;try{const x=T(F,X);if(!x)return 1;const I=c.cstrToJs(x);return B(F).setItem(I,c.cstrToJs(ae)),0}catch(x){return console.error("kvstorageWrite()",x),l.SQLITE_IOERR}finally{R.restore(_)}},xDelete:(F,X)=>{const ae=R.pointer;try{const _=T(F,X);return _?(B(F).removeItem(c.cstrToJs(_)),0):1}catch(_){return console.error("kvstorageDelete()",_),l.SQLITE_IOERR}finally{R.restore(ae)}}};for(const F of Object.keys(G))k[k.memberKey(F)]=c.installFunction(k.memberSignature(F),G[F])}else l.sqlite3_vfs_unregister(ce);c.xWrap.FuncPtrAdapter.warnOnUse=!0;const Q=n.StructBinder,W=function k(T,R,B,G=k.installMethodArgcCheck){if(T instanceof Q.StructType?!(B instanceof Function)&&!c.isPtr(B)&&a("Usage errror: expecting a Function or WASM pointer to one."):a("Usage error: target object is-not-a StructType."),arguments.length===1)return(_,x)=>k(T,_,x,G);k.argcProxy||(k.argcProxy=function(_,x,I,re){return function(...y){return I.length!==arguments.length&&a("Argument mismatch for",_.structInfo.name+"::"+x+": Native signature is:",re),I.apply(this,y)}},k.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((_,x)=>{if(typeof _=="number")try{c.uninstallFunction(_)}catch{}}),delete this.ondispose.__removeFuncList)});const F=T.memberSignature(R);F.length<2&&a("Member",R,"does not have a function pointer signature:",F);const X=T.memberKey(R),ae=G&&!c.isPtr(B)?k.argcProxy(T,X,B,F):B;if(c.isPtr(ae))ae&&!c.functionEntry(ae)&&a("Pointer",ae,"is not a WASM function table entry."),T[X]=ae;else{const _=c.installFunction(ae,T.memberSignature(R,!0));T[X]=_,(!T.ondispose||!T.ondispose.__removeFuncList)&&(T.addOnDispose("ondispose.__removeFuncList handler",k.removeFuncList),T.ondispose.__removeFuncList=[]),T.ondispose.__removeFuncList.push(X,_)}return(_,x)=>k(T,_,x,G)};W.installMethodArgcCheck=!1;const Y=function(k,T,R=W.installMethodArgcCheck){const B=new Map;for(const G of Object.keys(T)){const F=T[G],X=B.get(F);if(X){const ae=k.memberKey(G);k[ae]=k[k.memberKey(X)]}else W(k,G,F,R),B.set(F,G)}return k};Q.StructType.prototype.installMethod=function(T,R,B=W.installMethodArgcCheck){return arguments.length<3&&T&&typeof T=="object"?Y(this,...arguments):W(this,...arguments)},Q.StructType.prototype.installMethods=function(k,T=W.installMethodArgcCheck){return Y(this,k,T)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){n.version={libVersion:"3.49.1",libVersionNumber:3049001,sourceId:"2025-02-18 13:38:58 873d4e274b4988d260ba8354a9718324a1c26187a4ab4c1cc0227c03d0f10e70",downloadVersion:3490100}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){const a=(...y)=>{throw new n.SQLite3Error(...y)},l=n.capi,c=n.wasm,u=n.util,w=new WeakMap,E=new WeakMap,j=(y,q,f)=>{const m=Object.getOwnPropertyDescriptor(y,q);return m?m.value:f},H=function(y,q){return q&&(y instanceof W&&(y=y.pointer),a(q,"sqlite3 result code",q+":",y?l.sqlite3_errmsg(y):l.sqlite3_errstr(q))),arguments[0]},oe=c.installFunction("i(ippp)",(function(y,q,f,m){l.SQLITE_TRACE_STMT===y&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+q+":",c.cstrToJs(m))}).bind({counter:0})),ce=Object.create(null),Q=function y(...q){if(!y._name2vfs){y._name2vfs=Object.create(null);const ke=typeof importScripts=="function"?Pe=>a("The VFS for",Pe,"is only available in the main window thread."):!1;y._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ke||(()=>"local")},y._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ke||(()=>"session")}}const f=y.normalizeArgs(...q);let m=f.filename,A=f.vfs,O=f.flags;(typeof m!="string"&&typeof m!="number"||typeof O!="string"||A&&typeof A!="string"&&typeof A!="number")&&(n.config.error("Invalid DB ctor args",f,arguments),a("Invalid arguments for DB constructor."));let te=typeof m=="number"?c.cstrToJs(m):m;const me=y._name2vfs[te];me&&(A=me.vfs,m=te=me.filename(te));let xe,Ie=0;O.indexOf("c")>=0&&(Ie|=l.SQLITE_OPEN_CREATE|l.SQLITE_OPEN_READWRITE),O.indexOf("w")>=0&&(Ie|=l.SQLITE_OPEN_READWRITE),Ie===0&&(Ie|=l.SQLITE_OPEN_READONLY),Ie|=l.SQLITE_OPEN_EXRESCODE;const Ae=c.pstack.pointer;try{const ke=c.pstack.allocPtr();let Pe=l.sqlite3_open_v2(m,ke,Ie,A||0);xe=c.peekPtr(ke),H(xe,Pe),l.sqlite3_extended_result_codes(xe,1),O.indexOf("t")>=0&&l.sqlite3_trace_v2(xe,l.SQLITE_TRACE_STMT,oe,xe)}catch(ke){throw xe&&l.sqlite3_close_v2(xe),ke}finally{c.pstack.restore(Ae)}this.filename=te,w.set(this,xe),E.set(this,Object.create(null));try{const ke=l.sqlite3_js_db_vfs(xe)||a("Internal error: cannot get VFS for new db handle."),Pe=ce[ke];Pe&&(Pe instanceof Function?Pe(this,n):H(xe,l.sqlite3_exec(xe,Pe,0,0,0)))}catch(ke){throw this.close(),ke}};Q.setVfsPostOpenCallback=function(y,q){q instanceof Function||a("dbCtorHelper.setVfsPostOpenCallback() should not be used with a non-function argument.",arguments),ce[y]=q},Q.normalizeArgs=function(y=":memory:",q="c",f=null){const m={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(m,arguments[0]),m.flags===void 0&&(m.flags="c"),m.vfs===void 0&&(m.vfs=null),m.filename===void 0&&(m.filename=":memory:")):(m.filename=y,m.flags=q,m.vfs=f),m};const W=function(...y){Q.apply(this,y)};W.dbCtorHelper=Q;const Y={null:1,number:2,string:3,boolean:4,blob:5};Y.undefined==Y.null,c.bigIntEnabled&&(Y.bigint=Y.number);const k=function(){Y!==arguments[2]&&a(l.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],w.set(this,arguments[1]),this.parameterCount=l.sqlite3_bind_parameter_count(this.pointer)},T=function(y){return y.pointer||a("DB has been closed."),y},R=function(y,q){return(q!==(q|0)||q<0||q>=y.columnCount)&&a("Column index",q,"is out of range."),y},B=function(y,q){const f=Object.create(null);switch(f.opt=Object.create(null),q.length){case 1:typeof q[0]=="string"||u.isSQLableTypedArray(q[0])||Array.isArray(q[0])?f.sql=q[0]:q[0]&&typeof q[0]=="object"&&(f.opt=q[0],f.sql=f.opt.sql);break;case 2:f.sql=q[0],f.opt=q[1];break;default:a("Invalid argument count for exec().")}f.sql=u.flexibleString(f.sql),typeof f.sql!="string"&&a("Missing SQL argument or unsupported SQL value type.");const m=f.opt;switch(m.returnValue){case"resultRows":m.resultRows||(m.resultRows=[]),f.returnVal=()=>m.resultRows;break;case"saveSql":m.saveSql||(m.saveSql=[]),f.returnVal=()=>m.saveSql;break;case void 0:case"this":f.returnVal=()=>y;break;default:a("Invalid returnValue value:",m.returnValue)}if(!m.callback&&!m.returnValue&&m.rowMode!==void 0&&(m.resultRows||(m.resultRows=[]),f.returnVal=()=>m.resultRows),m.callback||m.resultRows)switch(m.rowMode===void 0?"array":m.rowMode){case"object":f.cbArg=(A,O)=>{O.columnNames||(O.columnNames=A.getColumnNames([]));const te=A.get([]),me=Object.create(null);for(const xe in O.columnNames)me[O.columnNames[xe]]=te[xe];return me};break;case"array":f.cbArg=A=>A.get([]);break;case"stmt":Array.isArray(m.resultRows)&&a("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),f.cbArg=A=>A;break;default:if(u.isInt32(m.rowMode)){f.cbArg=A=>A.get(m.rowMode);break}else if(typeof m.rowMode=="string"&&m.rowMode.length>1&&m.rowMode[0]==="$"){const A=m.rowMode.substr(1);f.cbArg=O=>{const te=O.get(Object.create(null))[A];return te===void 0?a(l.SQLITE_NOTFOUND,"exec(): unknown result column:",A):te};break}a("Invalid rowMode:",m.rowMode)}return f},G=(y,q,f,...m)=>{const A=y.prepare(q);try{const O=A.bind(f).step()?A.get(...m):void 0;return A.reset(),O}finally{A.finalize()}},F=(y,q,f,m)=>y.exec({sql:q,bind:f,rowMode:m,returnValue:"resultRows"});W.checkRc=(y,q)=>H(y,q),W.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return T(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const y=this.pointer;if(Object.keys(E.get(this)).forEach((q,f)=>{if(f&&f.pointer)try{f.finalize()}catch{}}),w.delete(this),E.delete(this),l.sqlite3_close_v2(y),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(y=!1,q=!1){const f=T(this).pointer;return y?q?l.sqlite3_total_changes64(f):l.sqlite3_total_changes(f):q?l.sqlite3_changes64(f):l.sqlite3_changes(f)},dbFilename:function(y="main"){return l.sqlite3_db_filename(T(this).pointer,y)},dbName:function(y=0){return l.sqlite3_db_name(T(this).pointer,y)},dbVfsName:function(y=0){let q;const f=l.sqlite3_js_db_vfs(T(this).pointer,y);if(f){const m=new l.sqlite3_vfs(f);try{q=c.cstrToJs(m.$zName)}finally{m.dispose()}}return q},prepare:function(y){T(this);const q=c.pstack.pointer;let f,m;try{f=c.pstack.alloc(8),W.checkRc(this,l.sqlite3_prepare_v2(this.pointer,y,-1,f,null)),m=c.peekPtr(f)}finally{c.pstack.restore(q)}m||a("Cannot prepare empty SQL.");const A=new k(this,m,Y);return E.get(this)[m]=A,A},exec:function(){T(this);const y=B(this,arguments);if(!y.sql)return a("exec() requires an SQL string.");const q=y.opt,f=q.callback,m=Array.isArray(q.resultRows)?q.resultRows:void 0;let A,O=q.bind,te=!!(y.cbArg||q.columnNames||m);const me=c.scopedAllocPush(),xe=Array.isArray(q.saveSql)?q.saveSql:void 0;try{const Ie=u.isSQLableTypedArray(y.sql);let Ae=Ie?y.sql.byteLength:c.jstrlen(y.sql);const ke=c.scopedAlloc(2*c.ptrSizeof+(Ae+1)),Pe=ke+c.ptrSizeof;let Re=Pe+c.ptrSizeof;const Je=Re+Ae;for(Ie?c.heap8().set(y.sql,Re):c.jstrcpy(y.sql,c.heap8(),Re,Ae,!1),c.poke(Re+Ae,0);Re&&c.peek(Re,"i8");){c.pokePtr([ke,Pe],0),W.checkRc(this,l.sqlite3_prepare_v3(this.pointer,Re,Ae,0,ke,Pe));const Ge=c.peekPtr(ke);if(Re=c.peekPtr(Pe),Ae=Je-Re,!!Ge){if(xe&&xe.push(l.sqlite3_sql(Ge).trim()),A=new k(this,Ge,Y),O&&A.parameterCount&&(A.bind(O),O=null),te&&A.columnCount){let Bt=Array.isArray(q.columnNames)?0:1;if(te=!1,y.cbArg||m){const lt=Object.create(null);for(;A.step();A._lockedByExec=!1){Bt++===0&&A.getColumnNames(lt.columnNames=q.columnNames||[]),A._lockedByExec=!0;const M=y.cbArg(A,lt);if(m&&m.push(M),f&&f.call(q,M,A)===!1)break}A._lockedByExec=!1}Bt===0&&A.getColumnNames(q.columnNames)}else A.step();A.reset().finalize(),A=null}}}finally{c.scopedAllocPop(me),A&&(delete A._lockedByExec,A.finalize())}return y.returnVal()},createFunction:function(q,f,m){const A=lt=>lt instanceof Function;switch(arguments.length){case 1:m=q,q=m.name,f=m.xFunc||0;break;case 2:A(f)||(m=f,f=m.xFunc||0);break}m||(m={}),typeof q!="string"&&a("Invalid arguments: missing function name.");let O=m.xStep||0,te=m.xFinal||0;const me=m.xValue||0,xe=m.xInverse||0;let Ie;A(f)?(Ie=!1,(A(O)||A(te))&&a("Ambiguous arguments: scalar or aggregate?"),O=te=null):A(O)?(A(te)||a("Missing xFinal() callback for aggregate or window UDF."),f=null):A(te)?a("Missing xStep() callback for aggregate or window UDF."):a("Missing function-type properties."),Ie===!1?(A(me)||A(xe))&&a("xValue and xInverse are not permitted for non-window UDFs."):A(me)?(A(xe)||a("xInverse must be provided if xValue is."),Ie=!0):A(xe)&&a("xValue must be provided if xInverse is.");const Ae=m.pApp;Ae!=null&&(typeof Ae!="number"||!u.isInt32(Ae))&&a("Invalid value for pApp property. Must be a legal WASM pointer value.");const ke=m.xDestroy||0;ke&&!A(ke)&&a("xDestroy property must be a function.");let Pe=0;j(m,"deterministic")&&(Pe|=l.SQLITE_DETERMINISTIC),j(m,"directOnly")&&(Pe|=l.SQLITE_DIRECTONLY),j(m,"innocuous")&&(Pe|=l.SQLITE_INNOCUOUS),q=q.toLowerCase();const Re=f||O,Je=j(m,"arity"),Ge=typeof Je=="number"?Je:Re.length?Re.length-1:0;let Bt;return Ie?Bt=l.sqlite3_create_window_function(this.pointer,q,Ge,l.SQLITE_UTF8|Pe,Ae||0,O,te,me,xe,ke):Bt=l.sqlite3_create_function_v2(this.pointer,q,Ge,l.SQLITE_UTF8|Pe,Ae||0,f,O,te,ke),W.checkRc(this,Bt),this},selectValue:function(y,q,f){return G(this,y,q,0,f)},selectValues:function(y,q,f){const m=this.prepare(y),A=[];try{for(m.bind(q);m.step();)A.push(m.get(0,f));m.reset()}finally{m.finalize()}return A},selectArray:function(y,q){return G(this,y,q,[])},selectObject:function(y,q){return G(this,y,q,{})},selectArrays:function(y,q){return F(this,y,q,"array")},selectObjects:function(y,q){return F(this,y,q,"object")},openStatementCount:function(){return this.pointer?Object.keys(E.get(this)).length:0},transaction:function(y){let q="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&a(l.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),q+=" "+arguments[0],y=arguments[1]),T(this).exec(q);try{const f=y(this);return this.exec("COMMIT"),f}catch(f){throw this.exec("ROLLBACK"),f}},savepoint:function(y){T(this).exec("SAVEPOINT oo1");try{const q=y(this);return this.exec("RELEASE oo1"),q}catch(q){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),q}},checkRc:function(y){return H(this,y)}};const X=function(y){return y.pointer||a("Stmt has been closed."),y},ae=function(y){let q=Y[y==null?"null":typeof y];switch(q){case Y.boolean:case Y.null:case Y.number:case Y.string:return q;case Y.bigint:if(c.bigIntEnabled)return q;default:return u.isBindableTypedArray(y)?Y.blob:void 0}},_=function(y){return ae(y)||a("Unsupported bind() argument type:",typeof y)},x=function(y,q){const f=typeof q=="number"?q:l.sqlite3_bind_parameter_index(y.pointer,q);return f===0||!u.isInt32(f)?a("Invalid bind() parameter name: "+q):(f<1||f>y.parameterCount)&&a("Bind index",q,"is out of range."),f},I=function(y,q){return y._lockedByExec&&a("Operation is illegal when statement is locked:",q),y},re=function y(q,f,m,A){I(X(q),"bind()"),y._||(y._tooBigInt=te=>a("BigInt value is too big to store without precision loss:",te),y._={string:function(te,me,xe,Ie){const[Ae,ke]=c.allocCString(xe,!0);return(Ie?l.sqlite3_bind_blob:l.sqlite3_bind_text)(te.pointer,me,Ae,ke,l.SQLITE_WASM_DEALLOC)}}),_(A),f=x(q,f);let O=0;switch(A==null?Y.null:m){case Y.null:O=l.sqlite3_bind_null(q.pointer,f);break;case Y.string:O=y._.string(q,f,A,!1);break;case Y.number:{let te;u.isInt32(A)?te=l.sqlite3_bind_int:typeof A=="bigint"?u.bigIntFits64(A)?c.bigIntEnabled?te=l.sqlite3_bind_int64:u.bigIntFitsDouble(A)?(A=Number(A),te=l.sqlite3_bind_double):y._tooBigInt(A):y._tooBigInt(A):(A=Number(A),c.bigIntEnabled&&Number.isInteger(A)?te=l.sqlite3_bind_int64:te=l.sqlite3_bind_double),O=te(q.pointer,f,A);break}case Y.boolean:O=l.sqlite3_bind_int(q.pointer,f,A?1:0);break;case Y.blob:{if(typeof A=="string"){O=y._.string(q,f,A,!0);break}else A instanceof ArrayBuffer?A=new Uint8Array(A):u.isBindableTypedArray(A)||a("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const te=c.alloc(A.byteLength||1);c.heap8().set(A.byteLength?A:[0],te),O=l.sqlite3_bind_blob(q.pointer,f,te,A.byteLength,l.SQLITE_WASM_DEALLOC);break}default:n.config.warn("Unsupported bind() argument type:",A),a("Unsupported bind() argument type: "+typeof A)}return O&&W.checkRc(q.db.pointer,O),q._mayGet=!1,q};k.prototype={finalize:function(){if(this.pointer){I(this,"finalize()");const y=l.sqlite3_finalize(this.pointer);return delete E.get(this.db)[this.pointer],w.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,y}},clearBindings:function(){return I(X(this),"clearBindings()"),l.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(y){I(this,"reset()"),y&&this.clearBindings();const q=l.sqlite3_reset(X(this).pointer);return this._mayGet=!1,H(this.db,q),this},bind:function(){X(this);let y,q;switch(arguments.length){case 1:y=1,q=arguments[0];break;case 2:y=arguments[0],q=arguments[1];break;default:a("Invalid bind() arguments.")}return q===void 0?this:(this.parameterCount||a("This statement has no bindable parameters."),this._mayGet=!1,q===null?re(this,y,Y.null,q):Array.isArray(q)?(arguments.length!==1&&a("When binding an array, an index argument is not permitted."),q.forEach((f,m)=>re(this,m+1,_(f),f)),this):(q instanceof ArrayBuffer&&(q=new Uint8Array(q)),typeof q=="object"&&!u.isBindableTypedArray(q)?(arguments.length!==1&&a("When binding an object, an index argument is not permitted."),Object.keys(q).forEach(f=>re(this,f,_(q[f]),q[f])),this):re(this,y,_(q),q)))},bindAsBlob:function(y,q){X(this),arguments.length===1&&(q=y,y=1);const f=_(q);return Y.string!==f&&Y.blob!==f&&Y.null!==f&&a("Invalid value type for bindAsBlob()"),re(this,y,Y.blob,q)},step:function(){I(this,"step()");const y=l.sqlite3_step(X(this).pointer);switch(y){case l.SQLITE_DONE:return this._mayGet=!1;case l.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,n.config.warn("sqlite3_step() rc=",y,l.sqlite3_js_rc_str(y),"SQL =",l.sqlite3_sql(this.pointer)),W.checkRc(this.db.pointer,y)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const y=this.step();return this.reset(),y}finally{try{this.finalize()}catch{}}},get:function(y,q){if(X(this)._mayGet||a("Stmt.step() has not (recently) returned true."),Array.isArray(y)){let f=0;const m=this.columnCount;for(;f<m;)y[f]=this.get(f++);return y}else if(y&&typeof y=="object"){let f=0;const m=this.columnCount;for(;f<m;)y[l.sqlite3_column_name(this.pointer,f)]=this.get(f++);return y}switch(R(this,y),q===void 0?l.sqlite3_column_type(this.pointer,y):q){case l.SQLITE_NULL:return null;case l.SQLITE_INTEGER:if(c.bigIntEnabled){const f=l.sqlite3_column_int64(this.pointer,y);return f>=Number.MIN_SAFE_INTEGER&&f<=Number.MAX_SAFE_INTEGER?Number(f).valueOf():f}else{const f=l.sqlite3_column_double(this.pointer,y);return(f>Number.MAX_SAFE_INTEGER||f<Number.MIN_SAFE_INTEGER)&&a("Integer is out of range for JS integer range: "+f),u.isInt32(f)?f|0:f}case l.SQLITE_FLOAT:return l.sqlite3_column_double(this.pointer,y);case l.SQLITE_TEXT:return l.sqlite3_column_text(this.pointer,y);case l.SQLITE_BLOB:{const f=l.sqlite3_column_bytes(this.pointer,y),m=l.sqlite3_column_blob(this.pointer,y),A=new Uint8Array(f);return f&&A.set(c.heap8u().slice(m,m+f),0),f&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(A.buffer),A}default:a("Don't know how to translate","type of result column #"+y+".")}a("Not reached.")},getInt:function(y){return this.get(y,l.SQLITE_INTEGER)},getFloat:function(y){return this.get(y,l.SQLITE_FLOAT)},getString:function(y){return this.get(y,l.SQLITE_TEXT)},getBlob:function(y){return this.get(y,l.SQLITE_BLOB)},getJSON:function(y){const q=this.get(y,l.SQLITE_STRING);return q===null?q:JSON.parse(q)},getColumnName:function(y){return l.sqlite3_column_name(R(X(this),y).pointer,y)},getColumnNames:function(y=[]){R(X(this),0);const q=this.columnCount;for(let f=0;f<q;++f)y.push(l.sqlite3_column_name(this.pointer,f));return y},getParamIndex:function(y){return X(this).parameterCount?l.sqlite3_bind_parameter_index(this.pointer,y):void 0},getParamName:function(y){return X(this).parameterCount?l.sqlite3_bind_parameter_name(this.pointer,y):void 0},isBusy:function(){return l.sqlite3_stmt_busy(X(this))!==0},isReadOnly:function(){return l.sqlite3_stmt_readonly(X(this))!==0}};{const y={enumerable:!0,get:function(){return w.get(this)},set:()=>a("The pointer property is read-only.")};Object.defineProperty(k.prototype,"pointer",y),Object.defineProperty(W.prototype,"pointer",y)}if(Object.defineProperty(k.prototype,"columnCount",{enumerable:!1,get:function(){return l.sqlite3_column_count(this.pointer)},set:()=>a("The columnCount property is read-only.")}),n.oo1={DB:W,Stmt:k},u.isUIThread()){n.oo1.JsStorageDb=function(q="session"){const f=Q.normalizeArgs(...arguments);q=f.filename,q!=="session"&&q!=="local"&&a("JsStorageDb db name must be one of 'session' or 'local'."),f.vfs="kvvfs",Q.call(this,f)};const y=n.oo1.JsStorageDb;y.prototype=Object.create(W.prototype),y.clearStorage=l.sqlite3_js_kvvfs_clear,y.prototype.clearStorage=function(){return y.clearStorage(T(this).filename)},y.storageSize=l.sqlite3_js_kvvfs_size,y.prototype.storageSize=function(){return y.storageSize(T(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){const a=n.util;n.initWorker1API=(function(){const l=(...Q)=>{throw new Error(Q.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread.");const c=this.sqlite3||l("Missing this.sqlite3 object."),u=c.oo1.DB,w=function(Q){let W=E.idMap.get(Q);return W||(W="db#"+ ++E.idSeq+"@"+Q.pointer,E.idMap.set(Q,W),W)},E={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(Q){const W=new u(Q);return this.dbs[w(W)]=W,this.dbList.indexOf(W)<0&&this.dbList.push(W),W},close:function(Q,W){if(Q){delete this.dbs[w(Q)];const Y=Q.filename,k=a.sqlite3__wasm_db_vfs(Q.pointer,0);Q.close();const T=this.dbList.indexOf(Q);T>=0&&this.dbList.splice(T,1),W&&Y&&k&&a.sqlite3__wasm_vfs_unlink(k,Y)}},post:function(Q,W){W&&W.length?(globalThis.postMessage(Q,Array.from(W)),W.length=0):globalThis.postMessage(Q)},dbs:Object.create(null),getDb:function(Q,W=!0){return this.dbs[Q]||(W?l("Unknown (or closed) DB ID:",Q):void 0)}},j=function(Q=E.dbList[0]){return Q&&Q.pointer?Q:l("DB is not opened.")},H=function(Q,W=!0){const Y=E.getDb(Q.dbId,!1)||E.dbList[0];return W?j(Y):Y},oe=function(){return E.dbList[0]&&w(E.dbList[0])},ce={open:function(Q){const W=Object.create(null),Y=Q.args||Object.create(null);Y.simulateError&&l("Throwing because of simulateError flag.");const k=Object.create(null);W.vfs=Y.vfs,W.filename=Y.filename||"";const T=E.open(W);return k.filename=T.filename,k.persistent=!!c.capi.sqlite3_js_db_uses_vfs(T.pointer,"opfs"),k.dbId=w(T),k.vfs=T.dbVfsName(),k},close:function(Q){const W=H(Q,!1),Y={filename:W&&W.filename};if(W){const k=Q.args&&typeof Q.args=="object"?!!Q.args.unlink:!1;E.close(W,k)}return Y},exec:function(Q){const W=typeof Q.args=="string"?{sql:Q.args}:Q.args||Object.create(null);W.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):W.sql||l("'exec' requires input SQL.");const Y=H(Q);(W.callback||Array.isArray(W.resultRows))&&(Y._blobXfer=E.xfer);const k=W.callback;let T=0;const R=!!W.columnNames;typeof k=="string"&&(R||(W.columnNames=[]),W.callback=function(B,G){E.post({type:k,columnNames:W.columnNames,rowNumber:++T,row:B},E.xfer)});try{const B=W.countChanges?Y.changes(!0,W.countChanges===64):void 0;Y.exec(W),B!==void 0&&(W.changeCount=Y.changes(!0,W.countChanges===64)-B),W.callback instanceof Function&&(W.callback=k,E.post({type:k,columnNames:W.columnNames,rowNumber:null,row:void 0}))}finally{delete Y._blobXfer,W.callback&&(W.callback=k)}return W},"config-get":function(){const Q=Object.create(null),W=c.config;return["bigIntEnabled"].forEach(function(Y){Object.getOwnPropertyDescriptor(W,Y)&&(Q[Y]=W[Y])}),Q.version=c.version,Q.vfsList=c.capi.sqlite3_js_vfs_list(),Q},export:function(Q){const W=H(Q),Y={byteArray:c.capi.sqlite3_js_db_export(W.pointer),filename:W.filename,mimetype:"application/x-sqlite3"};return E.xfer.push(Y.byteArray.buffer),Y},toss:function(Q){l("Testing worker exception")}};globalThis.onmessage=async function(Q){Q=Q.data;let W,Y=Q.dbId,k=Q.type;const T=performance.now();try{ce.hasOwnProperty(k)&&ce[k]instanceof Function?W=await ce[k](Q):l("Unknown db worker message type:",Q.type)}catch(R){k="error",W={operation:Q.type,message:R.message,errorClass:R.name,input:Q},R.stack&&(W.stack=typeof R.stack=="string"?R.stack.split(/\n\s*/):R.stack)}Y||(Y=W.dbId||oe()),E.post({type:k,dbId:Y,messageId:Q.messageId,workerReceivedTime:T,workerRespondTime:performance.now(),departureTime:Q.departureTime,result:W},E.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:n})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){const a=n.wasm,l=n.capi,c=n.util.toss3,u=Object.create(null);n.vfs=u,l.sqlite3_vfs.prototype.registerVfs=function(w=!1){this instanceof n.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const E=l.sqlite3_vfs_register(this,w?1:0);return E&&c("sqlite3_vfs_register(",this,") failed with rc",E),this.pointer!==l.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},u.installVfs=function(w){let E=0;const j=["io","vfs"];for(const H of j){const oe=w[H];oe&&(++E,oe.struct.installMethods(oe.methods,!!oe.applyArgcCheck),H==="vfs"&&(!oe.struct.$zName&&typeof oe.name=="string"&&oe.struct.addOnDispose(oe.struct.$zName=a.allocCString(oe.name)),oe.struct.registerVfs(!!oe.asDefault)))}return E||c("Misuse: installVfs() options object requires at least","one of:",j),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){if(!n.wasm.exports.sqlite3_declare_vtab)return;const a=n.wasm,l=n.capi,c=n.util.toss3,u=Object.create(null);n.vtab=u;const w=l.sqlite3_index_info;w.prototype.nthConstraint=function(H,oe=!1){if(H<0||H>=this.$nConstraint)return!1;const ce=this.$aConstraint+w.sqlite3_index_constraint.structInfo.sizeof*H;return oe?ce:new w.sqlite3_index_constraint(ce)},w.prototype.nthConstraintUsage=function(H,oe=!1){if(H<0||H>=this.$nConstraint)return!1;const ce=this.$aConstraintUsage+w.sqlite3_index_constraint_usage.structInfo.sizeof*H;return oe?ce:new w.sqlite3_index_constraint_usage(ce)},w.prototype.nthOrderBy=function(H,oe=!1){if(H<0||H>=this.$nOrderBy)return!1;const ce=this.$aOrderBy+w.sqlite3_index_orderby.structInfo.sizeof*H;return oe?ce:new w.sqlite3_index_orderby(ce)};const E=function(H,oe){return(function(ce,Q=!1){if(arguments.length===0&&(ce=new oe),ce instanceof oe)return this.set(ce.pointer,ce),ce;a.isPtr(ce)||n.SQLite3Error.toss("Invalid argument to",H+"()");let W=this.get(ce);return Q&&this.delete(ce),W}).bind(new Map)},j=function(H,oe){const ce=E(H,oe);return Object.assign(Object.create(null),{StructType:oe,create:Q=>{const W=ce();return a.pokePtr(Q,W.pointer),W},get:Q=>ce(Q),unget:Q=>ce(Q,!0),dispose:Q=>{const W=ce(Q,!0);W&&W.dispose()}})};u.xVtab=j("xVtab",l.sqlite3_vtab),u.xCursor=j("xCursor",l.sqlite3_vtab_cursor),u.xIndexInfo=H=>new l.sqlite3_index_info(H),u.xError=function H(oe,ce,Q){if(H.errorReporter instanceof Function)try{H.errorReporter("sqlite3_module::"+oe+"(): "+ce.message)}catch{}let W;return ce instanceof n.WasmAllocError?W=l.SQLITE_NOMEM:arguments.length>2?W=Q:ce instanceof n.SQLite3Error&&(W=ce.resultCode),W||l.SQLITE_ERROR},u.xError.errorReporter=console.error.bind(console),u.xRowid=(H,oe)=>a.poke(H,oe,"i64"),u.setupModule=function(H){let oe=!1;const ce=this instanceof l.sqlite3_module?this:H.struct||(oe=new l.sqlite3_module);try{const Q=H.methods||c("Missing 'methods' object.");for(const W of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const Y=W[0],k=W[1];Q[Y]===!0?Q[Y]=Q[k]:Q[k]===!0&&(Q[k]=Q[Y])}if(H.catchExceptions){const W=function(T,R){return["xConnect","xCreate"].indexOf(T)>=0?function(B,G,F,X,ae,_){try{return R(...arguments)||0}catch(x){return x instanceof n.WasmAllocError||(a.dealloc(a.peekPtr(_)),a.pokePtr(_,a.allocCString(x.message))),u.xError(T,x)}}:function(...B){try{return R(...B)||0}catch(G){return u.xError(T,G)}}},Y=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],k=Object.create(null);for(const T of Y){const R=Q[T];if(R instanceof Function)T==="xConnect"&&Q.xCreate===R?k[T]=Q.xCreate:T==="xCreate"&&Q.xConnect===R?k[T]=Q.xConnect:k[T]=W(T,R);else continue}ce.installMethods(k,!1)}else ce.installMethods(Q,!!H.applyArgcCheck);if(ce.$iVersion===0){let W;typeof H.iVersion=="number"?W=H.iVersion:ce.$xShadowName?W=3:ce.$xSavePoint||ce.$xRelease||ce.$xRollbackTo?W=2:W=1,ce.$iVersion=W}}catch(Q){throw oe&&oe.dispose(),Q}return ce},l.sqlite3_module.prototype.setupModule=function(H){return u.setupModule.call(this,H)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){const a=function l(c){var E;if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((E=navigator==null?void 0:navigator.storage)!=null&&E.getDirectory))return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const u=new URL(globalThis.location.href).searchParams;return u.has("opfs-disable")?Promise.resolve(n):(c.verbose===void 0&&(c.verbose=u.has("opfs-verbose")?+u.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=u.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=l.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(j,H){const oe=[n.config.error,n.config.warn,n.config.log],ce=(M,...Z)=>{c.verbose>M&&oe[M]("OPFS syncer:",...Z)},Q=(...M)=>ce(2,...M),W=(...M)=>ce(1,...M),Y=(...M)=>ce(0,...M),k=n.util.toss,T=n.capi,R=n.util,B=n.wasm,G=T.sqlite3_vfs,F=T.sqlite3_file,X=T.sqlite3_io_methods,ae=Object.create(null),_=()=>{var M;return globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&((M=navigator==null?void 0:navigator.storage)==null?void 0:M.getDirectory)};ae.metrics={dump:function(){let M,Z=0,ie=0,_e=0;for(M in O.opIds){const de=te[M];Z+=de.count,ie+=de.time,_e+=de.wait,de.avgTime=de.count&&de.time?de.time/de.count:0,de.avgWait=de.count&&de.wait?de.wait/de.count:0}n.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",te,`
Total of`,Z,"op(s) for",ie,"ms (incl. "+_e+" ms of waiting on the async side)"),n.config.log("Serialization metrics:",te.s11n),f.postMessage({type:"opfs-async-metrics"})},reset:function(){let M;const Z=_e=>_e.count=_e.time=_e.wait=0;for(M in O.opIds)Z(te[M]=Object.create(null));let ie=te.s11n=Object.create(null);ie=ie.serialize=Object.create(null),ie.count=ie.time=0,ie=te.s11n.deserialize=Object.create(null),ie.count=ie.time=0}};const x=new X,I=new G().addOnDispose(()=>x.dispose());let re;const y=M=>(re=!0,I.dispose(),H(M)),q=()=>(re=!1,j(n)),f=new Worker(new URL("/docs/assets/sqlite3-opfs-async-proxy-DZdsd1Kz.js",self.location.href));setTimeout(()=>{re===void 0&&y(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),f._originalOnError=f.onerror,f.onerror=function(M){Y("Error initializing OPFS asyncer:",M),y(new Error("Loading OPFS async Worker failed for unknown reasons."))};const m=T.sqlite3_vfs_find(null),A=m?new G(m):null;x.$iVersion=1,I.$iVersion=2,I.$szOsFile=T.sqlite3_file.structInfo.sizeof,I.$mxPathname=1024,I.$zName=B.allocCString("opfs"),I.$xDlOpen=I.$xDlError=I.$xDlSym=I.$xDlClose=null,I.addOnDispose("$zName",I.$zName,"cleanup default VFS wrapper",()=>A?A.dispose():null);const O=Object.create(null);O.verbose=c.verbose,O.littleEndian=(()=>{const M=new ArrayBuffer(2);return new DataView(M).setInt16(0,256,!0),new Int16Array(M)[0]===256})(),O.asyncIdleWaitTime=150,O.asyncS11nExceptions=1,O.fileBufferSize=1024*64,O.sabS11nOffset=O.fileBufferSize,O.sabS11nSize=I.$mxPathname*2,O.sabIO=new SharedArrayBuffer(O.fileBufferSize+O.sabS11nSize),O.opIds=Object.create(null);const te=Object.create(null);{let M=0;O.opIds.whichOp=M++,O.opIds.rc=M++,O.opIds.xAccess=M++,O.opIds.xClose=M++,O.opIds.xDelete=M++,O.opIds.xDeleteNoWait=M++,O.opIds.xFileSize=M++,O.opIds.xLock=M++,O.opIds.xOpen=M++,O.opIds.xRead=M++,O.opIds.xSleep=M++,O.opIds.xSync=M++,O.opIds.xTruncate=M++,O.opIds.xUnlock=M++,O.opIds.xWrite=M++,O.opIds.mkdir=M++,O.opIds["opfs-async-metrics"]=M++,O.opIds["opfs-async-shutdown"]=M++,O.opIds.retry=M++,O.sabOP=new SharedArrayBuffer(M*4),ae.metrics.reset()}O.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(M=>{(O.sq3Codes[M]=T[M])===void 0&&k("Maintenance required: not found:",M)}),O.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const me=(M,...Z)=>{const ie=O.opIds[M]||k("Invalid op ID:",M);O.s11n.serialize(...Z),Atomics.store(O.sabOPView,O.opIds.rc,-1),Atomics.store(O.sabOPView,O.opIds.whichOp,ie),Atomics.notify(O.sabOPView,O.opIds.whichOp);const _e=performance.now();for(;Atomics.wait(O.sabOPView,O.opIds.rc,-1)!=="not-equal";);const de=Atomics.load(O.sabOPView,O.opIds.rc);if(te[M].wait+=performance.now()-_e,de&&O.asyncS11nExceptions){const we=O.s11n.deserialize();we&&Y(M+"() async error:",...we)}return de};ae.debug={asyncShutdown:()=>{W("Shutting down OPFS async listener. The OPFS VFS will no longer work."),me("opfs-async-shutdown")},asyncRestart:()=>{W("Attempting to restart OPFS VFS async listener. Might work, might not."),f.postMessage({type:"opfs-async-restart"})}};const xe=()=>{if(O.s11n)return O.s11n;const M=new TextDecoder,Z=new TextEncoder("utf-8"),ie=new Uint8Array(O.sabIO,O.sabS11nOffset,O.sabS11nSize),_e=new DataView(O.sabIO,O.sabS11nOffset,O.sabS11nSize);O.s11n=Object.create(null);const de=Object.create(null);de.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},de.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},de.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},de.string={id:4};const we=b=>de[typeof b]||k("Maintenance required: this value type cannot be serialized.",b),ee=b=>{switch(b){case de.number.id:return de.number;case de.bigint.id:return de.bigint;case de.boolean.id:return de.boolean;case de.string.id:return de.string;default:k("Invalid type ID:",b)}};return O.s11n.deserialize=function(b=!1){++te.s11n.deserialize.count;const g=performance.now(),P=ie[0],D=P?[]:null;if(P){const K=[];let pe=1,ve,Fe,je;for(ve=0;ve<P;++ve,++pe)K.push(ee(ie[pe]));for(ve=0;ve<P;++ve){const mr=K[ve];mr.getter?(je=_e[mr.getter](pe,O.littleEndian),pe+=mr.size):(Fe=_e.getInt32(pe,O.littleEndian),pe+=4,je=M.decode(ie.slice(pe,pe+Fe)),pe+=Fe),D.push(je)}}return b&&(ie[0]=0),te.s11n.deserialize.time+=performance.now()-g,D},O.s11n.serialize=function(...b){const g=performance.now();if(++te.s11n.serialize.count,b.length){const P=[];let D=0,K=1;for(ie[0]=b.length&255;D<b.length;++D,++K)P.push(we(b[D])),ie[K]=P[D].id;for(D=0;D<b.length;++D){const pe=P[D];if(pe.setter)_e[pe.setter](K,b[D],O.littleEndian),K+=pe.size;else{const ve=Z.encode(b[D]);_e.setInt32(K,ve.byteLength,O.littleEndian),K+=4,ie.set(ve,K),K+=ve.byteLength}}}else ie[0]=0;te.s11n.serialize.time+=performance.now()-g},O.s11n},Ie=function M(Z=16){M._chars||(M._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",M._n=M._chars.length);const ie=[];let _e=0;for(;_e<Z;++_e){const de=Math.random()*(M._n*64)%M._n|0;ie[_e]=M._chars[de]}return ie.join("")},Ae=Object.create(null),ke=Object.create(null);ke.op=void 0,ke.start=void 0;const Pe=M=>{ke.start=performance.now(),ke.op=M,++te[M].count},Re=()=>te[ke.op].time+=performance.now()-ke.start,Je={xCheckReservedLock:function(M,Z){return B.poke(Z,0,"i32"),0},xClose:function(M){Pe("xClose");let Z=0;const ie=Ae[M];return ie&&(delete Ae[M],Z=me("xClose",M),ie.sq3File&&ie.sq3File.dispose()),Re(),Z},xDeviceCharacteristics:function(M){return T.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(M,Z,ie){return T.SQLITE_NOTFOUND},xFileSize:function(M,Z){Pe("xFileSize");let ie=me("xFileSize",M);if(ie==0)try{const _e=O.s11n.deserialize()[0];B.poke(Z,_e,"i64")}catch(_e){Y("Unexpected error reading xFileSize() result:",_e),ie=O.sq3Codes.SQLITE_IOERR}return Re(),ie},xLock:function(M,Z){Pe("xLock");const ie=Ae[M];let _e=0;return ie.lockType?ie.lockType=Z:(_e=me("xLock",M,Z),_e===0&&(ie.lockType=Z)),Re(),_e},xRead:function(M,Z,ie,_e){Pe("xRead");const de=Ae[M];let we;try{we=me("xRead",M,ie,Number(_e)),(we===0||T.SQLITE_IOERR_SHORT_READ===we)&&B.heap8u().set(de.sabView.subarray(0,ie),Z)}catch(ee){Y("xRead(",arguments,") failed:",ee,de),we=T.SQLITE_IOERR_READ}return Re(),we},xSync:function(M,Z){Pe("xSync"),++te.xSync.count;const ie=me("xSync",M,Z);return Re(),ie},xTruncate:function(M,Z){Pe("xTruncate");const ie=me("xTruncate",M,Number(Z));return Re(),ie},xUnlock:function(M,Z){Pe("xUnlock");const ie=Ae[M];let _e=0;return T.SQLITE_LOCK_NONE===Z&&ie.lockType&&(_e=me("xUnlock",M,Z)),_e===0&&(ie.lockType=Z),Re(),_e},xWrite:function(M,Z,ie,_e){Pe("xWrite");const de=Ae[M];let we;try{de.sabView.set(B.heap8u().subarray(Z,Z+ie)),we=me("xWrite",M,ie,Number(_e))}catch(ee){Y("xWrite(",arguments,") failed:",ee,de),we=T.SQLITE_IOERR_WRITE}return Re(),we}},Ge={xAccess:function(M,Z,ie,_e){Pe("xAccess");const de=me("xAccess",B.cstrToJs(Z));return B.poke(_e,de?0:1,"i32"),Re(),0},xCurrentTime:function(M,Z){return B.poke(Z,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(M,Z){return B.poke(Z,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(M,Z,ie){Pe("xDelete");const _e=me("xDelete",B.cstrToJs(Z),ie,!1);return Re(),_e},xFullPathname:function(M,Z,ie,_e){return B.cstrncpy(_e,Z,ie)<ie?0:T.SQLITE_CANTOPEN},xGetLastError:function(M,Z,ie){return W("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(Z,ie,_e,de,we){Pe("xOpen");let ee=0;ie===0?ie=Ie():B.isPtr(ie)&&(T.sqlite3_uri_boolean(ie,"opfs-unlock-asap",0)&&(ee|=O.opfsFlags.OPFS_UNLOCK_ASAP),T.sqlite3_uri_boolean(ie,"delete-before-open",0)&&(ee|=O.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),ie=B.cstrToJs(ie));const b=Object.create(null);b.fid=_e,b.filename=ie,b.sab=new SharedArrayBuffer(O.fileBufferSize),b.flags=de,b.readOnly=!(n.SQLITE_OPEN_CREATE&de)&&!!(de&T.SQLITE_OPEN_READONLY);const g=me("xOpen",_e,ie,de,ee);return g||(b.readOnly&&B.poke(we,T.SQLITE_OPEN_READONLY,"i32"),Ae[_e]=b,b.sabView=O.sabFileBufView,b.sq3File=new F(_e),b.sq3File.$pMethods=x.pointer,b.lockType=T.SQLITE_LOCK_NONE),Re(),g}};A&&(I.$xRandomness=A.$xRandomness,I.$xSleep=A.$xSleep),I.$xRandomness||(Ge.xRandomness=function(M,Z,ie){const _e=B.heap8u();let de=0;for(;de<Z;++de)_e[ie+de]=Math.random()*255e3&255;return de}),I.$xSleep||(Ge.xSleep=function(M,Z){return Atomics.wait(O.sabOPView,O.opIds.xSleep,0,Z),0}),ae.getResolvedPath=function(M,Z){const ie=new URL(M,"file://irrelevant").pathname;return Z?ie.split("/").filter(_e=>!!_e):ie},ae.getDirForFilename=async function(Z,ie=!1){const _e=ae.getResolvedPath(Z,!0),de=_e.pop();let we=ae.rootDirectory;for(const ee of _e)ee&&(we=await we.getDirectoryHandle(ee,{create:!!ie}));return[we,de]},ae.mkdir=async function(M){try{return await ae.getDirForFilename(M+"/filepart",!0),!0}catch{return!1}},ae.entryExists=async function(M){try{const[Z,ie]=await ae.getDirForFilename(M);return await Z.getFileHandle(ie),!0}catch{return!1}},ae.randomFilename=Ie,ae.treeList=async function(){const M=async function ie(_e,de){de.name=_e.name,de.dirs=[],de.files=[];for await(const we of _e.values())if(we.kind==="directory"){const ee=Object.create(null);de.dirs.push(ee),await ie(we,ee)}else de.files.push(we.name)},Z=Object.create(null);return await M(ae.rootDirectory,Z),Z},ae.rmfr=async function(){const M=ae.rootDirectory,Z={recurse:!0};for await(const ie of M.values())M.removeEntry(ie.name,Z)},ae.unlink=async function(M,Z=!1,ie=!1){try{const[_e,de]=await ae.getDirForFilename(M,!1);return await _e.removeEntry(de,{recursive:Z}),!0}catch(_e){if(ie)throw new Error("unlink(",arguments[0],") failed: "+_e.message,{cause:_e});return!1}},ae.traverse=async function(M){const Z={recursive:!0,directory:ae.rootDirectory};typeof M=="function"&&(M={callback:M}),M=Object.assign(Z,M||{}),async function _e(de,we){for await(const ee of de.values()){if(M.callback(ee,de,we)===!1)return!1;if(M.recursive&&ee.kind==="directory"&&await _e(ee,we+1)===!1)break}}(M.directory,0)};const Bt=async function(M,Z){const[ie,_e]=await ae.getDirForFilename(M,!0);let we=await(await ie.getFileHandle(_e,{create:!0})).createSyncAccessHandle(),ee=0,b,g=!1;try{for(we.truncate(0);(b=await Z())!==void 0;)b instanceof ArrayBuffer&&(b=new Uint8Array(b)),ee===0&&b.byteLength>=15&&(R.affirmDbHeader(b),g=!0),we.write(b,{at:ee}),ee+=b.byteLength;if((ee<512||ee%512!==0)&&k("Input size",ee,"is not correct for an SQLite database."),!g){const P=new Uint8Array(20);we.read(P,{at:0}),R.affirmDbHeader(P)}return we.write(new Uint8Array([1,1]),{at:18}),ee}catch(P){throw await we.close(),we=void 0,await ie.removeEntry(_e).catch(()=>{}),P}finally{we&&await we.close()}};if(ae.importDb=async function(M,Z){if(Z instanceof Function)return Bt(M,Z);Z instanceof ArrayBuffer&&(Z=new Uint8Array(Z)),R.affirmIsDb(Z);const ie=Z.byteLength,[_e,de]=await ae.getDirForFilename(M,!0);let we,ee=0;try{return we=await(await _e.getFileHandle(de,{create:!0})).createSyncAccessHandle(),we.truncate(0),ee=we.write(Z,{at:0}),ee!=ie&&k("Expected to write "+ie+" bytes but wrote "+ee+"."),we.write(new Uint8Array([1,1]),{at:18}),ee}catch(b){throw we&&(await we.close(),we=void 0),await _e.removeEntry(de).catch(()=>{}),b}finally{we&&await we.close()}},n.oo1){const M=function(...Z){const ie=n.oo1.DB.dbCtorHelper.normalizeArgs(...Z);ie.vfs=I.$zName,n.oo1.DB.dbCtorHelper.call(this,ie)};M.prototype=Object.create(n.oo1.DB.prototype),n.oo1.OpfsDb=M,M.importDb=ae.importDb,n.oo1.DB.dbCtorHelper.setVfsPostOpenCallback(I.pointer,function(Z,ie){ie.capi.sqlite3_busy_timeout(Z,1e4)})}const lt=function(){const M=B.scopedAllocPush(),Z=new F;try{const ie=Z.pointer,_e=T.SQLITE_OPEN_CREATE|T.SQLITE_OPEN_READWRITE|T.SQLITE_OPEN_MAIN_DB,de=B.scopedAlloc(8),we="/sanity/check/file"+Ie(8),ee=B.scopedAllocCString(we);let b;if(O.s11n.serialize("This is ä string."),b=O.s11n.deserialize(),Q("deserialize() says:",b),b[0]!=="This is ä string."&&k("String d13n error."),Ge.xAccess(I.pointer,ee,0,de),b=B.peek(de,"i32"),Q("xAccess(",we,") exists ?=",b),b=Ge.xOpen(I.pointer,ee,ie,_e,de),Q("open rc =",b,"state.sabOPView[xOpen] =",O.sabOPView[O.opIds.xOpen]),b!==0){Y("open failed with code",b);return}Ge.xAccess(I.pointer,ee,0,de),b=B.peek(de,"i32"),b||k("xAccess() failed to detect file."),b=Je.xSync(Z.pointer,0),b&&k("sync failed w/ rc",b),b=Je.xTruncate(Z.pointer,1024),b&&k("truncate failed w/ rc",b),B.poke(de,0,"i64"),b=Je.xFileSize(Z.pointer,de),b&&k("xFileSize failed w/ rc",b),Q("xFileSize says:",B.peek(de,"i64")),b=Je.xWrite(Z.pointer,ee,10,1),b&&k("xWrite() failed!");const g=B.scopedAlloc(16);b=Je.xRead(Z.pointer,g,6,2),B.poke(g+6,0);let P=B.cstrToJs(g);Q("xRead() got:",P),P!=="sanity"&&k("Unexpected xRead() value."),Ge.xSleep&&(Q("xSleep()ing before close()ing..."),Ge.xSleep(I.pointer,2e3),Q("waking up from xSleep()")),b=Je.xClose(ie),Q("xClose rc =",b,"sabOPView =",O.sabOPView),Q("Deleting file:",we),Ge.xDelete(I.pointer,ee,4660),Ge.xAccess(I.pointer,ee,0,de),b=B.peek(de,"i32"),b&&k("Expecting 0 from xAccess(",we,") after xDelete()."),W("End of OPFS sanity checks.")}finally{Z.dispose(),B.scopedAllocPop(M)}};f.onmessage=function({data:M}){switch(M.type){case"opfs-unavailable":y(new Error(M.payload.join(" ")));break;case"opfs-async-loaded":f.postMessage({type:"opfs-async-init",args:O});break;case"opfs-async-inited":{if(re===!0)break;try{n.vfs.installVfs({io:{struct:x,methods:Je},vfs:{struct:I,methods:Ge}}),O.sabOPView=new Int32Array(O.sabOP),O.sabFileBufView=new Uint8Array(O.sabIO,0,O.fileBufferSize),O.sabS11nView=new Uint8Array(O.sabIO,O.sabS11nOffset,O.sabS11nSize),xe(),c.sanityChecks&&(W("Running sanity checks because of opfs-sanity-check URL arg..."),lt()),_()?navigator.storage.getDirectory().then(Z=>{f.onerror=f._originalOnError,delete f._originalOnError,n.opfs=ae,ae.rootDirectory=Z,Q("End of OPFS sqlite3_vfs setup.",I),q()}).catch(y):q()}catch(Z){Y(Z),y(Z)}break}default:{const Z="Unexpected message from the OPFS async worker: "+JSON.stringify(M);Y(Z),y(new Error(Z));break}}}}))};a.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async l=>{try{let c=a.defaultProxyUri;return l.scriptInfo.sqlite3Dir&&(a.defaultProxyUri=l.scriptInfo.sqlite3Dir+c),a().catch(u=>{l.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",u.message)})}catch(c){return l.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(n){var Ae,ke,Pe,Re,Je,Ge,Bt,lt,M,Z,ie,_e,sa,we;const a=n.util.toss,l=n.util.toss3,c=Object.create(null),u=n.capi,w=n.util,E=n.wasm,j=4096,H=512,oe=4,ce=8,Q=H+oe,W=H,Y=Q,k=j,T=u.SQLITE_OPEN_MAIN_DB|u.SQLITE_OPEN_MAIN_JOURNAL|u.SQLITE_OPEN_SUPER_JOURNAL|u.SQLITE_OPEN_WAL,R=".opaque",B=()=>Math.random().toString(36).slice(2),G=new TextDecoder,F=new TextEncoder,X=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2,forceReinitIfPreviouslyFailed:!1}),ae=[n.config.error,n.config.warn,n.config.log];n.config.log;const _=n.config.warn;n.config.error;const x=new Map,I=ee=>x.get(ee),re=(ee,b)=>{b?x.set(ee,b):x.delete(ee)},y=new Map,q=ee=>y.get(ee),f=(ee,b)=>{b?y.set(ee,b):y.delete(ee)},m={xCheckReservedLock:function(ee,b){const g=q(ee);return g.log("xCheckReservedLock"),g.storeErr(),E.poke32(b,1),0},xClose:function(ee){const b=q(ee);b.storeErr();const g=b.getOFileForS3File(ee);if(g)try{b.log(`xClose ${g.path}`),b.mapS3FileToOFile(ee,!1),g.sah.flush(),g.flags&u.SQLITE_OPEN_DELETEONCLOSE&&b.deletePath(g.path)}catch(P){return b.storeErr(P,u.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(ee){return u.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(ee,b,g){return u.SQLITE_NOTFOUND},xFileSize:function(ee,b){const g=q(ee);g.log("xFileSize");const D=g.getOFileForS3File(ee).sah.getSize()-k;return E.poke64(b,BigInt(D)),0},xLock:function(ee,b){const g=q(ee);g.log(`xLock ${b}`),g.storeErr();const P=g.getOFileForS3File(ee);return P.lockType=b,0},xRead:function(ee,b,g,P){const D=q(ee);D.storeErr();const K=D.getOFileForS3File(ee);D.log(`xRead ${K.path} ${g} @ ${P}`);try{const pe=K.sah.read(E.heap8u().subarray(b,b+g),{at:k+Number(P)});return pe<g?(E.heap8u().fill(0,b+pe,b+g),u.SQLITE_IOERR_SHORT_READ):0}catch(pe){return D.storeErr(pe,u.SQLITE_IOERR)}},xSectorSize:function(ee){return j},xSync:function(ee,b){const g=q(ee);g.log(`xSync ${b}`),g.storeErr();const P=g.getOFileForS3File(ee);try{return P.sah.flush(),0}catch(D){return g.storeErr(D,u.SQLITE_IOERR)}},xTruncate:function(ee,b){const g=q(ee);g.log(`xTruncate ${b}`),g.storeErr();const P=g.getOFileForS3File(ee);try{return P.sah.truncate(k+Number(b)),0}catch(D){return g.storeErr(D,u.SQLITE_IOERR)}},xUnlock:function(ee,b){const g=q(ee);g.log("xUnlock");const P=g.getOFileForS3File(ee);return P.lockType=b,0},xWrite:function(ee,b,g,P){const D=q(ee);D.storeErr();const K=D.getOFileForS3File(ee);D.log(`xWrite ${K.path} ${g} ${P}`);try{const pe=K.sah.write(E.heap8u().subarray(b,b+g),{at:k+Number(P)});return g===pe?0:a("Unknown write() failure.")}catch(pe){return D.storeErr(pe,u.SQLITE_IOERR)}}},A=new u.sqlite3_io_methods;A.$iVersion=1,n.vfs.installVfs({io:{struct:A,methods:m}});const O={xAccess:function(ee,b,g,P){const D=I(ee);D.storeErr();try{const K=D.getPath(b);E.poke32(P,D.hasFilename(K)?1:0)}catch{E.poke32(P,0)}return 0},xCurrentTime:function(ee,b){return E.poke(b,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(ee,b){return E.poke(b,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(ee,b,g){const P=I(ee);P.log(`xDelete ${E.cstrToJs(b)}`),P.storeErr();try{return P.deletePath(P.getPath(b)),0}catch(D){return P.storeErr(D),u.SQLITE_IOERR_DELETE}},xFullPathname:function(ee,b,g,P){return E.cstrncpy(P,b,g)<g?0:u.SQLITE_CANTOPEN},xGetLastError:function(ee,b,g){const P=I(ee),D=P.popErr();if(P.log(`xGetLastError ${b} e =`,D),D){const K=E.scopedAllocPush();try{const[pe,ve]=E.scopedAllocCString(D.message,!0);E.cstrncpy(g,pe,b),ve>b&&E.poke8(g+b-1,0)}catch{return u.SQLITE_NOMEM}finally{E.scopedAllocPop(K)}}return D?D.sqlite3Rc||u.SQLITE_IOERR:0},xOpen:function(b,g,P,D,K){const pe=I(b);try{pe.log(`xOpen ${E.cstrToJs(g)} ${D}`);const ve=g&&E.peek8(g)?pe.getPath(g):B();let Fe=pe.getSAHForPath(ve);!Fe&&D&u.SQLITE_OPEN_CREATE&&(pe.getFileCount()<pe.getCapacity()?(Fe=pe.nextAvailableSAH(),pe.setAssociatedPath(Fe,ve,D)):a("SAH pool is full. Cannot create file",ve)),Fe||a("file not found:",ve);const je={path:ve,flags:D,sah:Fe};pe.mapS3FileToOFile(P,je),je.lockType=u.SQLITE_LOCK_NONE;const mr=new u.sqlite3_file(P);return mr.$pMethods=A.pointer,mr.dispose(),E.poke32(K,D),0}catch(ve){return pe.storeErr(ve),u.SQLITE_CANTOPEN}}},te=function(ee){n.capi.sqlite3_vfs_find(ee)&&l("VFS name is already registered:",ee);const b=new u.sqlite3_vfs,g=u.sqlite3_vfs_find(null),P=g?new u.sqlite3_vfs(g):null;return b.$iVersion=2,b.$szOsFile=u.sqlite3_file.structInfo.sizeof,b.$mxPathname=H,b.addOnDispose(b.$zName=E.allocCString(ee),()=>re(b.pointer,0)),P&&(b.$xRandomness=P.$xRandomness,b.$xSleep=P.$xSleep,P.dispose()),!b.$xRandomness&&!O.xRandomness&&(O.xRandomness=function(D,K,pe){const ve=E.heap8u();let Fe=0;for(;Fe<K;++Fe)ve[pe+Fe]=Math.random()*255e3&255;return Fe}),!b.$xSleep&&!O.xSleep&&(O.xSleep=(D,K)=>0),n.vfs.installVfs({vfs:{struct:b,methods:O}}),b};class me{constructor(b=Object.create(null)){z(this,_e);Zt(this,"vfsDir");z(this,Ae);z(this,ke);z(this,Pe);z(this,Re,new Map);z(this,Je,new Map);z(this,Ge,new Set);z(this,Bt,new Map);z(this,lt,new Uint8Array(Q));z(this,M);z(this,Z);z(this,ie);J(this,ie,b.verbosity??X.verbosity),this.vfsName=b.name||X.name,J(this,Z,te(this.vfsName)),re(s(this,Z).pointer,this),this.vfsDir=b.directory||"."+this.vfsName,J(this,M,new DataView(s(this,lt).buffer,s(this,lt).byteOffset)),this.isReady=this.reset(!!(b.clearOnInit??X.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(b.initialCapacity||X.initialCapacity)})}log(...b){be(this,_e,sa).call(this,2,...b)}warn(...b){be(this,_e,sa).call(this,1,...b)}error(...b){be(this,_e,sa).call(this,0,...b)}getVfs(){return s(this,Z)}getCapacity(){return s(this,Re).size}getFileCount(){return s(this,Je).size}getFileNames(){const b=[],g=s(this,Je).keys();for(const P of g)b.push(P);return b}async addCapacity(b){for(let g=0;g<b;++g){const P=B(),K=await(await s(this,ke).getFileHandle(P,{create:!0})).createSyncAccessHandle();s(this,Re).set(K,P),this.setAssociatedPath(K,"",0)}return this.getCapacity()}async reduceCapacity(b){let g=0;for(const P of Array.from(s(this,Ge))){if(g===b||this.getFileCount()===this.getCapacity())break;const D=s(this,Re).get(P);P.close(),await s(this,ke).removeEntry(D),s(this,Re).delete(P),s(this,Ge).delete(P),++g}return g}releaseAccessHandles(){for(const b of s(this,Re).keys())b.close();s(this,Re).clear(),s(this,Je).clear(),s(this,Ge).clear()}async acquireAccessHandles(b){const g=[];for await(const[P,D]of s(this,ke))D.kind==="file"&&g.push([P,D]);return Promise.all(g.map(async([P,D])=>{try{const K=await D.createSyncAccessHandle();if(s(this,Re).set(K,P),b)K.truncate(k),this.setAssociatedPath(K,"",0);else{const pe=this.getAssociatedPath(K);pe?s(this,Je).set(pe,K):s(this,Ge).add(K)}}catch(K){throw this.storeErr(K),this.releaseAccessHandles(),K}}))}getAssociatedPath(b){b.read(s(this,lt),{at:0});const g=s(this,M).getUint32(W);if(s(this,lt)[0]&&(g&u.SQLITE_OPEN_DELETEONCLOSE||!(g&T)))return _(`Removing file with unexpected flags ${g.toString(16)}`,s(this,lt)),this.setAssociatedPath(b,"",0),"";const P=new Uint32Array(ce/4);b.read(P,{at:Y});const D=this.computeDigest(s(this,lt));if(P.every((K,pe)=>K===D[pe])){const K=s(this,lt).findIndex(pe=>pe===0);return K===0&&b.truncate(k),K?G.decode(s(this,lt).subarray(0,K)):""}else return _("Disassociating file with bad digest."),this.setAssociatedPath(b,"",0),""}setAssociatedPath(b,g,P){const D=F.encodeInto(g,s(this,lt));H<=D.written+1&&a("Path too long:",g),s(this,lt).fill(0,D.written,H),s(this,M).setUint32(W,P);const K=this.computeDigest(s(this,lt));b.write(s(this,lt),{at:0}),b.write(K,{at:Y}),b.flush(),g?(s(this,Je).set(g,b),s(this,Ge).delete(b)):(b.truncate(k),s(this,Ge).add(b))}computeDigest(b){let g=3735928559,P=1103547991;for(const D of b)g=31*g+D*307,P=31*P+D*307;return new Uint32Array([g>>>0,P>>>0])}async reset(b){await this.isReady;let g=await navigator.storage.getDirectory(),P;for(const D of this.vfsDir.split("/"))D&&(P=g,g=await g.getDirectoryHandle(D,{create:!0}));return J(this,Ae,g),J(this,Pe,P),J(this,ke,await s(this,Ae).getDirectoryHandle(R,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(b)}getPath(b){return E.isPtr(b)&&(b=E.cstrToJs(b)),(b instanceof URL?b:new URL(b,"file://localhost/")).pathname}deletePath(b){const g=s(this,Je).get(b);return g&&(s(this,Je).delete(b),this.setAssociatedPath(g,"",0)),!!g}storeErr(b,g){return b&&(b.sqlite3Rc=g||u.SQLITE_IOERR,this.error(b)),this.$error=b,g}popErr(){const b=this.$error;return this.$error=void 0,b}nextAvailableSAH(){const[b]=s(this,Ge).keys();return b}getOFileForS3File(b){return s(this,Bt).get(b)}mapS3FileToOFile(b,g){g?(s(this,Bt).set(b,g),f(b,this)):(s(this,Bt).delete(b),f(b,!1))}hasFilename(b){return s(this,Je).has(b)}getSAHForPath(b){return s(this,Je).get(b)}async removeVfs(){if(!s(this,Z).pointer||!s(this,ke))return!1;u.sqlite3_vfs_unregister(s(this,Z).pointer),s(this,Z).dispose(),delete c[this.vfsName];try{this.releaseAccessHandles(),await s(this,Ae).removeEntry(R,{recursive:!0}),J(this,ke,void 0),await s(this,Pe).removeEntry(s(this,Ae).name,{recursive:!0}),J(this,Ae,J(this,Pe,void 0))}catch(b){n.config.error(this.vfsName,"removeVfs() failed:",b)}return!0}exportFile(b){const g=s(this,Je).get(b)||a("File not found:",b),P=g.getSize()-k,D=new Uint8Array(P>0?P:0);if(P>0){const K=g.read(D,{at:k});K!=P&&a("Expected to read "+P+" bytes but read "+K+".")}return D}async importDbChunked(b,g){const P=s(this,Je).get(b)||this.nextAvailableSAH()||a("No available handles to import to.");P.truncate(0);let D=0,K,pe=!1;try{for(;(K=await g())!==void 0;)K instanceof ArrayBuffer&&(K=new Uint8Array(K)),D===0&&K.byteLength>=15&&(w.affirmDbHeader(K),pe=!0),P.write(K,{at:k+D}),D+=K.byteLength;if((D<512||D%512!==0)&&a("Input size",D,"is not correct for an SQLite database."),!pe){const ve=new Uint8Array(20);P.read(ve,{at:0}),w.affirmDbHeader(ve)}P.write(new Uint8Array([1,1]),{at:k+18})}catch(ve){throw this.setAssociatedPath(P,"",0),ve}return this.setAssociatedPath(P,b,u.SQLITE_OPEN_MAIN_DB),D}importDb(b,g){if(g instanceof ArrayBuffer)g=new Uint8Array(g);else if(g instanceof Function)return this.importDbChunked(b,g);const P=s(this,Je).get(b)||this.nextAvailableSAH()||a("No available handles to import to."),D=g.byteLength;(D<512||D%512!=0)&&a("Byte array size is invalid for an SQLite db.");const K="SQLite format 3";for(let ve=0;ve<K.length;++ve)K.charCodeAt(ve)!==g[ve]&&a("Input does not contain an SQLite database header.");const pe=P.write(g,{at:k});return pe!=D?(this.setAssociatedPath(P,"",0),a("Expected to write "+D+" bytes but wrote "+pe+".")):(P.write(new Uint8Array([1,1]),{at:k+18}),this.setAssociatedPath(P,b,u.SQLITE_OPEN_MAIN_DB)),pe}}Ae=new WeakMap,ke=new WeakMap,Pe=new WeakMap,Re=new WeakMap,Je=new WeakMap,Ge=new WeakMap,Bt=new WeakMap,lt=new WeakMap,M=new WeakMap,Z=new WeakMap,ie=new WeakMap,_e=new WeakSet,sa=function(b,...g){s(this,ie)>b&&ae[b](this.vfsName+":",...g)};class xe{constructor(b){z(this,we);J(this,we,b),this.vfsName=b.vfsName}async addCapacity(b){return s(this,we).addCapacity(b)}async reduceCapacity(b){return s(this,we).reduceCapacity(b)}getCapacity(){return s(this,we).getCapacity(s(this,we))}getFileCount(){return s(this,we).getFileCount()}getFileNames(){return s(this,we).getFileNames()}async reserveMinimumCapacity(b){const g=s(this,we).getCapacity();return g<b?s(this,we).addCapacity(b-g):g}exportFile(b){return s(this,we).exportFile(b)}importDb(b,g){return s(this,we).importDb(b,g)}async wipeFiles(){return s(this,we).reset(!0)}unlink(b){return s(this,we).deletePath(b)}async removeVfs(){return s(this,we).removeVfs()}}we=new WeakMap;const Ie=async()=>{const ee=await navigator.storage.getDirectory(),b=".opfs-sahpool-sync-check-"+B(),D=(await(await ee.getFileHandle(b,{create:!0})).createSyncAccessHandle()).close();return await D,await ee.removeEntry(b),D!=null&&D.then&&a("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};n.installOpfsSAHPoolVfs=async function(ee=Object.create(null)){var g;ee=Object.assign(Object.create(null),X,ee||{});const b=ee.name;if(ee.$testThrowPhase1)throw ee.$testThrowPhase1;if(c[b])try{return await c[b]}catch(P){if(ee.forceReinitIfPreviouslyFailed)delete c[b];else throw P}return!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((g=navigator==null?void 0:navigator.storage)!=null&&g.getDirectory)?c[b]=Promise.reject(new Error("Missing required OPFS APIs.")):c[b]=Ie().then(async function(){if(ee.$testThrowPhase2)throw ee.$testThrowPhase2;const P=new me(ee);return P.isReady.then(async()=>{const D=new xe(P);if(n.oo1){const K=n.oo1,pe=P.getVfs(),ve=function(...Fe){const je=K.DB.dbCtorHelper.normalizeArgs(...Fe);je.vfs=pe.$zName,K.DB.dbCtorHelper.call(this,je)};ve.prototype=Object.create(K.DB.prototype),D.OpfsSAHPoolDb=ve}return P.log("VFS initialized."),D}).catch(async D=>{throw await P.removeVfs().catch(()=>{}),D})}).catch(P=>c[b]=Promise.reject(P))}}),typeof o<"u"){const n=Object.assign(Object.create(null),{exports:typeof N>"u"?o.asm:N,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=n;let a;try{a=globalThis.sqlite3ApiBootstrap()}catch(l){throw console.error("sqlite3ApiBootstrap() error:",l),l}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=a}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")},t=C,t}})();ca=function(){var t,o;const r=ca;if(!r)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:(t=globalThis==null?void 0:globalThis.document)==null?void 0:t.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:(o=globalThis==null?void 0:globalThis.location)!=null&&o.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...p)=>console.warn("sqlite3.debugModule:",...p):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const p=e.moduleScript.src.split("/");p.pop(),e.sqlite3Dir=p.join("/")+"/"}if(globalThis.sqlite3InitModule=function p(...L){return r(...L).then(C=>{C.runSQLite3PostLoadInit(C);const ne=C.sqlite3;ne.scriptInfo=e,p.__isUnderTest&&(ne.__isUnderTest=!0);const le=ne.asyncPostInit;return delete ne.asyncPostInit,le()}).catch(C=>{throw console.error("Exception loading sqlite3 module:",C),C})},globalThis.sqlite3InitModule.ready=r.ready,globalThis.sqlite3InitModuleState.moduleScript){const p=globalThis.sqlite3InitModuleState;let L=p.moduleScript.src.split("/");L.pop(),p.scriptDir=L.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();var Bu=ca;globalThis.sqlite3Worker1Promiser=function r(e=r.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const U=e;e=Object.assign(Object.create(null),r.defaultConfig),e.onready=U}else e=Object.assign(Object.create(null),r.defaultConfig,e);const t=Object.create(null),o=function(){},p=e.onerror||o,L=e.debug||o,C=e.generateMessageId?void 0:Object.create(null),ne=e.generateMessageId||function(U){return U.type+"#"+(C[U.type]=(C[U.type]||0)+1)},le=(...U)=>{throw new Error(U.join(" "))};e.worker||(e.worker=r.defaultConfig.worker),typeof e.worker=="function"&&(e.worker=e.worker());let $,fe;return e.worker.onmessage=function(U){U=U.data,L("worker1.onmessage",U);let he=t[U.messageId];if(!he){if(U&&U.type==="sqlite3-api"&&U.result==="worker1-ready"){e.onready&&e.onready(fe);return}if(he=t[U.type],he&&he.onrow){he.onrow(U);return}e.onunhandled?e.onunhandled(arguments[0]):p("sqlite3Worker1Promiser() unhandled worker message:",U);return}switch(delete t[U.messageId],U.type){case"error":he.reject(U);return;case"open":$||($=U.dbId);break;case"close":U.dbId===$&&($=void 0);break}try{he.resolve(U)}catch(qe){he.reject(qe)}},fe=function(){let U;arguments.length===1?U=arguments[0]:arguments.length===2?(U=Object.create(null),U.type=arguments[0],U.args=arguments[1],U.dbId=U.args.dbId):le("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!U.dbId&&U.type!=="open"&&(U.dbId=$),U.messageId=ne(U),U.departureTime=performance.now();const he=Object.create(null);he.message=U;let qe;U.type==="exec"&&U.args&&(typeof U.args.callback=="function"?(qe=U.messageId+":row",he.onrow=U.args.callback,U.args.callback=qe,t[qe]=he):typeof U.args.callback=="string"&&le("exec callback may not be a string when using the Promise interface."));let Be=new Promise(function(Me,Oe){he.resolve=Me,he.reject=Oe,t[U.messageId]=he,L("Posting",U.type,"message to Worker dbId="+($||"default")+":",U),e.worker.postMessage(U)});return qe&&(Be=Be.finally(()=>delete t[qe])),Be}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("/docs/assets/sqlite3-worker1-bundler-friendly-CZDPUhcf.js",self.location.href),{type:"module"})},onerror:(...r)=>console.error("worker1 promiser error",...r)},sqlite3Worker1Promiser.v2=(function(r){let e;typeof r=="function"?(e=r,r={}):typeof(r==null?void 0:r.onready)=="function"&&(e=r.onready,delete r.onready);const t=Object.create(null);r=Object.assign(r||Object.create(null),{onready:async function(p){try{e&&await e(p),t.resolve(p)}catch(L){t.reject(L)}}});const o=new Promise(function(p,L){t.resolve=p,t.reject=L});try{this.original(r)}catch(p){t.reject(p)}return o}).bind({original:sqlite3Worker1Promiser}),sqlite3Worker1Promiser.v2;class Mu{constructor(){z(this,Ki);J(this,Ki,0)}set(e){let t=s(this,Ki);return J(this,Ki,e??t+1),t}get count(){return s(this,Ki)}}Ki=new WeakMap;function Uu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var jl={},ua,zl;function Qu(){if(zl)return ua;zl=1,ua=r;function r(t){if(t)return e(t)}function e(t){for(var o in r.prototype)t[o]=r.prototype[o];return t}return r.prototype.on=r.prototype.addEventListener=function(t,o){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(o),this},r.prototype.once=function(t,o){var p=this;this._callbacks=this._callbacks||{};function L(){p.off(t,L),o.apply(this,arguments)}return L.fn=o,this.on(t,L),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,o){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var p=this._callbacks[t];if(!p)return this;if(arguments.length==1)return delete this._callbacks[t],this;for(var L,C=0;C<p.length;C++)if(L=p[C],L===o||L.fn===o){p.splice(C,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var o=[].slice.call(arguments,1),p=this._callbacks[t];if(p){p=p.slice(0);for(var L=0,C=p.length;L<C;++L)p[L].apply(this,o)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length},ua}var da,Vl;function ju(){if(Vl)return da;Vl=1;var r=Qu();function e(){r.call(this)}return e.prototype=new r,da=e,e.Stream=e,e.prototype.pipe=function(t,o){var p=this;function L(he){t.writable&&t.write(he)===!1&&p.pause&&p.pause()}p.on("data",L);function C(){p.readable&&p.resume&&p.resume()}t.on("drain",C),!t._isStdio&&(!o||o.end!==!1)&&(p.on("end",le),p.on("close",$));var ne=!1;function le(){ne||(ne=!0,t.end())}function $(){ne||(ne=!0,typeof t.destroy=="function"&&t.destroy())}function fe(he){if(U(),!this.hasListeners("error"))throw he}p.on("error",fe),t.on("error",fe);function U(){p.off("data",L),t.off("drain",C),p.off("end",le),p.off("close",$),p.off("error",fe),t.off("error",fe),p.off("end",U),p.off("close",U),t.off("end",U),t.off("close",U)}return p.on("end",U),p.on("close",U),t.on("end",U),t.on("close",U),t.emit("pipe",p),t},da}(function(r){var e={};(function(t){var o=typeof process=="object"&&e?e:self;t.parser=function(V){return new qe(V)},t.CParser=qe,t.CStream=Me,t.createStream=Be,t.MAX_BUFFER_LENGTH=64*1024,t.DEBUG=o.CDEBUG==="debug",t.INFO=o.CDEBUG==="debug"||o.CDEBUG==="info",t.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var p={textNode:void 0,numberNode:""},L=t.EVENTS.filter(function(V){return V!=="error"&&V!=="end"}),C=0,ne;t.STATE={BEGIN:C++,VALUE:C++,OPEN_OBJECT:C++,CLOSE_OBJECT:C++,OPEN_ARRAY:C++,CLOSE_ARRAY:C++,TEXT_ESCAPE:C++,STRING:C++,BACKSLASH:C++,END:C++,OPEN_KEY:C++,CLOSE_KEY:C++,TRUE:C++,TRUE2:C++,TRUE3:C++,FALSE:C++,FALSE2:C++,FALSE3:C++,FALSE4:C++,NULL:C++,NULL2:C++,NULL3:C++,NUMBER_DECIMAL_POINT:C++,NUMBER_DIGIT:C++};for(var le in t.STATE)t.STATE[t.STATE[le]]=le;C=t.STATE;const $={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125};Object.create||(Object.create=function(V){function S(){this.__proto__=V}return S.prototype=V,new S}),Object.getPrototypeOf||(Object.getPrototypeOf=function(V){return V.__proto__}),Object.keys||(Object.keys=function(V){var S=[];for(var ge in V)V.hasOwnProperty(ge)&&S.push(ge);return S});function fe(V){var S=Math.max(t.MAX_BUFFER_LENGTH,10),ge=0;for(var se in p){var Ot=V[se]===void 0?0:V[se].length;if(Ot>S)switch(se){case"text":closeText(V);break;default:Le(V,"Max buffer length exceeded: "+se)}ge=Math.max(ge,Ot)}V.bufferCheckPosition=t.MAX_BUFFER_LENGTH-ge+V.position}function U(V){for(var S in p)V[S]=p[S]}var he=/[\\"\n]/g;function qe(V){if(!(this instanceof qe))return new qe(V);var S=this;U(S),S.bufferCheckPosition=t.MAX_BUFFER_LENGTH,S.q=S.c=S.p="",S.opt=V||{},S.closed=S.closedRoot=S.sawRoot=!1,S.tag=S.error=null,S.state=C.BEGIN,S.stack=new Array,S.position=S.column=0,S.line=1,S.slashed=!1,S.unicodeI=0,S.unicodeS=null,S.depth=0,Oe(S,"onready")}qe.prototype={end:function(){pr(this)},write:De,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{ne=ju().Stream}catch{ne=function(){}}function Be(V){return new Me(V)}function Me(V){if(!(this instanceof Me))return new Me(V);this._parser=new qe(V),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var S=this;ne.apply(S),this._parser.onend=function(){S.emit("end")},this._parser.onerror=function(ge){S.emit("error",ge),S._parser.error=null},L.forEach(function(ge){Object.defineProperty(S,"on"+ge,{get:function(){return S._parser["on"+ge]},set:function(se){if(!se)return S.removeAllListeners(ge),S._parser["on"+ge]=se,se;S.on(ge,se)},enumerable:!0,configurable:!1})})}Me.prototype=Object.create(ne.prototype,{constructor:{value:Me}}),Me.prototype.write=function(V){V=new Buffer(V);for(var S=0;S<V.length;S++){var ge=V[S];if(this.bytes_remaining>0){for(var se=0;se<this.bytes_remaining;se++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+se]=V[se];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,S=S+se-1,this._parser.write(this.string),this.emit("data",this.string);continue}if(this.bytes_remaining===0&&ge>=128)if(ge>=194&&ge<=223&&(this.bytes_in_sequence=2),ge>=224&&ge<=239&&(this.bytes_in_sequence=3),ge>=240&&ge<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+S>V.length){for(var Ot=0;Ot<=V.length-1-S;Ot++)this.temp_buffs[this.bytes_in_sequence][Ot]=V[S+Ot];return this.bytes_remaining=S+this.bytes_in_sequence-V.length,!0}else{this.string=V.slice(S,S+this.bytes_in_sequence).toString(),S=S+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string);continue}for(var Xt=S;Xt<V.length&&!(V[Xt]>=128);Xt++);this.string=V.slice(S,Xt).toString(),this._parser.write(this.string),this.emit("data",this.string),S=Xt-1}},Me.prototype.end=function(V){return V&&V.length&&this._parser.write(V.toString()),this._parser.end(),!0},Me.prototype.on=function(V,S){var ge=this;return!ge._parser["on"+V]&&L.indexOf(V)!==-1&&(ge._parser["on"+V]=function(){var se=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);se.splice(0,0,V),ge.emit.apply(ge,se)}),ne.prototype.on.call(ge,V,S)},Me.prototype.destroy=function(){U(this._parser),this.emit("close")};function Oe(V,S,ge){t.INFO&&console.log("-- emit",S,ge),V[S]&&V[S](ge)}function yt(V,S,ge){wt(V),Oe(V,S,ge)}function wt(V,S){V.textNode=qr(V.opt,V.textNode),V.textNode!==void 0&&Oe(V,S||"onvalue",V.textNode),V.textNode=void 0}function _t(V){V.numberNode&&Oe(V,"onvalue",parseFloat(V.numberNode)),V.numberNode=""}function qr(V,S){return S===void 0||(V.trim&&(S=S.trim()),V.normalize&&(S=S.replace(/\s+/g," "))),S}function Le(V,S){return wt(V),S+=`
Line: `+V.line+`
Column: `+V.column+`
Char: `+V.c,S=new Error(S),V.error=S,Oe(V,"onerror",S),V}function pr(V){return(V.state!==C.VALUE||V.depth!==0)&&Le(V,"Unexpected end"),wt(V),V.c="",V.closed=!0,Oe(V,"onend"),qe.call(V,V.opt),V}function Yt(V){return V===$.carriageReturn||V===$.lineFeed||V===$.space||V===$.tab}function De(V){var S=this;if(this.error)throw this.error;if(S.closed)return Le(S,"Cannot write after close. Assign an onready handler.");if(V===null)return pr(S);var ge=0,se=V.charCodeAt(0),Ot=S.p,Xt=!1;for(t.DEBUG&&console.log("write -> ["+V+"]");se&&(Ot=se,S.c=se=V.charCodeAt(ge++),Ot!==se?S.p=Ot:Ot=S.p,!!se);)switch(t.DEBUG&&console.log(ge,se,t.STATE[S.state]),Xt?Xt=!1:(S.position++,se===$.lineFeed?(S.line++,S.column=0):S.column++),S.state){case C.BEGIN:se===$.openBrace?S.state=C.OPEN_OBJECT:se===$.openBracket?S.state=C.OPEN_ARRAY:Yt(se)||Le(S,"Non-whitespace before {[.");continue;case C.OPEN_KEY:case C.OPEN_OBJECT:if(Yt(se))continue;if(S.state===C.OPEN_KEY)S.stack.push(C.CLOSE_KEY);else if(se===$.closeBrace){Oe(S,"onopenobject"),this.depth++,Oe(S,"oncloseobject"),this.depth--,S.state=S.stack.pop()||C.VALUE;continue}else S.stack.push(C.CLOSE_OBJECT);se===$.doubleQuote?S.state=C.STRING:Le(S,'Malformed object key should start with "');continue;case C.CLOSE_KEY:case C.CLOSE_OBJECT:if(Yt(se))continue;S.state,C.CLOSE_KEY,se===$.colon?(S.state===C.CLOSE_OBJECT?(S.stack.push(C.CLOSE_OBJECT),wt(S,"onopenobject"),this.depth++):wt(S,"onkey"),S.state=C.VALUE):se===$.closeBrace?(yt(S,"oncloseobject"),this.depth--,S.state=S.stack.pop()||C.VALUE):se===$.comma?(S.state===C.CLOSE_OBJECT&&S.stack.push(C.CLOSE_OBJECT),wt(S),S.state=C.OPEN_KEY):Le(S,"Bad object");continue;case C.OPEN_ARRAY:case C.VALUE:if(Yt(se))continue;if(S.state===C.OPEN_ARRAY)if(Oe(S,"onopenarray"),this.depth++,S.state=C.VALUE,se===$.closeBracket){Oe(S,"onclosearray"),this.depth--,S.state=S.stack.pop()||C.VALUE;continue}else S.stack.push(C.CLOSE_ARRAY);se===$.doubleQuote?S.state=C.STRING:se===$.openBrace?S.state=C.OPEN_OBJECT:se===$.openBracket?S.state=C.OPEN_ARRAY:se===$.t?S.state=C.TRUE:se===$.f?S.state=C.FALSE:se===$.n?S.state=C.NULL:se===$.minus?S.numberNode+="-":$._0<=se&&se<=$._9?(S.numberNode+=String.fromCharCode(se),S.state=C.NUMBER_DIGIT):Le(S,"Bad value");continue;case C.CLOSE_ARRAY:if(se===$.comma)S.stack.push(C.CLOSE_ARRAY),wt(S,"onvalue"),S.state=C.VALUE;else if(se===$.closeBracket)yt(S,"onclosearray"),this.depth--,S.state=S.stack.pop()||C.VALUE;else{if(Yt(se))continue;Le(S,"Bad array")}continue;case C.STRING:S.textNode===void 0&&(S.textNode="");var Mt=ge-1,Ut=S.slashed,_r=S.unicodeI;e:for(;;){for(t.DEBUG&&console.log(ge,se,t.STATE[S.state],Ut);_r>0;)if(S.unicodeS+=String.fromCharCode(se),se=V.charCodeAt(ge++),S.position++,_r===4?(S.textNode+=String.fromCharCode(parseInt(S.unicodeS,16)),_r=0,Mt=ge-1):_r++,!se)break e;if(se===$.doubleQuote&&!Ut){S.state=S.stack.pop()||C.VALUE,S.textNode+=V.substring(Mt,ge-1),S.position+=ge-1-Mt;break}if(se===$.backslash&&!Ut&&(Ut=!0,S.textNode+=V.substring(Mt,ge-1),S.position+=ge-1-Mt,se=V.charCodeAt(ge++),S.position++,!se))break;if(Ut){if(Ut=!1,se===$.n?S.textNode+=`
`:se===$.r?S.textNode+="\r":se===$.t?S.textNode+="	":se===$.f?S.textNode+="\f":se===$.b?S.textNode+="\b":se===$.u?(_r=1,S.unicodeS=""):S.textNode+=String.fromCharCode(se),se=V.charCodeAt(ge++),S.position++,Mt=ge-1,se)continue;break}he.lastIndex=ge;var Ui=he.exec(V);if(Ui===null){ge=V.length+1,S.textNode+=V.substring(Mt,ge-1),S.position+=ge-1-Mt;break}if(ge=Ui.index+1,se=V.charCodeAt(Ui.index),!se){S.textNode+=V.substring(Mt,ge-1),S.position+=ge-1-Mt;break}}S.slashed=Ut,S.unicodeI=_r;continue;case C.TRUE:se===$.r?S.state=C.TRUE2:Le(S,"Invalid true started with t"+se);continue;case C.TRUE2:se===$.u?S.state=C.TRUE3:Le(S,"Invalid true started with tr"+se);continue;case C.TRUE3:se===$.e?(Oe(S,"onvalue",!0),S.state=S.stack.pop()||C.VALUE):Le(S,"Invalid true started with tru"+se);continue;case C.FALSE:se===$.a?S.state=C.FALSE2:Le(S,"Invalid false started with f"+se);continue;case C.FALSE2:se===$.l?S.state=C.FALSE3:Le(S,"Invalid false started with fa"+se);continue;case C.FALSE3:se===$.s?S.state=C.FALSE4:Le(S,"Invalid false started with fal"+se);continue;case C.FALSE4:se===$.e?(Oe(S,"onvalue",!1),S.state=S.stack.pop()||C.VALUE):Le(S,"Invalid false started with fals"+se);continue;case C.NULL:se===$.u?S.state=C.NULL2:Le(S,"Invalid null started with n"+se);continue;case C.NULL2:se===$.l?S.state=C.NULL3:Le(S,"Invalid null started with nu"+se);continue;case C.NULL3:se===$.l?(Oe(S,"onvalue",null),S.state=S.stack.pop()||C.VALUE):Le(S,"Invalid null started with nul"+se);continue;case C.NUMBER_DECIMAL_POINT:se===$.period?(S.numberNode+=".",S.state=C.NUMBER_DIGIT):Le(S,"Leading zero not followed by .");continue;case C.NUMBER_DIGIT:$._0<=se&&se<=$._9?S.numberNode+=String.fromCharCode(se):se===$.period?(S.numberNode.indexOf(".")!==-1&&Le(S,"Invalid number has two dots"),S.numberNode+="."):se===$.e||se===$.E?((S.numberNode.indexOf("e")!==-1||S.numberNode.indexOf("E")!==-1)&&Le(S,"Invalid number has two exponential"),S.numberNode+="e"):se===$.plus||se===$.minus?(Ot===$.e||Ot===$.E||Le(S,"Invalid symbol in number"),S.numberNode+=String.fromCharCode(se)):(_t(S),ge--,Xt=!0,S.state=S.stack.pop()||C.VALUE);continue;default:Le(S,"Unknown state: "+S.state)}return S.position>=S.bufferCheckPosition&&fe(S),S}})(r)})(jl);var zu=Uu(jl);const $l=(r,e)=>{const t=zu.parser();let o="",p=0,L=null,C=!1,ne=[];const le=()=>ne[ne.length-1],$=()=>ne.length===0;return t.onkey=fe=>{fe===r&&p===e&&(C=!0),o=fe},t.onopenobject=fe=>{if(p+1===e&&fe===r)C=!0,ne.push({});else if(C)if($())ne.push({});else{const U={};Array.isArray(le())?le().push(U):le()[o]=U,ne.push(U)}p++,o=fe},t.onopenarray=()=>{if(C){const fe=[];$()?ne.push([]):(Array.isArray(le())?le().push(fe):le()[o]=fe,ne.push(fe))}p++},t.onvalue=fe=>{C?ne.length>0?Array.isArray(le())?le().push(fe):le()[o]=fe:(L=fe,C=!1):o===r&&p===e&&(L=fe)},t.oncloseobject=()=>{if(p--,C){const fe=ne.pop();p===e&&(C=!1,ne=[],L=fe)}},t.onclosearray=()=>{if(p--,C){const fe=ne.pop();p===e&&(C=!1,ne=[],L=fe)}},fe=>{if(t.write(fe),L)return{hd:L,tl:null};if(ne.length>0){const U=structuredClone(ne[0]);if(Array.isArray(U)){const he=U.pop();return{hd:U,tl:he}}else{const he=Object.keys(U),qe=he[he.length-1],Be=U[qe];return delete U[qe],{hd:U,tl:Be}}}else return null}};var er=Uint8Array,vn=Uint16Array,Vu=Int32Array,Hl=new er([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Jl=new er([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$u=new er([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gl=function(r,e){for(var t=new vn(31),o=0;o<31;++o)t[o]=e+=1<<r[o-1];for(var p=new Vu(t[30]),o=1;o<30;++o)for(var L=t[o];L<t[o+1];++L)p[L]=L-t[o]<<5|o;return{b:t,r:p}},Kl=Gl(Hl,2),Yl=Kl.b,Hu=Kl.r;Yl[28]=258,Hu[258]=28;for(var Ju=Gl(Jl,0),Gu=Ju.b,fa=new vn(32768),at=0;at<32768;++at){var gi=(at&43690)>>1|(at&21845)<<1;gi=(gi&52428)>>2|(gi&13107)<<2,gi=(gi&61680)>>4|(gi&3855)<<4,fa[at]=((gi&65280)>>8|(gi&255)<<8)>>1}for(var ys=function(r,e,t){for(var o=r.length,p=0,L=new vn(e);p<o;++p)r[p]&&++L[r[p]-1];var C=new vn(e);for(p=1;p<e;++p)C[p]=C[p-1]+L[p-1]<<1;var ne;if(t){ne=new vn(1<<e);var le=15-e;for(p=0;p<o;++p)if(r[p])for(var $=p<<4|r[p],fe=e-r[p],U=C[r[p]-1]++<<fe,he=U|(1<<fe)-1;U<=he;++U)ne[fa[U]>>le]=$}else for(ne=new vn(o),p=0;p<o;++p)r[p]&&(ne[p]=fa[C[r[p]-1]++]>>15-r[p]);return ne},gs=new er(288),at=0;at<144;++at)gs[at]=8;for(var at=144;at<256;++at)gs[at]=9;for(var at=256;at<280;++at)gs[at]=7;for(var at=280;at<288;++at)gs[at]=8;for(var Xl=new er(32),at=0;at<32;++at)Xl[at]=5;var Ku=ys(gs,9,1),Yu=ys(Xl,5,1),ha=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},xr=function(r,e,t){var o=e/8|0;return(r[o]|r[o+1]<<8)>>(e&7)&t},pa=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Xu=function(r){return(r+7)/8|0},_a=function(r,e,t){return(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length),new er(r.subarray(e,t))},Zu=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yr=function(r,e,t){var o=new Error(e||Zu[r]);if(o.code=r,Error.captureStackTrace&&Error.captureStackTrace(o,yr),!t)throw o;return o},ed=function(r,e,t,o){var p=r.length,L=o?o.length:0;if(!p||e.f&&!e.l)return t||new er(0);var C=!t,ne=C||e.i!=2,le=e.i;C&&(t=new er(p*3));var $=function(hs){var io=t.length;if(hs>io){var ta=new er(Math.max(io*2,hs));ta.set(t),t=ta}},fe=e.f||0,U=e.p||0,he=e.b||0,qe=e.l,Be=e.d,Me=e.m,Oe=e.n,yt=p*8;do{if(!qe){fe=xr(r,U,1);var wt=xr(r,U+1,3);if(U+=3,wt)if(wt==1)qe=Ku,Be=Yu,Me=9,Oe=5;else if(wt==2){var pr=xr(r,U,31)+257,Yt=xr(r,U+10,15)+4,De=pr+xr(r,U+5,31)+1;U+=14;for(var V=new er(De),S=new er(19),ge=0;ge<Yt;++ge)S[$u[ge]]=xr(r,U+ge*3,7);U+=Yt*3;for(var se=ha(S),Ot=(1<<se)-1,Xt=ys(S,se,1),ge=0;ge<De;){var Mt=Xt[xr(r,U,Ot)];U+=Mt&15;var _t=Mt>>4;if(_t<16)V[ge++]=_t;else{var Ut=0,_r=0;for(_t==16?(_r=3+xr(r,U,3),U+=2,Ut=V[ge-1]):_t==17?(_r=3+xr(r,U,7),U+=3):_t==18&&(_r=11+xr(r,U,127),U+=7);_r--;)V[ge++]=Ut}}var Ui=V.subarray(0,pr),Gr=V.subarray(pr);Me=ha(Ui),Oe=ha(Gr),qe=ys(Ui,Me,1),Be=ys(Gr,Oe,1)}else yr(1);else{var _t=Xu(U)+4,qr=r[_t-4]|r[_t-3]<<8,Le=_t+qr;if(Le>p){le&&yr(0);break}ne&&$(he+qr),t.set(r.subarray(_t,Le),he),e.b=he+=qr,e.p=U=Le*8,e.f=fe;continue}if(U>yt){le&&yr(0);break}}ne&&$(he+131072);for(var vl=(1<<Me)-1,xl=(1<<Oe)-1,Wr=U;;Wr=U){var Ut=qe[pa(r,U)&vl],vr=Ut>>4;if(U+=Ut&15,U>yt){le&&yr(0);break}if(Ut||yr(2),vr<256)t[he++]=vr;else if(vr==256){Wr=U,qe=null;break}else{var El=vr-254;if(vr>264){var ge=vr-257,_i=Hl[ge];El=xr(r,U,(1<<_i)-1)+Yl[ge],U+=_i}var Qi=Be[pa(r,U)&xl],wn=Qi>>4;Qi||yr(3),U+=Qi&15;var Gr=Gu[wn];if(wn>3){var _i=Jl[wn];Gr+=pa(r,U)&(1<<_i)-1,U+=_i}if(U>yt){le&&yr(0);break}ne&&$(he+131072);var ea=he+El;if(he<Gr){var ro=L-Gr,Sl=Math.min(Gr,ea);for(ro+he<0&&yr(3);he<Sl;++he)t[he]=o[ro+he]}for(;he<ea;++he)t[he]=t[he-Gr]}}e.l=qe,e.p=Wr,e.b=he,e.f=fe,qe&&(fe=1,e.m=Me,e.d=Be,e.n=Oe)}while(!fe);return he!=t.length&&C?_a(t,0,he):t.subarray(0,he)},td=new er(0),Rr=function(r,e){return r[e]|r[e+1]<<8},Er=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},ma=function(r,e){return Er(r,e)+Er(r,e+4)*4294967296};function rd(r,e){return ed(r,{i:2},e&&e.out,e&&e.dictionary)}var ya=typeof TextDecoder<"u"&&new TextDecoder,id=0;try{ya.decode(td,{stream:!0}),id=1}catch{}var nd=function(r){for(var e="",t=0;;){var o=r[t++],p=(o>127)+(o>223)+(o>239);if(t+p>r.length)return{s:e,r:_a(r,t-1)};p?p==3?(o=((o&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|o>>10,56320|o&1023)):p&1?e+=String.fromCharCode((o&31)<<6|r[t++]&63):e+=String.fromCharCode((o&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(o)}};function Zl(r,e){if(e){for(var t="",o=0;o<r.length;o+=16384)t+=String.fromCharCode.apply(null,r.subarray(o,o+16384));return t}else{if(ya)return ya.decode(r);var p=nd(r),L=p.s,t=p.r;return t.length&&yr(8),L}}var sd=function(r,e){return e+30+Rr(r,e+26)+Rr(r,e+28)},od=function(r,e,t){var o=Rr(r,e+28),p=Zl(r.subarray(e+46,e+46+o),!(Rr(r,e+8)&2048)),L=e+46+o,C=Er(r,e+20),ne=t&&C==4294967295?ad(r,L):[C,Er(r,e+24),Er(r,e+42)],le=ne[0],$=ne[1],fe=ne[2];return[Rr(r,e+10),le,$,p,L+Rr(r,e+30)+Rr(r,e+32),fe]},ad=function(r,e){for(;Rr(r,e)!=1;e+=4+Rr(r,e+2));return[ma(r,e+12),ma(r,e+4),ma(r,e+20)]};function ld(r,e){for(var t={},o=r.length-22;Er(r,o)!=101010256;--o)(!o||r.length-o>65558)&&yr(13);var p=Rr(r,o+8);if(!p)return{};var L=Er(r,o+16),C=L==4294967295||p==65535;if(C){var ne=Er(r,o-12);C=Er(r,ne)==101075792,C&&(p=Er(r,ne+32),L=Er(r,ne+48))}for(var le=0;le<p;++le){var $=od(r,L,C),fe=$[0],U=$[1],he=$[2],qe=$[3],Be=$[4],Me=$[5],Oe=sd(r,Me);L=Be,fe?fe==8?t[qe]=rd(r.subarray(Oe,Oe+U),{out:new er(he)}):yr(14,"unknown compression type "+fe):t[qe]=_a(r,Oe,Oe+U)}return t}const cd=$l("link",1),ud=$l("entry",1),wl=class wl{constructor(e,t){z(this,Mo);z(this,Ai);z(this,Mn);z(this,Un);z(this,Ur);z(this,Ws);z(this,Qn);z(this,Yi);J(this,Ai,null),J(this,Mn,!1),J(this,Un,-1),J(this,Ur,[]),J(this,Ws,e),J(this,Yi,t)}get rows(){return s(this,Qn)||J(this,Qn,be(this,Mo,qu).call(this)),s(this,Qn)}get next(){if(!s(this,Ai)||!s(this,Yi))return null;{const e=s(this,Yi).call(this,s(this,Ai));return new wl(e,s(this,Yi))}}};Ai=new WeakMap,Mn=new WeakMap,Un=new WeakMap,Ur=new WeakMap,Ws=new WeakMap,Qn=new WeakMap,Yi=new WeakMap,Mo=new WeakSet,qu=function*(){var e;for(;;){s(this,Ur).length>0&&(yield s(this,Ur).shift());const{done:t,value:o}=s(this,Ws).next();if(t||!o)break;if(!s(this,Ai)&&!s(this,Mn)){const L=cd(o);if(L){J(this,Mn,!0);const C=(e=L.hd.find(ne=>ne.relation==="next"))==null?void 0:e.url;C&&J(this,Ai,C)}}const p=ud(o);if(p&&p.hd.length>0){const L=p.hd.slice(s(this,Un)+1).filter(ne=>!!ne.resource).map(({resource:ne})=>ne);J(this,Un,L.length-1),s(this,Ur).push(...L);let C=s(this,Ur).shift();C&&(yield C)}}for(;s(this,Ur).length>0;)yield s(this,Ur).shift()};let ga=wl;async function dd(r="https://build.fhir.org/fhir.schema.json.zip",e="fhir.schema.json"){const t=await fetch(r).catch(L=>{throw console.error(`Couldn't handle "fetch" request: ${L}`),new Error});if(!t.ok)throw console.error(`Bad response from endpoint: ${r}`,t.status),new Error;const o=ld(new Uint8Array(await t.arrayBuffer())),p=o[e];if(!p)throw console.error(`Schema file ${e} not found in unzipped. Keys are: ${Object.keys(o)}`),new Error;try{const L=JSON.parse(Zl(p));return L.definitions=Object.fromEntries(Object.entries(L.definitions).filter(([C])=>!C.includes("_"))),L}catch(L){throw console.error(`Couldn't parse the JSON file ${e}: ${L}`),new Error("",{cause:L})}}function ec(r){return[new Int32Array(r,0,2),new Uint8Array(r,8)]}function fd(r,e,{encode:t=JSON.stringify,decode:o=JSON.parse,byteSize:p=5e5}={}){const L=Array.isArray(r),C=L?r[0]:r,ne=L?r[1]:null;let le;const $=(...qe)=>{if(self.name===C){const Be=new SharedArrayBuffer(8+p),[Me,Oe]=ec(Be);if(!self){console.warn(`[block-promise::${r}] > I can't post that message. Did you forget to set the async worker?`);return}if(le?le.postMessage({sab:Be,args:qe}):self.postMessage({sab:Be,args:qe}),Atomics.wait(Me,0,0),Atomics.load(Me,0))throw new Error("Deferred error");const wt=Me[1],_t=new TextDecoder().decode(Oe.slice(0,wt));return o(_t)}else if(self.name===ne){console.warn(`[block-promise::${C}] > From async worker: ${ne}: "I can't block for that worker: ${self.name}"`);return}else return},fe=async qe=>{if(qe.data&&qe.data.sab){const{sab:Be,args:Me}=qe.data,[Oe,yt]=ec(Be);let wt=0;try{const _t=await e(...Me),qr=new TextEncoder().encode(t(_t));if(qr.length>yt.length)throw new Error(`[block-promise::${r}] > Too large`);yt.set(qr),Oe[1]=qr.length}catch{wt=1}finally{Atomics.store(Oe,0,wt),Atomics.notify(Oe,0)}}},U=async qe=>{const Be=typeof qe=="function"?qe({syncWorker:C,asyncWorker:ne}):qe;return self.name===C?le=await hd(Be):Be.onmessage=fe,Be},he=()=>{self.name===ne&&(console.log('[block-promise] > Registering "forward " async worker thread',ne),self.onmessage=qe=>{if(qe.ports&&qe.ports[0]){const Be=qe.ports[0];Be.postMessage(0),Be.onmessage=fe}})};return self.name===ne&&he(),[$,U]}async function hd(r){const{port1:e,port2:t}=new MessageChannel;return new Promise((o,p)=>{const L=C=>{C.data===0?(e.removeEventListener("message",L),o(e)):(e.removeEventListener("message",L),p(new Error(`Unexpected message: ${JSON.stringify(C.data)}`)))};e.addEventListener("message",L),e.start(),r.postMessage(null,[t])})}const[tc,pd]=fd(["sqlite-wasm.thread","sqlite-wasm.block"],async(...r)=>{const t=await(await fetch(...r)).json();return JSON.stringify(t)});function wi(r){return typeof r>"u"||r===void 0}function Qt(r){return typeof r=="string"}function co(r){return typeof r=="number"}function uo(r){return typeof r=="boolean"}function wa(r){return r===null}function _d(r){return r instanceof Date}function ba(r){return typeof r=="bigint"}function tr(r){return typeof r=="function"}function Sr(r){return typeof r=="object"&&r!==null}function d(r){return Object.freeze(r)}function fo(r){return Yr(r)?r:[r]}function Yr(r){return Array.isArray(r)}function rr(r){return r}const Ke=d({is(r){return r.kind==="AlterTableNode"},create(r){return d({kind:"AlterTableNode",table:r})},cloneWithTableProps(r,e){return d({...r,...e})},cloneWithColumnAlteration(r,e){return d({...r,columnAlterations:r.columnAlterations?[...r.columnAlterations,e]:[e]})}}),Xe=d({is(r){return r.kind==="IdentifierNode"},create(r){return d({kind:"IdentifierNode",name:r})}}),Xr=d({is(r){return r.kind==="CreateIndexNode"},create(r){return d({kind:"CreateIndexNode",name:Xe.create(r)})},cloneWith(r,e){return d({...r,...e})},cloneWithColumns(r,e){return d({...r,columns:[...r.columns||[],...e]})}}),rc=d({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return d({kind:"CreateSchemaNode",schema:Xe.create(r),...e})},cloneWith(r,e){return d({...r,...e})}}),md=["preserve rows","delete rows","drop"],ir=d({is(r){return r.kind==="CreateTableNode"},create(r){return d({kind:"CreateTableNode",table:r,columns:d([])})},cloneWithColumn(r,e){return d({...r,columns:d([...r.columns,e])})},cloneWithConstraint(r,e){return d({...r,constraints:r.constraints?d([...r.constraints,e]):d([e])})},cloneWithFrontModifier(r,e){return d({...r,frontModifiers:r.frontModifiers?d([...r.frontModifiers,e]):d([e])})},cloneWithEndModifier(r,e){return d({...r,endModifiers:r.endModifiers?d([...r.endModifiers,e]):d([e])})},cloneWith(r,e){return d({...r,...e})}}),Zr=d({is(r){return r.kind==="SchemableIdentifierNode"},create(r){return d({kind:"SchemableIdentifierNode",identifier:Xe.create(r)})},createWithSchema(r,e){return d({kind:"SchemableIdentifierNode",schema:Xe.create(r),identifier:Xe.create(e)})}}),ws=d({is(r){return r.kind==="DropIndexNode"},create(r,e){return d({kind:"DropIndexNode",name:Zr.create(r),...e})},cloneWith(r,e){return d({...r,...e})}}),Na=d({is(r){return r.kind==="DropSchemaNode"},create(r,e){return d({kind:"DropSchemaNode",schema:Xe.create(r),...e})},cloneWith(r,e){return d({...r,...e})}}),qa=d({is(r){return r.kind==="DropTableNode"},create(r,e){return d({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return d({...r,...e})}}),ei=d({is(r){return r.kind==="AliasNode"},create(r,e){return d({kind:"AliasNode",node:r,alias:e})}}),ti=d({is(r){return r.kind==="TableNode"},create(r){return d({kind:"TableNode",table:Zr.create(r)})},createWithSchema(r,e){return d({kind:"TableNode",table:Zr.createWithSchema(r,e)})}});function jt(r){return Sr(r)&&tr(r.toOperationNode)}function ic(r){return Sr(r)&&"expressionType"in r&&jt(r)}function yd(r){return Sr(r)&&"expression"in r&&Qt(r.alias)&&jt(r)}const ri=d({is(r){return r.kind==="SelectModifierNode"},create(r,e){return d({kind:"SelectModifierNode",modifier:r,of:e})},createWithExpression(r){return d({kind:"SelectModifierNode",rawModifier:r})}}),bi=d({is(r){return r.kind==="AndNode"},create(r,e){return d({kind:"AndNode",left:r,right:e})}}),xn=d({is(r){return r.kind==="OrNode"},create(r,e){return d({kind:"OrNode",left:r,right:e})}}),va=d({is(r){return r.kind==="OnNode"},create(r){return d({kind:"OnNode",on:r})},cloneWithOperation(r,e,t){return d({...r,on:e==="And"?bi.create(r.on,t):xn.create(r.on,t)})}}),En=d({is(r){return r.kind==="JoinNode"},create(r,e){return d({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,t){return d({kind:"JoinNode",joinType:r,table:e,on:va.create(t)})},cloneWithOn(r,e){return d({...r,on:r.on?va.cloneWithOperation(r.on,"And",e):va.create(e)})}}),Sn=d({is(r){return r.kind==="BinaryOperationNode"},create(r,e,t){return d({kind:"BinaryOperationNode",leftOperand:r,operator:e,rightOperand:t})}}),gd=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],wd=["+","-","*","/","%","^","&","|","#","<<",">>"],nc=["->","->>"],bd=[...gd,...wd,"&&","||"],Nd=["not","-",...["exists","not exists"]],qd=[...bd,...nc,...Nd,"between","between symmetric"],Ni=d({is(r){return r.kind==="OperatorNode"},create(r){return d({kind:"OperatorNode",operator:r})}});function sc(r){return Qt(r)&&nc.includes(r)}const bt=d({is(r){return r.kind==="ColumnNode"},create(r){return d({kind:"ColumnNode",column:Xe.create(r)})}}),xa=d({is(r){return r.kind==="SelectAllNode"},create(){return d({kind:"SelectAllNode"})}}),ho=d({is(r){return r.kind==="ReferenceNode"},create(r,e){return d({kind:"ReferenceNode",table:e,column:r})},createSelectAll(r){return d({kind:"ReferenceNode",table:r,column:xa.create()})}});class vd{constructor(e){z(this,jn);J(this,jn,e)}get dynamicReference(){return s(this,jn)}get refType(){}toOperationNode(){return dc(s(this,jn))}}jn=new WeakMap;function oc(r){return Sr(r)&&jt(r)&&Qt(r.dynamicReference)}const ii=d({is(r){return r.kind==="OrderByItemNode"},create(r,e){return d({kind:"OrderByItemNode",orderBy:r,direction:e})},cloneWith(r,e){return d({...r,...e})}}),kt=d({is(r){return r.kind==="RawNode"},create(r,e){return d({kind:"RawNode",sqlFragments:d(r),parameters:d(e)})},createWithSql(r){return kt.create([r],[])},createWithChild(r){return kt.create(["",""],[r])},createWithChildren(r){return kt.create(new Array(r.length+1).fill(""),r)}}),xd={is(r){return r.kind==="CollateNode"},create(r){return d({kind:"CollateNode",collation:Xe.create(r)})}},Xi=class Xi{constructor(e){z(this,Qr);J(this,Qr,d(e))}desc(){return new Xi({node:ii.cloneWith(s(this,Qr).node,{direction:kt.createWithSql("desc")})})}asc(){return new Xi({node:ii.cloneWith(s(this,Qr).node,{direction:kt.createWithSql("asc")})})}nullsLast(){return new Xi({node:ii.cloneWith(s(this,Qr).node,{nulls:"last"})})}nullsFirst(){return new Xi({node:ii.cloneWith(s(this,Qr).node,{nulls:"first"})})}collate(e){return new Xi({node:ii.cloneWith(s(this,Qr).node,{collation:xd.create(e)})})}toOperationNode(){return s(this,Qr).node}};Qr=new WeakMap;let Ea=Xi;const ac=new Set;function bs(r){ac.has(r)||(ac.add(r),console.log(r))}function lc(r){return r==="asc"||r==="desc"}function ji(r){if(r.length===2)return[Sa(r[0],r[1])];if(r.length===1){const[e]=r;return Array.isArray(e)?(bs("orderBy(array) is deprecated, use multiple orderBy calls instead."),e.map(t=>Sa(t))):[Sa(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${r.length}`)}function Sa(r,e){const t=Ed(r);if(ii.is(t)){if(e)throw new Error("Cannot specify direction twice!");return t}return cc(t,e)}function Ed(r){if(Is(r))return Vi(r);if(oc(r))return r.toOperationNode();const[e,t]=r.split(" ");return t?(bs("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),cc(ni(e),t)):ni(r)}function cc(r,e){if(typeof e=="string"){if(!lc(e))throw new Error(`Invalid order by direction: ${e}`);return ii.create(r,kt.createWithSql(e))}if(ic(e))return bs("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),ii.create(r,e.toOperationNode());const t=ii.create(r);return e?e(new Ea({node:t})).toOperationNode():t}const po=d({is(r){return r.kind==="JSONReferenceNode"},create(r,e){return d({kind:"JSONReferenceNode",reference:r,traversal:e})},cloneWithTraversal(r,e){return d({...r,traversal:e})}}),uc=d({is(r){return r.kind==="JSONOperatorChainNode"},create(r){return d({kind:"JSONOperatorChainNode",operator:r,values:d([])})},cloneWithValue(r,e){return d({...r,values:d([...r.values,e])})}}),Ns=d({is(r){return r.kind==="JSONPathNode"},create(r){return d({kind:"JSONPathNode",inOperator:r,pathLegs:d([])})},cloneWithLeg(r,e){return d({...r,pathLegs:d([...r.pathLegs,e])})}});function dc(r){return Qt(r)?ni(r):r.toOperationNode()}function qs(r){return Yr(r)?r.map(e=>nr(e)):[nr(r)]}function nr(r){return Is(r)?Vi(r):dc(r)}function Sd(r,e){const t=ni(r);if(sc(e))return po.create(t,uc.create(Ni.create(e)));const o=e.slice(0,-1);if(sc(o))return po.create(t,Ns.create(Ni.create(o)));throw new Error(`Invalid JSON operator: ${e}`)}function ni(r){const e=".";if(!r.includes(e))return ho.create(bt.create(r));const t=r.split(e).map(Aa);if(t.length===3)return Od(t);if(t.length===2)return kd(t);throw new Error(`invalid column reference ${r}`)}function Ad(r){const e=" as ";if(r.includes(e)){const[t,o]=r.split(e).map(Aa);return ei.create(ni(t),Xe.create(o))}else return ni(r)}function fc(r){return bt.create(r)}function _o(r){const e=" ";if(r.includes(e)){const[t,o]=r.split(e).map(Aa);if(!lc(o))throw new Error(`invalid order direction "${o}" next to "${t}"`);return ji([t,o])[0]}else return fc(r)}function Od(r){const[e,t,o]=r;return ho.create(bt.create(o),ti.createWithSchema(e,t))}function kd(r){const[e,t]=r;return ho.create(bt.create(t),ti.create(e))}function Aa(r){return r.trim()}const hc=d({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return d({kind:"PrimitiveValueListNode",values:d([...r])})}}),mo=d({is(r){return r.kind==="ValueListNode"},create(r){return d({kind:"ValueListNode",values:d(r)})}}),gr=d({is(r){return r.kind==="ValueNode"},create(r){return d({kind:"ValueNode",value:r})},createImmediate(r){return d({kind:"ValueNode",value:r,immediate:!0})}});function Id(r){return Yr(r)?Td(r):xt(r)}function xt(r){return Is(r)?Vi(r):gr.create(r)}function Oa(r){return co(r)||uo(r)||wa(r)}function ka(r){if(!Oa(r))throw new Error(`unsafe immediate value ${JSON.stringify(r)}`);return gr.createImmediate(r)}function Td(r){return r.some(Is)?mo.create(r.map(e=>xt(e))):hc.create(r)}const An=d({is(r){return r.kind==="ParensNode"},create(r){return d({kind:"ParensNode",node:r})}});function Pt(r){if(r.length===3)return Ia(r[0],r[1],r[2]);if(r.length===1)return xt(r[0]);throw new Error(`invalid arguments: ${JSON.stringify(r)}`)}function Ia(r,e,t){return Cd(e)&&_c(t)?Sn.create(nr(r),Ta(e),gr.createImmediate(t)):Sn.create(nr(r),Ta(e),Id(t))}function Br(r,e,t){return Sn.create(nr(r),Ta(e),nr(t))}function pc(r,e){return yo(Object.entries(r).filter(([,t])=>!wi(t)).map(([t,o])=>Ia(t,_c(o)?"is":"=",o)),e)}function yo(r,e,t=!0){const o=e==="and"?bi.create:xn.create;if(r.length===0)return Sn.create(gr.createImmediate(1),Ni.create("="),gr.createImmediate(e==="and"?1:0));let p=mc(r[0]);for(let L=1;L<r.length;++L)p=o(p,mc(r[L]));return r.length>1&&t?An.create(p):p}function Cd(r){return r==="is"||r==="is not"}function _c(r){return wa(r)||uo(r)}function Ta(r){if(Qt(r)&&qd.includes(r))return Ni.create(r);if(jt(r))return r.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(r)}`)}function mc(r){return jt(r)?r.toOperationNode():r}const On=d({is(r){return r.kind==="OrderByNode"},create(r){return d({kind:"OrderByNode",items:d([...r])})},cloneWithItems(r,e){return d({...r,items:d([...r.items,...e])})}}),yc=d({is(r){return r.kind==="PartitionByNode"},create(r){return d({kind:"PartitionByNode",items:d(r)})},cloneWithItems(r,e){return d({...r,items:d([...r.items,...e])})}}),Ca=d({is(r){return r.kind==="OverNode"},create(){return d({kind:"OverNode"})},cloneWithOrderByItems(r,e){return d({...r,orderBy:r.orderBy?On.cloneWithItems(r.orderBy,e):On.create(e)})},cloneWithPartitionByItems(r,e){return d({...r,partitionBy:r.partitionBy?yc.cloneWithItems(r.partitionBy,e):yc.create(e)})}}),go=d({is(r){return r.kind==="FromNode"},create(r){return d({kind:"FromNode",froms:d(r)})},cloneWithFroms(r,e){return d({...r,froms:d([...r.froms,...e])})}}),gc=d({is(r){return r.kind==="GroupByNode"},create(r){return d({kind:"GroupByNode",items:d(r)})},cloneWithItems(r,e){return d({...r,items:d([...r.items,...e])})}}),wc=d({is(r){return r.kind==="HavingNode"},create(r){return d({kind:"HavingNode",having:r})},cloneWithOperation(r,e,t){return d({...r,having:e==="And"?bi.create(r.having,t):xn.create(r.having,t)})}}),It=d({is(r){return r.kind==="InsertQueryNode"},create(r,e,t){return d({kind:"InsertQueryNode",into:r,...e&&{with:e},replace:t})},createWithoutInto(){return d({kind:"InsertQueryNode"})},cloneWith(r,e){return d({...r,...e})}}),bc=d({is(r){return r.kind==="ListNode"},create(r){return d({kind:"ListNode",items:d(r)})}}),kn=d({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return d({kind:"UpdateQueryNode",table:r.length===1?r[0]:bc.create(r),...e&&{with:e}})},createWithoutTable(){return d({kind:"UpdateQueryNode"})},cloneWithFromItems(r,e){return d({...r,from:r.from?go.cloneWithFroms(r.from,e):go.create(e)})},cloneWithUpdates(r,e){return d({...r,updates:r.updates?d([...r.updates,...e]):e})},cloneWithLimit(r,e){return d({...r,limit:e})}}),Nc=d({is(r){return r.kind==="UsingNode"},create(r){return d({kind:"UsingNode",tables:d(r)})},cloneWithTables(r,e){return d({...r,tables:d([...r.tables,...e])})}}),vs=d({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return d({kind:"DeleteQueryNode",from:go.create(r),...e&&{with:e}})},cloneWithOrderByItems:(r,e)=>ye.cloneWithOrderByItems(r,e),cloneWithoutOrderBy:r=>ye.cloneWithoutOrderBy(r),cloneWithLimit(r,e){return d({...r,limit:e})},cloneWithoutLimit(r){return d({...r,limit:void 0})},cloneWithUsing(r,e){return d({...r,using:r.using!==void 0?Nc.cloneWithTables(r.using,e):Nc.create(e)})}}),Gt=d({is(r){return r.kind==="WhereNode"},create(r){return d({kind:"WhereNode",where:r})},cloneWithOperation(r,e,t){return d({...r,where:e==="And"?bi.create(r.where,t):xn.create(r.where,t)})}}),qc=d({is(r){return r.kind==="ReturningNode"},create(r){return d({kind:"ReturningNode",selections:d(r)})},cloneWithSelections(r,e){return d({...r,selections:r.selections?d([...r.selections,...e]):d(e)})}}),Ld=d({is(r){return r.kind==="ExplainNode"},create(r,e){return d({kind:"ExplainNode",format:r,options:e})}}),xs=d({is(r){return r.kind==="WhenNode"},create(r){return d({kind:"WhenNode",condition:r})},cloneWithResult(r,e){return d({...r,result:e})}}),Kt=d({is(r){return r.kind==="MergeQueryNode"},create(r,e){return d({kind:"MergeQueryNode",into:r,...e&&{with:e}})},cloneWithUsing(r,e){return d({...r,using:e})},cloneWithWhen(r,e){return d({...r,whens:r.whens?d([...r.whens,e]):d([e])})},cloneWithThen(r,e){return d({...r,whens:r.whens?d([...r.whens.slice(0,-1),xs.cloneWithResult(r.whens[r.whens.length-1],e)]):void 0})}}),vc=d({is(r){return r.kind==="OutputNode"},create(r){return d({kind:"OutputNode",selections:d(r)})},cloneWithSelections(r,e){return d({...r,selections:r.selections?d([...r.selections,...e]):d(e)})}}),ye=d({is(r){return rt.is(r)||It.is(r)||kn.is(r)||vs.is(r)||Kt.is(r)},cloneWithEndModifier(r,e){return d({...r,endModifiers:r.endModifiers?d([...r.endModifiers,e]):d([e])})},cloneWithWhere(r,e){return d({...r,where:r.where?Gt.cloneWithOperation(r.where,"And",e):Gt.create(e)})},cloneWithJoin(r,e){return d({...r,joins:r.joins?d([...r.joins,e]):d([e])})},cloneWithReturning(r,e){return d({...r,returning:r.returning?qc.cloneWithSelections(r.returning,e):qc.create(e)})},cloneWithoutReturning(r){return d({...r,returning:void 0})},cloneWithoutWhere(r){return d({...r,where:void 0})},cloneWithExplain(r,e,t){return d({...r,explain:Ld.create(e,t==null?void 0:t.toOperationNode())})},cloneWithTop(r,e){return d({...r,top:e})},cloneWithOutput(r,e){return d({...r,output:r.output?vc.cloneWithSelections(r.output,e):vc.create(e)})},cloneWithOrderByItems(r,e){return d({...r,orderBy:r.orderBy?On.cloneWithItems(r.orderBy,e):On.create(e)})},cloneWithoutOrderBy(r){return d({...r,orderBy:void 0})}}),rt=d({is(r){return r.kind==="SelectQueryNode"},create(r){return d({kind:"SelectQueryNode",...r&&{with:r}})},createFrom(r,e){return d({kind:"SelectQueryNode",from:go.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return d({...r,selections:r.selections?d([...r.selections,...e]):d(e)})},cloneWithDistinctOn(r,e){return d({...r,distinctOn:r.distinctOn?d([...r.distinctOn,...e]):d(e)})},cloneWithFrontModifier(r,e){return d({...r,frontModifiers:r.frontModifiers?d([...r.frontModifiers,e]):d([e])})},cloneWithOrderByItems:(r,e)=>ye.cloneWithOrderByItems(r,e),cloneWithGroupByItems(r,e){return d({...r,groupBy:r.groupBy?gc.cloneWithItems(r.groupBy,e):gc.create(e)})},cloneWithLimit(r,e){return d({...r,limit:e})},cloneWithOffset(r,e){return d({...r,offset:e})},cloneWithFetch(r,e){return d({...r,fetch:e})},cloneWithHaving(r,e){return d({...r,having:r.having?wc.cloneWithOperation(r.having,"And",e):wc.create(e)})},cloneWithSetOperations(r,e){return d({...r,setOperations:r.setOperations?d([...r.setOperations,...e]):d([...e])})},cloneWithoutSelections(r){return d({...r,selections:[]})},cloneWithoutLimit(r){return d({...r,limit:void 0})},cloneWithoutOffset(r){return d({...r,offset:void 0})},cloneWithoutOrderBy:r=>ye.cloneWithoutOrderBy(r),cloneWithoutGroupBy(r){return d({...r,groupBy:void 0})}}),Ds=class Ds{constructor(e){z(this,Ar);J(this,Ar,d(e))}on(...e){return new Ds({...s(this,Ar),joinNode:En.cloneWithOn(s(this,Ar).joinNode,Pt(e))})}onRef(e,t,o){return new Ds({...s(this,Ar),joinNode:En.cloneWithOn(s(this,Ar).joinNode,Br(e,t,o))})}onTrue(){return new Ds({...s(this,Ar),joinNode:En.cloneWithOn(s(this,Ar).joinNode,kt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Ar).joinNode}};Ar=new WeakMap;let La=Ds;const Pd=d({is(r){return r.kind==="PartitionByItemNode"},create(r){return d({kind:"PartitionByItemNode",partitionBy:r})}});function Fd(r){return qs(r).map(Pd.create)}const Rs=class Rs{constructor(e){z(this,Oi);J(this,Oi,d(e))}orderBy(...e){return new Rs({overNode:Ca.cloneWithOrderByItems(s(this,Oi).overNode,ji(e))})}clearOrderBy(){return new Rs({overNode:ye.cloneWithoutOrderBy(s(this,Oi).overNode)})}partitionBy(e){return new Rs({overNode:Ca.cloneWithPartitionByItems(s(this,Oi).overNode,Fd(e))})}$call(e){return e(this)}toOperationNode(){return s(this,Oi).overNode}};Oi=new WeakMap;let Pa=Rs;const Es=d({is(r){return r.kind==="SelectionNode"},create(r){return d({kind:"SelectionNode",selection:r})},createSelectAll(){return d({kind:"SelectionNode",selection:xa.create()})},createSelectAllFromTable(r){return d({kind:"SelectionNode",selection:ho.createSelectAll(r)})}});function sr(r){return tr(r)?sr(r(Fn())):Yr(r)?r.map(e=>xc(e)):[xc(r)]}function xc(r){return Qt(r)?Es.create(Ad(r)):oc(r)?Es.create(r.toOperationNode()):Es.create(Vc(r))}function wr(r){return r?Array.isArray(r)?r.map(Ec):[Ec(r)]:[Es.createSelectAll()]}function Ec(r){if(Qt(r))return Es.createSelectAllFromTable(gt(r));throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}const Wd=d({is(r){return r.kind==="ValuesNode"},create(r){return d({kind:"ValuesNode",values:d(r)})}}),Dd=d({is(r){return r.kind==="DefaultInsertValueNode"},create(){return d({kind:"DefaultInsertValueNode"})}});function Sc(r){const e=tr(r)?r(Fn()):r,t=Yr(e)?e:d([e]);return Rd(t)}function Rd(r){const e=Bd(r);return[d([...e.keys()].map(bt.create)),Wd.create(r.map(t=>Md(t,e)))]}function Bd(r){const e=new Map;for(const t of r){const o=Object.keys(t);for(const p of o)!e.has(p)&&t[p]!==void 0&&e.set(p,e.size)}return e}function Md(r,e){const t=Object.keys(r),o=Array.from({length:e.size});let p=!1,L=t.length;for(const ne of t){const le=e.get(ne);if(wi(le)){L--;continue}const $=r[ne];(wi($)||Is($))&&(p=!0),o[le]=$}if(L<e.size||p){const ne=Dd.create();return mo.create(o.map(le=>wi(le)?ne:xt(le)))}return hc.create(o)}const Ac=d({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return d({kind:"ColumnUpdateNode",column:r,value:e})}});function Ud(...r){return r.length===2?[Ac.create(nr(r[0]),xt(r[1]))]:Fa(r[0])}function Fa(r){const e=tr(r)?r(Fn()):r;return Object.entries(e).filter(([t,o])=>o!==void 0).map(([t,o])=>Ac.create(bt.create(t),xt(o)))}const Qd=d({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return d({kind:"OnDuplicateKeyNode",updates:r})}});class jd{constructor(e,t){Zt(this,"insertId");Zt(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=t}}class Ss extends Error{constructor(t){super("no result");Zt(this,"node");this.node=t}}function As(r){return Object.prototype.hasOwnProperty.call(r,"prototype")}const or=d({is(r){return r.kind==="OnConflictNode"},create(){return d({kind:"OnConflictNode"})},cloneWith(r,e){return d({...r,...e})},cloneWithIndexWhere(r,e){return d({...r,indexWhere:r.indexWhere?Gt.cloneWithOperation(r.indexWhere,"And",e):Gt.create(e)})},cloneWithIndexOrWhere(r,e){return d({...r,indexWhere:r.indexWhere?Gt.cloneWithOperation(r.indexWhere,"Or",e):Gt.create(e)})},cloneWithUpdateWhere(r,e){return d({...r,updateWhere:r.updateWhere?Gt.cloneWithOperation(r.updateWhere,"And",e):Gt.create(e)})},cloneWithUpdateOrWhere(r,e){return d({...r,updateWhere:r.updateWhere?Gt.cloneWithOperation(r.updateWhere,"Or",e):Gt.create(e)})},cloneWithoutIndexWhere(r){return d({...r,indexWhere:void 0})},cloneWithoutUpdateWhere(r){return d({...r,updateWhere:void 0})}}),si=class si{constructor(e){z(this,it);J(this,it,d(e))}column(e){const t=bt.create(e);return new si({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{columns:s(this,it).onConflictNode.columns?d([...s(this,it).onConflictNode.columns,t]):d([t])})})}columns(e){const t=e.map(bt.create);return new si({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{columns:s(this,it).onConflictNode.columns?d([...s(this,it).onConflictNode.columns,...t]):d(t)})})}constraint(e){return new si({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{constraint:Xe.create(e)})})}expression(e){return new si({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new si({...s(this,it),onConflictNode:or.cloneWithIndexWhere(s(this,it).onConflictNode,Pt(e))})}whereRef(e,t,o){return new si({...s(this,it),onConflictNode:or.cloneWithIndexWhere(s(this,it).onConflictNode,Br(e,t,o))})}clearWhere(){return new si({...s(this,it),onConflictNode:or.cloneWithoutIndexWhere(s(this,it).onConflictNode)})}doNothing(){return new zd({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Da({...s(this,it),onConflictNode:or.cloneWith(s(this,it).onConflictNode,{updates:Fa(e)})})}$call(e){return e(this)}};it=new WeakMap;let Wa=si;class zd{constructor(e){z(this,Bs);J(this,Bs,d(e))}toOperationNode(){return s(this,Bs).onConflictNode}}Bs=new WeakMap;const Ms=class Ms{constructor(e){z(this,Or);J(this,Or,d(e))}where(...e){return new Ms({...s(this,Or),onConflictNode:or.cloneWithUpdateWhere(s(this,Or).onConflictNode,Pt(e))})}whereRef(e,t,o){return new Ms({...s(this,Or),onConflictNode:or.cloneWithUpdateWhere(s(this,Or).onConflictNode,Br(e,t,o))})}clearWhere(){return new Ms({...s(this,Or),onConflictNode:or.cloneWithoutUpdateWhere(s(this,Or).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,Or).onConflictNode}};Or=new WeakMap;let Da=Ms;const Vd=d({is(r){return r.kind==="TopNode"},create(r,e){return d({kind:"TopNode",expression:r,modifiers:e})}});function In(r,e){if(!co(r)&&!ba(r))throw new Error(`Invalid top expression: ${r}`);if(!wi(e)&&!$d(e))throw new Error(`Invalid top modifiers: ${e}`);return Vd.create(r,e)}function $d(r){return r==="percent"||r==="with ties"||r==="percent with ties"}const Tn=d({is(r){return r.kind==="OrActionNode"},create(r){return d({kind:"OrActionNode",action:r})}}),tt=class tt{constructor(e){z(this,Ne);J(this,Ne,d(e))}values(e){const[t,o]=Sc(e);return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{columns:t,values:o})})}columns(e){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{columns:d(e.map(bt.create))})})}expression(e){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{values:Vi(e)})})}defaultValues(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{defaultValues:!0})})}modifyEnd(e){return new tt({...s(this,Ne),queryNode:ye.cloneWithEndModifier(s(this,Ne).queryNode,e.toOperationNode())})}ignore(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("ignore")})})}orIgnore(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("ignore")})})}orAbort(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("abort")})})}orFail(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("fail")})})}orReplace(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("replace")})})}orRollback(){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{orAction:Tn.create("rollback")})})}top(e,t){return new tt({...s(this,Ne),queryNode:ye.cloneWithTop(s(this,Ne).queryNode,In(e,t))})}onConflict(e){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{onConflict:e(new Wa({onConflictNode:or.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new tt({...s(this,Ne),queryNode:It.cloneWith(s(this,Ne).queryNode,{onDuplicateKey:Qd.create(Fa(e))})})}returning(e){return new tt({...s(this,Ne),queryNode:ye.cloneWithReturning(s(this,Ne).queryNode,sr(e))})}returningAll(){return new tt({...s(this,Ne),queryNode:ye.cloneWithReturning(s(this,Ne).queryNode,wr())})}output(e){return new tt({...s(this,Ne),queryNode:ye.cloneWithOutput(s(this,Ne).queryNode,sr(e))})}outputAll(e){return new tt({...s(this,Ne),queryNode:ye.cloneWithOutput(s(this,Ne).queryNode,wr(e))})}clearReturning(){return new tt({...s(this,Ne),queryNode:ye.cloneWithoutReturning(s(this,Ne).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new tt({...s(this,Ne)})}$castTo(){return new tt(s(this,Ne))}$narrowType(){return new tt(s(this,Ne))}$assertType(){return new tt(s(this,Ne))}withPlugin(e){return new tt({...s(this,Ne),executor:s(this,Ne).executor.withPlugin(e)})}toOperationNode(){return s(this,Ne).executor.transformQuery(s(this,Ne).queryNode,s(this,Ne).queryId)}compile(){return s(this,Ne).executor.compileQuery(this.toOperationNode(),s(this,Ne).queryId)}async execute(){const e=this.compile(),t=await s(this,Ne).executor.executeQuery(e,s(this,Ne).queryId),{adapter:o}=s(this,Ne).executor,p=e.query;return p.returning&&o.supportsReturning||p.output&&o.supportsOutput?t.rows:[new jd(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ss){const t=await this.executeTakeFirst();if(t===void 0)throw As(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),o=s(this,Ne).executor.stream(t,e,s(this,Ne).queryId);for await(const p of o)yield*p.rows}async explain(e,t){return await new tt({...s(this,Ne),queryNode:ye.cloneWithExplain(s(this,Ne).queryNode,e,t)}).execute()}};Ne=new WeakMap;let wo=tt;class Hd{constructor(e){Zt(this,"numDeletedRows");this.numDeletedRows=e}}const Ra=d({is(r){return r.kind==="LimitNode"},create(r){return d({kind:"LimitNode",limit:r})}}),dt=class dt{constructor(e){z(this,Zi);z(this,Ee);J(this,Ee,d(e))}where(...e){return new dt({...s(this,Ee),queryNode:ye.cloneWithWhere(s(this,Ee).queryNode,Pt(e))})}whereRef(e,t,o){return new dt({...s(this,Ee),queryNode:ye.cloneWithWhere(s(this,Ee).queryNode,Br(e,t,o))})}clearWhere(){return new dt({...s(this,Ee),queryNode:ye.cloneWithoutWhere(s(this,Ee).queryNode)})}top(e,t){return new dt({...s(this,Ee),queryNode:ye.cloneWithTop(s(this,Ee).queryNode,In(e,t))})}using(e){return new dt({...s(this,Ee),queryNode:vs.cloneWithUsing(s(this,Ee).queryNode,Wn(e))})}innerJoin(...e){return be(this,Zi,oo).call(this,"InnerJoin",e)}leftJoin(...e){return be(this,Zi,oo).call(this,"LeftJoin",e)}rightJoin(...e){return be(this,Zi,oo).call(this,"RightJoin",e)}fullJoin(...e){return be(this,Zi,oo).call(this,"FullJoin",e)}returning(e){return new dt({...s(this,Ee),queryNode:ye.cloneWithReturning(s(this,Ee).queryNode,sr(e))})}returningAll(e){return new dt({...s(this,Ee),queryNode:ye.cloneWithReturning(s(this,Ee).queryNode,wr(e))})}output(e){return new dt({...s(this,Ee),queryNode:ye.cloneWithOutput(s(this,Ee).queryNode,sr(e))})}outputAll(e){return new dt({...s(this,Ee),queryNode:ye.cloneWithOutput(s(this,Ee).queryNode,wr(e))})}clearReturning(){return new dt({...s(this,Ee),queryNode:ye.cloneWithoutReturning(s(this,Ee).queryNode)})}clearLimit(){return new dt({...s(this,Ee),queryNode:vs.cloneWithoutLimit(s(this,Ee).queryNode)})}orderBy(...e){return new dt({...s(this,Ee),queryNode:ye.cloneWithOrderByItems(s(this,Ee).queryNode,ji(e))})}clearOrderBy(){return new dt({...s(this,Ee),queryNode:ye.cloneWithoutOrderBy(s(this,Ee).queryNode)})}limit(e){return new dt({...s(this,Ee),queryNode:vs.cloneWithLimit(s(this,Ee).queryNode,Ra.create(xt(e)))})}modifyEnd(e){return new dt({...s(this,Ee),queryNode:ye.cloneWithEndModifier(s(this,Ee).queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new dt({...s(this,Ee)})}$castTo(){return new dt(s(this,Ee))}$narrowType(){return new dt(s(this,Ee))}$assertType(){return new dt(s(this,Ee))}withPlugin(e){return new dt({...s(this,Ee),executor:s(this,Ee).executor.withPlugin(e)})}toOperationNode(){return s(this,Ee).executor.transformQuery(s(this,Ee).queryNode,s(this,Ee).queryId)}compile(){return s(this,Ee).executor.compileQuery(this.toOperationNode(),s(this,Ee).queryId)}async execute(){const e=this.compile(),t=await s(this,Ee).executor.executeQuery(e,s(this,Ee).queryId),{adapter:o}=s(this,Ee).executor,p=e.query;return p.returning&&o.supportsReturning||p.output&&o.supportsOutput?t.rows:[new Hd(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ss){const t=await this.executeTakeFirst();if(t===void 0)throw As(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),o=s(this,Ee).executor.stream(t,e,s(this,Ee).queryId);for await(const p of o)yield*p.rows}async explain(e,t){return await new dt({...s(this,Ee),queryNode:ye.cloneWithExplain(s(this,Ee).queryNode,e,t)}).execute()}};Ee=new WeakMap,Zi=new WeakSet,oo=function(e,t){return new dt({...s(this,Ee),queryNode:ye.cloneWithJoin(s(this,Ee).queryNode,Eo(e,t))})};let Ba=dt;class Jd{constructor(e,t){Zt(this,"numUpdatedRows");Zt(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=t}}const ft=class ft{constructor(e){z(this,en);z(this,Se);J(this,Se,d(e))}where(...e){return new ft({...s(this,Se),queryNode:ye.cloneWithWhere(s(this,Se).queryNode,Pt(e))})}whereRef(e,t,o){return new ft({...s(this,Se),queryNode:ye.cloneWithWhere(s(this,Se).queryNode,Br(e,t,o))})}clearWhere(){return new ft({...s(this,Se),queryNode:ye.cloneWithoutWhere(s(this,Se).queryNode)})}top(e,t){return new ft({...s(this,Se),queryNode:ye.cloneWithTop(s(this,Se).queryNode,In(e,t))})}from(e){return new ft({...s(this,Se),queryNode:kn.cloneWithFromItems(s(this,Se).queryNode,Wn(e))})}innerJoin(...e){return be(this,en,ao).call(this,"InnerJoin",e)}leftJoin(...e){return be(this,en,ao).call(this,"LeftJoin",e)}rightJoin(...e){return be(this,en,ao).call(this,"RightJoin",e)}fullJoin(...e){return be(this,en,ao).call(this,"FullJoin",e)}orderBy(...e){return new ft({...s(this,Se),queryNode:ye.cloneWithOrderByItems(s(this,Se).queryNode,ji(e))})}clearOrderBy(){return new ft({...s(this,Se),queryNode:ye.cloneWithoutOrderBy(s(this,Se).queryNode)})}limit(e){return new ft({...s(this,Se),queryNode:kn.cloneWithLimit(s(this,Se).queryNode,Ra.create(xt(e)))})}set(...e){return new ft({...s(this,Se),queryNode:kn.cloneWithUpdates(s(this,Se).queryNode,Ud(...e))})}returning(e){return new ft({...s(this,Se),queryNode:ye.cloneWithReturning(s(this,Se).queryNode,sr(e))})}returningAll(e){return new ft({...s(this,Se),queryNode:ye.cloneWithReturning(s(this,Se).queryNode,wr(e))})}output(e){return new ft({...s(this,Se),queryNode:ye.cloneWithOutput(s(this,Se).queryNode,sr(e))})}outputAll(e){return new ft({...s(this,Se),queryNode:ye.cloneWithOutput(s(this,Se).queryNode,wr(e))})}modifyEnd(e){return new ft({...s(this,Se),queryNode:ye.cloneWithEndModifier(s(this,Se).queryNode,e.toOperationNode())})}clearReturning(){return new ft({...s(this,Se),queryNode:ye.cloneWithoutReturning(s(this,Se).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new ft({...s(this,Se)})}$castTo(){return new ft(s(this,Se))}$narrowType(){return new ft(s(this,Se))}$assertType(){return new ft(s(this,Se))}withPlugin(e){return new ft({...s(this,Se),executor:s(this,Se).executor.withPlugin(e)})}toOperationNode(){return s(this,Se).executor.transformQuery(s(this,Se).queryNode,s(this,Se).queryId)}compile(){return s(this,Se).executor.compileQuery(this.toOperationNode(),s(this,Se).queryId)}async execute(){const e=this.compile(),t=await s(this,Se).executor.executeQuery(e,s(this,Se).queryId),{adapter:o}=s(this,Se).executor,p=e.query;return p.returning&&o.supportsReturning||p.output&&o.supportsOutput?t.rows:[new Jd(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ss){const t=await this.executeTakeFirst();if(t===void 0)throw As(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),o=s(this,Se).executor.stream(t,e,s(this,Se).queryId);for await(const p of o)yield*p.rows}async explain(e,t){return await new ft({...s(this,Se),queryNode:ye.cloneWithExplain(s(this,Se).queryNode,e,t)}).execute()}};Se=new WeakMap,en=new WeakSet,ao=function(e,t){return new ft({...s(this,Se),queryNode:ye.cloneWithJoin(s(this,Se).queryNode,Eo(e,t))})};let bo=ft;const Oc=d({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return d({kind:"CommonTableExpressionNameNode",table:ti.create(r),columns:e?d(e.map(bt.create)):void 0})}}),No=d({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return d({kind:"CommonTableExpressionNode",name:r,expression:e})},cloneWith(r,e){return d({...r,...e})}}),Uo=class Uo{constructor(e){z(this,oi);J(this,oi,d(e))}materialized(){return new Uo({...s(this,oi),node:No.cloneWith(s(this,oi).node,{materialized:!0})})}notMaterialized(){return new Uo({...s(this,oi),node:No.cloneWith(s(this,oi).node,{materialized:!1})})}toOperationNode(){return s(this,oi).node}};oi=new WeakMap;let Ma=Uo;function kc(r,e){const t=e(af()).toOperationNode();return tr(r)?r(Gd(t)).toOperationNode():No.create(Ic(r),t)}function Gd(r){return e=>new Ma({node:No.create(Ic(e),r)})}function Ic(r){if(r.includes("(")){const e=r.split(/[\(\)]/),t=e[0],o=e[1].split(",").map(p=>p.trim());return Oc.create(t,o)}else return Oc.create(r)}const qo=d({is(r){return r.kind==="WithNode"},create(r,e){return d({kind:"WithNode",expressions:d([r]),...e})},cloneWithExpression(r,e){return d({...r,expressions:d([...r.expressions,e])})}}),Tc=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Kd(r){let e="";for(let t=0;t<r;++t)e+=Yd();return e}function Yd(){return Tc[~~(Math.random()*Tc.length)]}function ze(){return new Xd}class Xd{constructor(){z(this,zn)}get queryId(){return s(this,zn)===void 0&&J(this,zn,Kd(8)),s(this,zn)}}zn=new WeakMap;function Dp(r){return r}class Cc{constructor(){Zt(this,"nodeStack",[]);z(this,Qo,d({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)}))}transformNode(e,t){if(!e)return e;this.nodeStack.push(e);const o=this.transformNodeImpl(e,t);return this.nodeStack.pop(),d(o)}transformNodeImpl(e,t){return s(this,Qo)[e.kind](e,t)}transformNodeList(e,t){return e&&d(e.map(o=>this.transformNode(o,t)))}transformSelectQuery(e,t){return{kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)}}transformSelection(e,t){return{kind:"SelectionNode",selection:this.transformNode(e.selection,t)}}transformColumn(e,t){return{kind:"ColumnNode",column:this.transformNode(e.column,t)}}transformAlias(e,t){return{kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)}}transformTable(e,t){return{kind:"TableNode",table:this.transformNode(e.table,t)}}transformFrom(e,t){return{kind:"FromNode",froms:this.transformNodeList(e.froms,t)}}transformReference(e,t){return{kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)}}transformAnd(e,t){return{kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformOr(e,t){return{kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformValueList(e,t){return{kind:"ValueListNode",values:this.transformNodeList(e.values,t)}}transformParens(e,t){return{kind:"ParensNode",node:this.transformNode(e.node,t)}}transformJoin(e,t){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)}}transformRaw(e,t){return{kind:"RawNode",sqlFragments:d([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)}}transformWhere(e,t){return{kind:"WhereNode",where:this.transformNode(e.where,t)}}transformInsertQuery(e,t){return{kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformValues(e,t){return{kind:"ValuesNode",values:this.transformNodeList(e.values,t)}}transformDeleteQuery(e,t){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformReturning(e,t){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)}}transformCreateTable(e,t){return{kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)}}transformColumnDefinition(e,t){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,t){return{kind:"AddColumnNode",column:this.transformNode(e.column,t)}}transformDropTable(e,t){return{kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,t){return{kind:"OrderByNode",items:this.transformNodeList(e.items,t)}}transformOrderByItem(e,t){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls}}transformGroupBy(e,t){return{kind:"GroupByNode",items:this.transformNodeList(e.items,t)}}transformGroupByItem(e,t){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)}}transformUpdateQuery(e,t){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)}}transformColumnUpdate(e,t){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)}}transformLimit(e,t){return{kind:"LimitNode",limit:this.transformNode(e.limit,t)}}transformOffset(e,t){return{kind:"OffsetNode",offset:this.transformNode(e.offset,t)}}transformOnConflict(e,t){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing}}transformOnDuplicateKey(e,t){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)}}transformCreateIndex(e,t){return{kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,t){return{kind:"ListNode",items:this.transformNodeList(e.items,t)}}transformDropIndex(e,t){return{kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,t){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,t){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,t){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,t){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all}}transformReferences(e,t){return{kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,t){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)}}transformWith(e,t){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive}}transformCommonTableExpression(e,t){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)}}transformCommonTableExpressionName(e,t){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)}}transformHaving(e,t){return{kind:"HavingNode",having:this.transformNode(e.having,t)}}transformCreateSchema(e,t){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists}}transformDropSchema(e,t){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,t){return{kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)}}transformDropColumn(e,t){return{kind:"DropColumnNode",column:this.transformNode(e.column,t)}}transformRenameColumn(e,t){return{kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)}}transformAlterColumn(e,t){return{kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,t){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,t)}}transformAddConstraint(e,t){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)}}transformDropConstraint(e,t){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,t){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)}}transformCreateView(e,t){return{kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)}}transformRefreshMaterializedView(e,t){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,t){return{kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,t){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)}}transformDefaultValue(e,t){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)}}transformOn(e,t){return{kind:"OnNode",on:this.transformNode(e.on,t)}}transformSelectModifier(e,t){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)}}transformCreateType(e,t){return{kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)}}transformDropType(e,t){return{kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists}}transformExplain(e,t){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)}}transformSchemableIdentifier(e,t){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)}}transformAggregateFunction(e,t){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)}}transformOver(e,t){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)}}transformPartitionBy(e,t){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,t)}}transformPartitionByItem(e,t){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)}}transformBinaryOperation(e,t){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)}}transformUnaryOperation(e,t){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)}}transformUsing(e,t){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,t)}}transformFunction(e,t){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)}}transformCase(e,t){return{kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement}}transformWhen(e,t){return{kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)}}transformJSONReference(e,t){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)}}transformJSONPath(e,t){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)}}transformJSONPathLeg(e,t){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,t){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)}}transformTuple(e,t){return{kind:"TupleNode",values:this.transformNodeList(e.values,t)}}transformMergeQuery(e,t){return{kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)}}transformMatched(e,t){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,t){return{kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists}}transformCast(e,t){return{kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)}}transformFetch(e,t){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier}}transformTop(e,t){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,t){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,t)}}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}Qo=new WeakMap;const Zd=d({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),ef={json_agg:!0,to_json:!0};class tf extends Cc{constructor(t){super();z(this,ht);z(this,Vn);z(this,tn,new Set);z(this,rn,new Set);J(this,Vn,t)}transformNodeImpl(t,o){if(!be(this,ht,vu).call(this,t))return super.transformNodeImpl(t,o);const p=be(this,ht,Eu).call(this,t);for(const ne of p)s(this,rn).add(ne);const L=be(this,ht,xu).call(this,t);for(const ne of L)s(this,tn).add(ne);const C=super.transformNodeImpl(t,o);for(const ne of L)s(this,tn).delete(ne);for(const ne of p)s(this,rn).delete(ne);return C}transformSchemableIdentifier(t,o){const p=super.transformSchemableIdentifier(t,o);return p.schema||!s(this,tn).has(t.identifier.name)?p:{...p,schema:Xe.create(s(this,Vn))}}transformReferences(t,o){const p=super.transformReferences(t,o);return p.table.table.schema?p:{...p,table:ti.createWithSchema(s(this,Vn),p.table.table.identifier.name)}}transformAggregateFunction(t,o){return{...super.transformAggregateFunction({...t,aggregated:[]},o),aggregated:be(this,ht,Pl).call(this,t,o,"aggregated")}}transformFunction(t,o){return{...super.transformFunction({...t,arguments:[]},o),arguments:be(this,ht,Pl).call(this,t,o,"arguments")}}}Vn=new WeakMap,tn=new WeakMap,rn=new WeakMap,ht=new WeakSet,Pl=function(t,o,p){return ef[t.func]?t[p].map(L=>!ti.is(L)||L.table.schema?this.transformNode(L,o):{...L,table:this.transformIdentifier(L.table.identifier,o)}):this.transformNodeList(t[p],o)},vu=function(t){return t.kind in Zd},xu=function(t){const o=new Set;if("name"in t&&t.name&&Zr.is(t.name)&&be(this,ht,oa).call(this,t.name,o),"from"in t&&t.from)for(const p of t.from.froms)be(this,ht,Nn).call(this,p,o);if("into"in t&&t.into&&be(this,ht,Nn).call(this,t.into,o),"table"in t&&t.table&&be(this,ht,Nn).call(this,t.table,o),"joins"in t&&t.joins)for(const p of t.joins)be(this,ht,Nn).call(this,p.table,o);return"using"in t&&t.using&&be(this,ht,Nn).call(this,t.using,o),o},Eu=function(t){const o=new Set;return"with"in t&&t.with&&be(this,ht,Su).call(this,t.with,o),o},Nn=function(t,o){if(ti.is(t))be(this,ht,oa).call(this,t.table,o);else if(ei.is(t)&&ti.is(t.node))be(this,ht,oa).call(this,t.node.table,o);else if(bc.is(t))for(const p of t.items)be(this,ht,Nn).call(this,p,o)},oa=function(t,o){const p=t.identifier.name;!s(this,tn).has(p)&&!s(this,rn).has(p)&&o.add(p)},Su=function(t,o){for(const p of t.expressions){const L=p.name.table.table.identifier.name;s(this,rn).has(L)||o.add(L)}};class Cn{constructor(e){z(this,Us);J(this,Us,new tf(e))}transformQuery(e){return s(this,Us).transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}Us=new WeakMap;const rf=d({is(r){return r.kind==="MatchedNode"},create(r,e=!1){return d({kind:"MatchedNode",not:r,bySource:e})}});function Lc(r,e,t){return xs.create(yo([rf.create(!r.isMatched,r.bySource),...e&&e.length>0?[e.length===3&&t?Br(e[0],e[1],e[2]):Pt(e)]:[]],"and",!1))}function Os(r){return Qt(r)?kt.create([r],[]):jt(r)?r.toOperationNode():r}class Pc{constructor(){z(this,Qs);z(this,$n);z(this,Hn);Zt(this,"resolve",e=>{s(this,$n)&&s(this,$n).call(this,e)});Zt(this,"reject",e=>{s(this,Hn)&&s(this,Hn).call(this,e)});J(this,Qs,new Promise((e,t)=>{J(this,Hn,t),J(this,$n,e)}))}get promise(){return s(this,Qs)}}Qs=new WeakMap,$n=new WeakMap,Hn=new WeakMap;async function Fc(r){const e=new Pc,t=new Pc;return r.provideConnection(async o=>(e.resolve(o),await t.promise)).catch(o=>e.reject(o)),d({connection:await e.promise,release:t.resolve})}const nf=d([]);class Wc{constructor(e=nf){z(this,js);z(this,nn);J(this,nn,e)}get plugins(){return s(this,nn)}transformQuery(e,t){for(const o of s(this,nn)){const p=o.transformQuery({node:e,queryId:t});if(p.kind===e.kind)e=p;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${p.kind}`].join(" "))}return e}async executeQuery(e,t){return await this.provideConnection(async o=>{const p=await o.executeQuery(e);return"numUpdatedOrDeletedRows"in p&&bs("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await be(this,js,Fl).call(this,p,t)})}async*stream(e,t,o){const{connection:p,release:L}=await Fc(this);try{for await(const C of p.streamQuery(e,t))yield await be(this,js,Fl).call(this,C,o)}finally{L()}}}nn=new WeakMap,js=new WeakSet,Fl=async function(e,t){for(const o of s(this,nn))e=await o.transformResult({result:e,queryId:t});return e};class Ln extends Wc{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new Ln([...this.plugins,e])}withPlugins(e){return new Ln([...this.plugins,...e])}withPluginAtFront(e){return new Ln([e,...this.plugins])}withoutPlugins(){return new Ln([])}}const vo=new Ln;class sf{constructor(e){Zt(this,"numChangedRows");this.numChangedRows=e}}const ki=class ki{constructor(e){z(this,Tt);J(this,Tt,d(e))}modifyEnd(e){return new ki({...s(this,Tt),queryNode:ye.cloneWithEndModifier(s(this,Tt).queryNode,e.toOperationNode())})}top(e,t){return new ki({...s(this,Tt),queryNode:ye.cloneWithTop(s(this,Tt).queryNode,In(e,t))})}using(...e){return new qi({...s(this,Tt),queryNode:Kt.cloneWithUsing(s(this,Tt).queryNode,Eo("Using",e))})}returning(e){return new ki({...s(this,Tt),queryNode:ye.cloneWithReturning(s(this,Tt).queryNode,sr(e))})}returningAll(e){return new ki({...s(this,Tt),queryNode:ye.cloneWithReturning(s(this,Tt).queryNode,wr(e))})}output(e){return new ki({...s(this,Tt),queryNode:ye.cloneWithOutput(s(this,Tt).queryNode,sr(e))})}outputAll(e){return new ki({...s(this,Tt),queryNode:ye.cloneWithOutput(s(this,Tt).queryNode,wr(e))})}};Tt=new WeakMap;let Ua=ki;const ai=class ai{constructor(e){z(this,ar);z(this,Ye);J(this,Ye,d(e))}modifyEnd(e){return new ai({...s(this,Ye),queryNode:ye.cloneWithEndModifier(s(this,Ye).queryNode,e.toOperationNode())})}top(e,t){return new ai({...s(this,Ye),queryNode:ye.cloneWithTop(s(this,Ye).queryNode,In(e,t))})}whenMatched(){return be(this,ar,aa).call(this,[])}whenMatchedAnd(...e){return be(this,ar,aa).call(this,e)}whenMatchedAndRef(e,t,o){return be(this,ar,aa).call(this,[e,t,o],!0)}whenNotMatched(){return be(this,ar,qn).call(this,[])}whenNotMatchedAnd(...e){return be(this,ar,qn).call(this,e)}whenNotMatchedAndRef(e,t,o){return be(this,ar,qn).call(this,[e,t,o],!0)}whenNotMatchedBySource(){return be(this,ar,qn).call(this,[],!1,!0)}whenNotMatchedBySourceAnd(...e){return be(this,ar,qn).call(this,e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,o){return be(this,ar,qn).call(this,[e,t,o],!0,!0)}returning(e){return new ai({...s(this,Ye),queryNode:ye.cloneWithReturning(s(this,Ye).queryNode,sr(e))})}returningAll(e){return new ai({...s(this,Ye),queryNode:ye.cloneWithReturning(s(this,Ye).queryNode,wr(e))})}output(e){return new ai({...s(this,Ye),queryNode:ye.cloneWithOutput(s(this,Ye).queryNode,sr(e))})}outputAll(e){return new ai({...s(this,Ye),queryNode:ye.cloneWithOutput(s(this,Ye).queryNode,wr(e))})}$call(e){return e(this)}$if(e,t){return e?t(this):new ai({...s(this,Ye)})}toOperationNode(){return s(this,Ye).executor.transformQuery(s(this,Ye).queryNode,s(this,Ye).queryId)}compile(){return s(this,Ye).executor.compileQuery(this.toOperationNode(),s(this,Ye).queryId)}async execute(){const e=this.compile(),t=await s(this,Ye).executor.executeQuery(e,s(this,Ye).queryId),{adapter:o}=s(this,Ye).executor,p=e.query;return p.returning&&o.supportsReturning||p.output&&o.supportsOutput?t.rows:[new sf(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ss){const t=await this.executeTakeFirst();if(t===void 0)throw As(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}};Ye=new WeakMap,ar=new WeakSet,aa=function(e,t){return new Dc({...s(this,Ye),queryNode:Kt.cloneWithWhen(s(this,Ye).queryNode,Lc({isMatched:!0},e,t))})},qn=function(e,t=!1,o=!1){const p={...s(this,Ye),queryNode:Kt.cloneWithWhen(s(this,Ye).queryNode,Lc({isMatched:!1,bySource:o},e,t))},L=o?Dc:of;return new L(p)};let qi=ai;class Dc{constructor(e){z(this,kr);J(this,kr,d(e))}thenDelete(){return new qi({...s(this,kr),queryNode:Kt.cloneWithThen(s(this,kr).queryNode,Os("delete"))})}thenDoNothing(){return new qi({...s(this,kr),queryNode:Kt.cloneWithThen(s(this,kr).queryNode,Os("do nothing"))})}thenUpdate(e){return new qi({...s(this,kr),queryNode:Kt.cloneWithThen(s(this,kr).queryNode,Os(e(new bo({queryId:s(this,kr).queryId,executor:vo,queryNode:kn.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}kr=new WeakMap;class of{constructor(e){z(this,Ii);J(this,Ii,d(e))}thenDoNothing(){return new qi({...s(this,Ii),queryNode:Kt.cloneWithThen(s(this,Ii).queryNode,Os("do nothing"))})}thenInsertValues(e){const[t,o]=Sc(e);return new qi({...s(this,Ii),queryNode:Kt.cloneWithThen(s(this,Ii).queryNode,Os(It.cloneWith(It.createWithoutInto(),{columns:t,values:o})))})}}Ii=new WeakMap;const sn=class sn{constructor(e){z(this,Ve);J(this,Ve,d(e))}selectFrom(e){return $a({queryId:ze(),executor:s(this,Ve).executor,queryNode:rt.createFrom(Wn(e),s(this,Ve).withNode)})}selectNoFrom(e){return $a({queryId:ze(),executor:s(this,Ve).executor,queryNode:rt.cloneWithSelections(rt.create(s(this,Ve).withNode),sr(e))})}insertInto(e){return new wo({queryId:ze(),executor:s(this,Ve).executor,queryNode:It.create(gt(e),s(this,Ve).withNode)})}replaceInto(e){return new wo({queryId:ze(),executor:s(this,Ve).executor,queryNode:It.create(gt(e),s(this,Ve).withNode,!0)})}deleteFrom(e){return new Ba({queryId:ze(),executor:s(this,Ve).executor,queryNode:vs.create(Wn(e),s(this,Ve).withNode)})}updateTable(e){return new bo({queryId:ze(),executor:s(this,Ve).executor,queryNode:kn.create(Wn(e),s(this,Ve).withNode)})}mergeInto(e){return new Ua({queryId:ze(),executor:s(this,Ve).executor,queryNode:Kt.create($c(e),s(this,Ve).withNode)})}with(e,t){const o=kc(e,t);return new sn({...s(this,Ve),withNode:s(this,Ve).withNode?qo.cloneWithExpression(s(this,Ve).withNode,o):qo.create(o)})}withRecursive(e,t){const o=kc(e,t);return new sn({...s(this,Ve),withNode:s(this,Ve).withNode?qo.cloneWithExpression(s(this,Ve).withNode,o):qo.create(o,{recursive:!0})})}withPlugin(e){return new sn({...s(this,Ve),executor:s(this,Ve).executor.withPlugin(e)})}withoutPlugins(){return new sn({...s(this,Ve),executor:s(this,Ve).executor.withoutPlugins()})}withSchema(e){return new sn({...s(this,Ve),executor:s(this,Ve).executor.withPluginAtFront(new Cn(e))})}};Ve=new WeakMap;let xo=sn;function af(){return new xo({executor:vo})}function lf(r,e){return new La({joinNode:En.create(r,Ts(e))})}function cf(){return new Pa({overNode:Ca.create()})}function Eo(r,e){if(e.length===3)return df(r,e[0],e[1],e[2]);if(e.length===2)return uf(r,e[0],e[1]);if(e.length===1)return ff(r,e[0]);throw new Error("not implemented")}function uf(r,e,t){return t(lf(r,e)).toOperationNode()}function df(r,e,t,o){return En.createWithOn(r,Ts(e),Br(t,"=",o))}function ff(r,e){return En.create(r,Ts(e))}const hf=d({is(r){return r.kind==="OffsetNode"},create(r){return d({kind:"OffsetNode",offset:r})}}),pf=d({is(r){return r.kind==="GroupByItemNode"},create(r){return d({kind:"GroupByItemNode",groupBy:r})}});function _f(r){return r=tr(r)?r(Fn()):r,qs(r).map(pf.create)}const Rc=d({is(r){return r.kind==="SetOperationNode"},create(r,e,t){return d({kind:"SetOperationNode",operator:r,expression:e,all:t})}});function Pn(r,e,t){return tr(e)&&(e=e(Ja())),Yr(e)||(e=[e]),e.map(o=>Rc.create(r,Vi(o),t))}const jo=class jo{constructor(e){z(this,li);J(this,li,e)}get expressionType(){}as(e){return new Qa(this,e)}or(...e){return new ja(xn.create(s(this,li),Pt(e)))}and(...e){return new za(bi.create(s(this,li),Pt(e)))}$castTo(){return new jo(s(this,li))}$notNull(){return new jo(s(this,li))}toOperationNode(){return s(this,li)}};li=new WeakMap;let et=jo;class Qa{constructor(e,t){z(this,Jn);z(this,Ti);J(this,Jn,e),J(this,Ti,t)}get expression(){return s(this,Jn)}get alias(){return s(this,Ti)}toOperationNode(){return ei.create(s(this,Jn).toOperationNode(),jt(s(this,Ti))?s(this,Ti).toOperationNode():Xe.create(s(this,Ti)))}}Jn=new WeakMap,Ti=new WeakMap;const zo=class zo{constructor(e){z(this,on);J(this,on,e)}get expressionType(){}as(e){return new Qa(this,e)}or(...e){return new zo(xn.create(s(this,on),Pt(e)))}$castTo(){return new zo(s(this,on))}toOperationNode(){return An.create(s(this,on))}};on=new WeakMap;let ja=zo;const Vo=class Vo{constructor(e){z(this,an);J(this,an,e)}get expressionType(){}as(e){return new Qa(this,e)}and(...e){return new Vo(bi.create(s(this,an),Pt(e)))}$castTo(){return new Vo(s(this,an))}toOperationNode(){return An.create(s(this,an))}};an=new WeakMap;let za=Vo;const mf={is(r){return r.kind==="FetchNode"},create(r,e){return{kind:"FetchNode",rowCount:gr.create(r),modifier:e}}};function yf(r,e){if(!co(r)&&!ba(r))throw new Error(`Invalid fetch row count: ${r}`);if(!gf(e))throw new Error(`Invalid fetch modifier: ${e}`);return mf.create(r,e)}function gf(r){return r==="only"||r==="with ties"}const Te=class Te{constructor(e){z(this,lr);z(this,ue);J(this,ue,d(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new Te({...s(this,ue),queryNode:ye.cloneWithWhere(s(this,ue).queryNode,Pt(e))})}whereRef(e,t,o){return new Te({...s(this,ue),queryNode:ye.cloneWithWhere(s(this,ue).queryNode,Br(e,t,o))})}having(...e){return new Te({...s(this,ue),queryNode:rt.cloneWithHaving(s(this,ue).queryNode,Pt(e))})}havingRef(e,t,o){return new Te({...s(this,ue),queryNode:rt.cloneWithHaving(s(this,ue).queryNode,Br(e,t,o))})}select(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSelections(s(this,ue).queryNode,sr(e))})}distinctOn(e){return new Te({...s(this,ue),queryNode:rt.cloneWithDistinctOn(s(this,ue).queryNode,qs(e))})}modifyFront(e){return new Te({...s(this,ue),queryNode:rt.cloneWithFrontModifier(s(this,ue).queryNode,ri.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.createWithExpression(e.toOperationNode()))})}distinct(){return new Te({...s(this,ue),queryNode:rt.cloneWithFrontModifier(s(this,ue).queryNode,ri.create("Distinct"))})}forUpdate(e){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("ForUpdate",e?fo(e).map(gt):void 0))})}forShare(e){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("ForShare",e?fo(e).map(gt):void 0))})}forKeyShare(e){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("ForKeyShare",e?fo(e).map(gt):void 0))})}forNoKeyUpdate(e){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("ForNoKeyUpdate",e?fo(e).map(gt):void 0))})}skipLocked(){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("SkipLocked"))})}noWait(){return new Te({...s(this,ue),queryNode:ye.cloneWithEndModifier(s(this,ue).queryNode,ri.create("NoWait"))})}selectAll(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSelections(s(this,ue).queryNode,wr(e))})}innerJoin(...e){return be(this,lr,Dr).call(this,"InnerJoin",e)}leftJoin(...e){return be(this,lr,Dr).call(this,"LeftJoin",e)}rightJoin(...e){return be(this,lr,Dr).call(this,"RightJoin",e)}fullJoin(...e){return be(this,lr,Dr).call(this,"FullJoin",e)}crossJoin(...e){return be(this,lr,Dr).call(this,"CrossJoin",e)}innerJoinLateral(...e){return be(this,lr,Dr).call(this,"LateralInnerJoin",e)}leftJoinLateral(...e){return be(this,lr,Dr).call(this,"LateralLeftJoin",e)}crossJoinLateral(...e){return be(this,lr,Dr).call(this,"LateralCrossJoin",e)}crossApply(...e){return be(this,lr,Dr).call(this,"CrossApply",e)}outerApply(...e){return be(this,lr,Dr).call(this,"OuterApply",e)}orderBy(...e){return new Te({...s(this,ue),queryNode:ye.cloneWithOrderByItems(s(this,ue).queryNode,ji(e))})}groupBy(e){return new Te({...s(this,ue),queryNode:rt.cloneWithGroupByItems(s(this,ue).queryNode,_f(e))})}limit(e){return new Te({...s(this,ue),queryNode:rt.cloneWithLimit(s(this,ue).queryNode,Ra.create(xt(e)))})}offset(e){return new Te({...s(this,ue),queryNode:rt.cloneWithOffset(s(this,ue).queryNode,hf.create(xt(e)))})}fetch(e,t="only"){return new Te({...s(this,ue),queryNode:rt.cloneWithFetch(s(this,ue).queryNode,yf(e,t))})}top(e,t){return new Te({...s(this,ue),queryNode:ye.cloneWithTop(s(this,ue).queryNode,In(e,t))})}union(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("union",e,!1))})}unionAll(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("union",e,!0))})}intersect(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("intersect",e,!1))})}intersectAll(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("intersect",e,!0))})}except(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("except",e,!1))})}exceptAll(e){return new Te({...s(this,ue),queryNode:rt.cloneWithSetOperations(s(this,ue).queryNode,Pn("except",e,!0))})}as(e){return new wf(this,e)}clearSelect(){return new Te({...s(this,ue),queryNode:rt.cloneWithoutSelections(s(this,ue).queryNode)})}clearWhere(){return new Te({...s(this,ue),queryNode:ye.cloneWithoutWhere(s(this,ue).queryNode)})}clearLimit(){return new Te({...s(this,ue),queryNode:rt.cloneWithoutLimit(s(this,ue).queryNode)})}clearOffset(){return new Te({...s(this,ue),queryNode:rt.cloneWithoutOffset(s(this,ue).queryNode)})}clearOrderBy(){return new Te({...s(this,ue),queryNode:ye.cloneWithoutOrderBy(s(this,ue).queryNode)})}clearGroupBy(){return new Te({...s(this,ue),queryNode:rt.cloneWithoutGroupBy(s(this,ue).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Te({...s(this,ue)})}$castTo(){return new Te(s(this,ue))}$narrowType(){return new Te(s(this,ue))}$assertType(){return new Te(s(this,ue))}$asTuple(){return new et(this.toOperationNode())}$asScalar(){return new et(this.toOperationNode())}withPlugin(e){return new Te({...s(this,ue),executor:s(this,ue).executor.withPlugin(e)})}toOperationNode(){return s(this,ue).executor.transformQuery(s(this,ue).queryNode,s(this,ue).queryId)}compile(){return s(this,ue).executor.compileQuery(this.toOperationNode(),s(this,ue).queryId)}async execute(){const e=this.compile();return(await s(this,ue).executor.executeQuery(e,s(this,ue).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ss){const t=await this.executeTakeFirst();if(t===void 0)throw As(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),o=s(this,ue).executor.stream(t,e,s(this,ue).queryId);for await(const p of o)yield*p.rows}async explain(e,t){return await new Te({...s(this,ue),queryNode:ye.cloneWithExplain(s(this,ue).queryNode,e,t)}).execute()}};ue=new WeakMap,lr=new WeakSet,Dr=function(e,t){return new Te({...s(this,ue),queryNode:ye.cloneWithJoin(s(this,ue).queryNode,Eo(e,t))})};let Va=Te;function $a(r){return new Va(r)}class wf{constructor(e,t){z(this,Gn);z(this,Kn);J(this,Gn,e),J(this,Kn,t)}get expression(){return s(this,Gn)}get alias(){return s(this,Kn)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return ei.create(s(this,Gn).toOperationNode(),Xe.create(s(this,Kn)))}}Gn=new WeakMap,Kn=new WeakMap;const vi=d({is(r){return r.kind==="AggregateFunctionNode"},create(r,e=[]){return d({kind:"AggregateFunctionNode",func:r,aggregated:e})},cloneWithDistinct(r){return d({...r,distinct:!0})},cloneWithOrderBy(r,e,t=!1){const o=t?"withinGroup":"orderBy";return d({...r,[o]:r[o]?On.cloneWithItems(r[o],e):On.create(e)})},cloneWithFilter(r,e){return d({...r,filter:r.filter?Gt.cloneWithOperation(r.filter,"And",e):Gt.create(e)})},cloneWithOrFilter(r,e){return d({...r,filter:r.filter?Gt.cloneWithOperation(r.filter,"Or",e):Gt.create(e)})},cloneWithOver(r,e){return d({...r,over:e})}}),Bc=d({is(r){return r.kind==="FunctionNode"},create(r,e){return d({kind:"FunctionNode",func:r,arguments:e})}}),Ir=class Ir{constructor(e){z(this,Nt);J(this,Nt,d(e))}get expressionType(){}as(e){return new bf(this,e)}distinct(){return new Ir({...s(this,Nt),aggregateFunctionNode:vi.cloneWithDistinct(s(this,Nt).aggregateFunctionNode)})}orderBy(...e){return new Ir({...s(this,Nt),aggregateFunctionNode:ye.cloneWithOrderByItems(s(this,Nt).aggregateFunctionNode,ji(e))})}clearOrderBy(){return new Ir({...s(this,Nt),aggregateFunctionNode:ye.cloneWithoutOrderBy(s(this,Nt).aggregateFunctionNode)})}withinGroupOrderBy(...e){return new Ir({...s(this,Nt),aggregateFunctionNode:vi.cloneWithOrderBy(s(this,Nt).aggregateFunctionNode,ji(e),!0)})}filterWhere(...e){return new Ir({...s(this,Nt),aggregateFunctionNode:vi.cloneWithFilter(s(this,Nt).aggregateFunctionNode,Pt(e))})}filterWhereRef(e,t,o){return new Ir({...s(this,Nt),aggregateFunctionNode:vi.cloneWithFilter(s(this,Nt).aggregateFunctionNode,Br(e,t,o))})}over(e){const t=cf();return new Ir({...s(this,Nt),aggregateFunctionNode:vi.cloneWithOver(s(this,Nt).aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new Ir(s(this,Nt))}$notNull(){return new Ir(s(this,Nt))}toOperationNode(){return s(this,Nt).aggregateFunctionNode}};Nt=new WeakMap;let ks=Ir;class bf{constructor(e,t){z(this,Yn);z(this,Xn);J(this,Yn,e),J(this,Xn,t)}get expression(){return s(this,Yn)}get alias(){return s(this,Xn)}toOperationNode(){return ei.create(s(this,Yn).toOperationNode(),Xe.create(s(this,Xn)))}}Yn=new WeakMap,Xn=new WeakMap;function Mc(){const r=(t,o)=>new et(Bc.create(t,qs(o??[]))),e=(t,o)=>new ks({aggregateFunctionNode:vi.create(t,o?qs(o):void 0)});return Object.assign(r,{agg:e,avg(t){return e("avg",[t])},coalesce(...t){return r("coalesce",t)},count(t){return e("count",[t])},countAll(t){return new ks({aggregateFunctionNode:vi.create("count",wr(t))})},max(t){return e("max",[t])},min(t){return e("min",[t])},sum(t){return e("sum",[t])},any(t){return r("any",[t])},jsonAgg(t){return new ks({aggregateFunctionNode:vi.create("json_agg",[Qt(t)?gt(t):t.toOperationNode()])})},toJson(t){return new et(Bc.create("to_json",[Qt(t)?gt(t):t.toOperationNode()]))}})}const Nf=d({is(r){return r.kind==="UnaryOperationNode"},create(r,e){return d({kind:"UnaryOperationNode",operator:r,operand:e})}});function qf(r,e){return Nf.create(Ni.create(r),nr(e))}const Mr=d({is(r){return r.kind==="CaseNode"},create(r){return d({kind:"CaseNode",value:r})},cloneWithWhen(r,e){return d({...r,when:d(r.when?[...r.when,e]:[e])})},cloneWithThen(r,e){return d({...r,when:r.when?d([...r.when.slice(0,-1),xs.cloneWithResult(r.when[r.when.length-1],e)]):void 0})},cloneWith(r,e){return d({...r,...e})}});class Uc{constructor(e){z(this,Zn);J(this,Zn,d(e))}when(...e){return new Qc({...s(this,Zn),node:Mr.cloneWithWhen(s(this,Zn).node,xs.create(Pt(e)))})}}Zn=new WeakMap;class Qc{constructor(e){z(this,es);J(this,es,d(e))}then(e){return new vf({...s(this,es),node:Mr.cloneWithThen(s(this,es).node,Oa(e)?ka(e):xt(e))})}}es=new WeakMap;class vf{constructor(e){z(this,jr);J(this,jr,d(e))}when(...e){return new Qc({...s(this,jr),node:Mr.cloneWithWhen(s(this,jr).node,xs.create(Pt(e)))})}else(e){return new xf({...s(this,jr),node:Mr.cloneWith(s(this,jr).node,{else:Oa(e)?ka(e):xt(e)})})}end(){return new et(Mr.cloneWith(s(this,jr).node,{isStatement:!1}))}endCase(){return new et(Mr.cloneWith(s(this,jr).node,{isStatement:!0}))}}jr=new WeakMap;class xf{constructor(e){z(this,ts);J(this,ts,d(e))}end(){return new et(Mr.cloneWith(s(this,ts).node,{isStatement:!1}))}endCase(){return new et(Mr.cloneWith(s(this,ts).node,{isStatement:!0}))}}ts=new WeakMap;const jc=d({is(r){return r.kind==="JSONPathLegNode"},create(r,e){return d({kind:"JSONPathLegNode",type:r,value:e})}});class Ha{constructor(e){z(this,zs);z(this,zr);J(this,zr,e)}at(e){return be(this,zs,Wl).call(this,"ArrayLocation",e)}key(e){return be(this,zs,Wl).call(this,"Member",e)}}zr=new WeakMap,zs=new WeakSet,Wl=function(e,t){return po.is(s(this,zr))?new So(po.cloneWithTraversal(s(this,zr),Ns.is(s(this,zr).traversal)?Ns.cloneWithLeg(s(this,zr).traversal,jc.create(e,t)):uc.cloneWithValue(s(this,zr).traversal,gr.createImmediate(t)))):new So(Ns.cloneWithLeg(s(this,zr),jc.create(e,t)))};const $o=class $o extends Ha{constructor(t){super(t);z(this,ln);J(this,ln,t)}get expressionType(){}as(t){return new Ef(this,t)}$castTo(){return new $o(s(this,ln))}$notNull(){return new $o(s(this,ln))}toOperationNode(){return s(this,ln)}};ln=new WeakMap;let So=$o;class Ef{constructor(e,t){z(this,rs);z(this,Ci);J(this,rs,e),J(this,Ci,t)}get expression(){return s(this,rs)}get alias(){return s(this,Ci)}toOperationNode(){return ei.create(s(this,rs).toOperationNode(),jt(s(this,Ci))?s(this,Ci).toOperationNode():Xe.create(s(this,Ci)))}}rs=new WeakMap,Ci=new WeakMap;const zc=d({is(r){return r.kind==="TupleNode"},create(r){return d({kind:"TupleNode",values:d(r)})}}),Sf=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],Af=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],Of=d({is(r){return r.kind==="DataTypeNode"},create(r){return d({kind:"DataTypeNode",dataType:r})}});function kf(r){return!!(Sf.includes(r)||Af.some(e=>e.test(r)))}function zi(r){if(jt(r))return r.toOperationNode();if(kf(r))return Of.create(r);throw new Error(`invalid column data type ${JSON.stringify(r)}`)}const If=d({is(r){return r.kind==="CastNode"},create(r,e){return d({kind:"CastNode",expression:r,dataType:e})}});function Ja(r=vo){function e(p,L,C){return new et(Ia(p,L,C))}function t(p,L){return new et(qf(p,L))}const o=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(p){return $a({queryId:ze(),executor:r,queryNode:rt.createFrom(Wn(p))})},case(p){return new Uc({node:Mr.create(wi(p)?void 0:nr(p))})},ref(p,L){return wi(L)?new et(ni(p)):new Ha(Sd(p,L))},jsonPath(){return new Ha(Ns.create())},table(p){return new et(gt(p))},val(p){return new et(xt(p))},refTuple(...p){return new et(zc.create(p.map(nr)))},tuple(...p){return new et(zc.create(p.map(xt)))},lit(p){return new et(ka(p))},unary:t,not(p){return t("not",p)},exists(p){return t("exists",p)},neg(p){return t("-",p)},between(p,L,C){return new et(Sn.create(nr(p),Ni.create("between"),bi.create(xt(L),xt(C))))},betweenSymmetric(p,L,C){return new et(Sn.create(nr(p),Ni.create("between symmetric"),bi.create(xt(L),xt(C))))},and(p){return Yr(p)?new et(yo(p,"and")):new et(pc(p,"and"))},or(p){return Yr(p)?new et(yo(p,"or")):new et(pc(p,"or"))},parens(...p){const L=Pt(p);return An.is(L)?new et(L):new et(An.create(L))},cast(p,L){return new et(If.create(nr(p),zi(L)))},withSchema(p){return Ja(r.withPluginAtFront(new Cn(p)))}});return o.fn=Mc(),o.eb=o,o}function Fn(r){return Ja()}function Vi(r){if(jt(r))return r.toOperationNode();if(tr(r))return r(Fn()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function Vc(r){if(jt(r))return r.toOperationNode();if(tr(r))return r(Fn()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function Is(r){return ic(r)||yd(r)||tr(r)}class Tf{constructor(e){z(this,is);J(this,is,e)}get table(){return s(this,is)}as(e){return new Cf(s(this,is),e)}}is=new WeakMap;class Cf{constructor(e,t){z(this,ns);z(this,ss);J(this,ns,e),J(this,ss,t)}get table(){return s(this,ns)}get alias(){return s(this,ss)}toOperationNode(){return ei.create(gt(s(this,ns)),Xe.create(s(this,ss)))}}ns=new WeakMap,ss=new WeakMap;function Lf(r){return Sr(r)&&jt(r)&&Qt(r.table)&&Qt(r.alias)}function Wn(r){return Yr(r)?r.map(e=>Ts(e)):[Ts(r)]}function Ts(r){return Qt(r)?$c(r):Lf(r)?r.toOperationNode():Vc(r)}function $c(r){const e=" as ";if(r.includes(e)){const[t,o]=r.split(e).map(Hc);return ei.create(gt(t),Xe.create(o))}else return gt(r)}function gt(r){const e=".";if(r.includes(e)){const[t,o]=r.split(e).map(Hc);return ti.createWithSchema(t,o)}else return ti.create(r)}function Hc(r){return r.trim()}const Jc=d({is(r){return r.kind==="AddColumnNode"},create(r){return d({kind:"AddColumnNode",column:r})}}),ut=d({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return d({kind:"ColumnDefinitionNode",column:bt.create(r),dataType:e})},cloneWithFrontModifier(r,e){return d({...r,frontModifiers:r.frontModifiers?d([...r.frontModifiers,e]):[e]})},cloneWithEndModifier(r,e){return d({...r,endModifiers:r.endModifiers?d([...r.endModifiers,e]):[e]})},cloneWith(r,e){return d({...r,...e})}}),Gc=d({is(r){return r.kind==="DropColumnNode"},create(r){return d({kind:"DropColumnNode",column:bt.create(r)})}}),Kc=d({is(r){return r.kind==="RenameColumnNode"},create(r,e){return d({kind:"RenameColumnNode",column:bt.create(r),renameTo:bt.create(e)})}}),Ga=d({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return d({kind:"CheckConstraintNode",expression:r,name:e?Xe.create(e):void 0})}}),Pf=["no action","restrict","cascade","set null","set default"],Ao=d({is(r){return r.kind==="ReferencesNode"},create(r,e){return d({kind:"ReferencesNode",table:r,columns:d([...e])})},cloneWithOnDelete(r,e){return d({...r,onDelete:e})},cloneWithOnUpdate(r,e){return d({...r,onUpdate:e})}});function Yc(r){return jt(r)?r.toOperationNode():gr.createImmediate(r)}const Oo=d({is(r){return r.kind==="GeneratedNode"},create(r){return d({kind:"GeneratedNode",...r})},createWithExpression(r){return d({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return d({...r,...e})}}),Ff=d({is(r){return r.kind==="DefaultValueNode"},create(r){return d({kind:"DefaultValueNode",defaultValue:r})}});function ko(r){if(Pf.includes(r))return r;throw new Error(`invalid OnModifyForeignAction ${r}`)}const qt=class qt{constructor(e){z(this,$e);J(this,$e,e)}autoIncrement(){return new qt(ut.cloneWith(s(this,$e),{autoIncrement:!0}))}identity(){return new qt(ut.cloneWith(s(this,$e),{identity:!0}))}primaryKey(){return new qt(ut.cloneWith(s(this,$e),{primaryKey:!0}))}references(e){const t=ni(e);if(!t.table||xa.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new qt(ut.cloneWith(s(this,$e),{references:Ao.create(t.table,[t.column])}))}onDelete(e){if(!s(this,$e).references)throw new Error("on delete constraint can only be added for foreign keys");return new qt(ut.cloneWith(s(this,$e),{references:Ao.cloneWithOnDelete(s(this,$e).references,ko(e))}))}onUpdate(e){if(!s(this,$e).references)throw new Error("on update constraint can only be added for foreign keys");return new qt(ut.cloneWith(s(this,$e),{references:Ao.cloneWithOnUpdate(s(this,$e).references,ko(e))}))}unique(){return new qt(ut.cloneWith(s(this,$e),{unique:!0}))}notNull(){return new qt(ut.cloneWith(s(this,$e),{notNull:!0}))}unsigned(){return new qt(ut.cloneWith(s(this,$e),{unsigned:!0}))}defaultTo(e){return new qt(ut.cloneWith(s(this,$e),{defaultTo:Ff.create(Yc(e))}))}check(e){return new qt(ut.cloneWith(s(this,$e),{check:Ga.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new qt(ut.cloneWith(s(this,$e),{generated:Oo.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new qt(ut.cloneWith(s(this,$e),{generated:Oo.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new qt(ut.cloneWith(s(this,$e),{generated:Oo.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,$e).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new qt(ut.cloneWith(s(this,$e),{generated:Oo.cloneWith(s(this,$e).generated,{stored:!0})}))}modifyFront(e){return new qt(ut.cloneWithFrontModifier(s(this,$e),e.toOperationNode()))}nullsNotDistinct(){return new qt(ut.cloneWith(s(this,$e),{nullsNotDistinct:!0}))}ifNotExists(){return new qt(ut.cloneWith(s(this,$e),{ifNotExists:!0}))}modifyEnd(e){return new qt(ut.cloneWithEndModifier(s(this,$e),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,$e)}};$e=new WeakMap;let $i=qt;const Xc=d({is(r){return r.kind==="ModifyColumnNode"},create(r){return d({kind:"ModifyColumnNode",column:r})}}),xi=d({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,t,o){return d({kind:"ForeignKeyConstraintNode",columns:r,references:Ao.create(e,t),name:o?Xe.create(o):void 0})},cloneWith(r,e){return d({...r,...e})}}),Li=class Li{constructor(e){z(this,Tr);J(this,Tr,e)}onDelete(e){return new Li(xi.cloneWith(s(this,Tr),{onDelete:ko(e)}))}onUpdate(e){return new Li(xi.cloneWith(s(this,Tr),{onUpdate:ko(e)}))}deferrable(){return new Li(xi.cloneWith(s(this,Tr),{deferrable:!0}))}notDeferrable(){return new Li(xi.cloneWith(s(this,Tr),{deferrable:!1}))}initiallyDeferred(){return new Li(xi.cloneWith(s(this,Tr),{initiallyDeferred:!0}))}initiallyImmediate(){return new Li(xi.cloneWith(s(this,Tr),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return s(this,Tr)}};Tr=new WeakMap;let Io=Li;const To=d({is(r){return r.kind==="AddConstraintNode"},create(r){return d({kind:"AddConstraintNode",constraint:r})}}),Hi=d({is(r){return r.kind==="UniqueConstraintNode"},create(r,e,t){return d({kind:"UniqueConstraintNode",columns:d(r.map(bt.create)),name:e?Xe.create(e):void 0,nullsNotDistinct:t})},cloneWith(r,e){return d({...r,...e})}}),Co=d({is(r){return r.kind==="DropConstraintNode"},create(r){return d({kind:"DropConstraintNode",constraintName:Xe.create(r)})},cloneWith(r,e){return d({...r,...e})}}),Cs=d({is(r){return r.kind==="AlterColumnNode"},create(r,e,t){return d({kind:"AlterColumnNode",column:bt.create(r),[e]:t})}});class Zc{constructor(e){z(this,ci);J(this,ci,e)}setDataType(e){return new Ls(Cs.create(s(this,ci),"dataType",zi(e)))}setDefault(e){return new Ls(Cs.create(s(this,ci),"setDefault",Yc(e)))}dropDefault(){return new Ls(Cs.create(s(this,ci),"dropDefault",!0))}setNotNull(){return new Ls(Cs.create(s(this,ci),"setNotNull",!0))}dropNotNull(){return new Ls(Cs.create(s(this,ci),"dropNotNull",!0))}$call(e){return e(this)}}ci=new WeakMap;class Ls{constructor(e){z(this,Vs);J(this,Vs,e)}toOperationNode(){return s(this,Vs)}}Vs=new WeakMap;class Dn{constructor(e){z(this,Cr);J(this,Cr,d(e))}toOperationNode(){return s(this,Cr).executor.transformQuery(s(this,Cr).node,s(this,Cr).queryId)}compile(){return s(this,Cr).executor.compileQuery(this.toOperationNode(),s(this,Cr).queryId)}async execute(){await s(this,Cr).executor.executeQuery(this.compile(),s(this,Cr).queryId)}}Cr=new WeakMap;const Pi=class Pi{constructor(e){z(this,pt);J(this,pt,d(e))}onDelete(e){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.onDelete(e)})}onUpdate(e){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.onUpdate(e)})}deferrable(){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.deferrable()})}notDeferrable(){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.notDeferrable()})}initiallyDeferred(){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new Pi({...s(this,pt),constraintBuilder:s(this,pt).constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return s(this,pt).executor.transformQuery(Ke.cloneWithTableProps(s(this,pt).node,{addConstraint:To.create(s(this,pt).constraintBuilder.toOperationNode())}),s(this,pt).queryId)}compile(){return s(this,pt).executor.compileQuery(this.toOperationNode(),s(this,pt).queryId)}async execute(){await s(this,pt).executor.executeQuery(this.compile(),s(this,pt).queryId)}};pt=new WeakMap;let Ka=Pi;const $s=class $s{constructor(e){z(this,Et);J(this,Et,d(e))}ifExists(){return new $s({...s(this,Et),node:Ke.cloneWithTableProps(s(this,Et).node,{dropConstraint:Co.cloneWith(s(this,Et).node.dropConstraint,{ifExists:!0})})})}cascade(){return new $s({...s(this,Et),node:Ke.cloneWithTableProps(s(this,Et).node,{dropConstraint:Co.cloneWith(s(this,Et).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new $s({...s(this,Et),node:Ke.cloneWithTableProps(s(this,Et).node,{dropConstraint:Co.cloneWith(s(this,Et).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,Et).executor.transformQuery(s(this,Et).node,s(this,Et).queryId)}compile(){return s(this,Et).executor.compileQuery(this.toOperationNode(),s(this,Et).queryId)}async execute(){await s(this,Et).executor.executeQuery(this.compile(),s(this,Et).queryId)}};Et=new WeakMap;let Lo=$s;const Rn=d({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return d({kind:"PrimaryKeyConstraintNode",columns:d(r.map(bt.create)),name:e?Xe.create(e):void 0})},cloneWith(r,e){return d({...r,...e})}}),Bn=d({is(r){return r.kind==="AddIndexNode"},create(r){return d({kind:"AddIndexNode",name:Xe.create(r)})},cloneWith(r,e){return d({...r,...e})},cloneWithColumns(r,e){return d({...r,columns:[...r.columns||[],...e]})}}),cn=class cn{constructor(e){z(this,nt);J(this,nt,d(e))}unique(){return new cn({...s(this,nt),node:Ke.cloneWithTableProps(s(this,nt).node,{addIndex:Bn.cloneWith(s(this,nt).node.addIndex,{unique:!0})})})}column(e){return new cn({...s(this,nt),node:Ke.cloneWithTableProps(s(this,nt).node,{addIndex:Bn.cloneWithColumns(s(this,nt).node.addIndex,[_o(e)])})})}columns(e){return new cn({...s(this,nt),node:Ke.cloneWithTableProps(s(this,nt).node,{addIndex:Bn.cloneWithColumns(s(this,nt).node.addIndex,e.map(_o))})})}expression(e){return new cn({...s(this,nt),node:Ke.cloneWithTableProps(s(this,nt).node,{addIndex:Bn.cloneWithColumns(s(this,nt).node.addIndex,[e.toOperationNode()])})})}using(e){return new cn({...s(this,nt),node:Ke.cloneWithTableProps(s(this,nt).node,{addIndex:Bn.cloneWith(s(this,nt).node.addIndex,{using:kt.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return s(this,nt).executor.transformQuery(s(this,nt).node,s(this,nt).queryId)}compile(){return s(this,nt).executor.compileQuery(this.toOperationNode(),s(this,nt).queryId)}async execute(){await s(this,nt).executor.executeQuery(this.compile(),s(this,nt).queryId)}};nt=new WeakMap;let Ya=cn;const un=class un{constructor(e){z(this,Vr);J(this,Vr,e)}nullsNotDistinct(){return new un(Hi.cloneWith(s(this,Vr),{nullsNotDistinct:!0}))}deferrable(){return new un(Hi.cloneWith(s(this,Vr),{deferrable:!0}))}notDeferrable(){return new un(Hi.cloneWith(s(this,Vr),{deferrable:!1}))}initiallyDeferred(){return new un(Hi.cloneWith(s(this,Vr),{initiallyDeferred:!0}))}initiallyImmediate(){return new un(Hi.cloneWith(s(this,Vr),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return s(this,Vr)}};Vr=new WeakMap;let Po=un;const os=class os{constructor(e){z(this,ui);J(this,ui,e)}deferrable(){return new os(Rn.cloneWith(s(this,ui),{deferrable:!0}))}notDeferrable(){return new os(Rn.cloneWith(s(this,ui),{deferrable:!1}))}initiallyDeferred(){return new os(Rn.cloneWith(s(this,ui),{initiallyDeferred:!0}))}initiallyImmediate(){return new os(Rn.cloneWith(s(this,ui),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return s(this,ui)}};ui=new WeakMap;let Fo=os;class eu{constructor(e){z(this,Hs);J(this,Hs,e)}$call(e){return e(this)}toOperationNode(){return s(this,Hs)}}Hs=new WeakMap;const Wf=d({is(r){return r.kind==="RenameConstraintNode"},create(r,e){return d({kind:"RenameConstraintNode",oldName:Xe.create(r),newName:Xe.create(e)})}});class Df{constructor(e){z(this,Ue);J(this,Ue,d(e))}renameTo(e){return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{renameTo:gt(e)})})}setSchema(e){return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{setSchema:Xe.create(e)})})}alterColumn(e,t){const o=t(new Zc(e));return new Ji({...s(this,Ue),node:Ke.cloneWithColumnAlteration(s(this,Ue).node,o.toOperationNode())})}dropColumn(e){return new Ji({...s(this,Ue),node:Ke.cloneWithColumnAlteration(s(this,Ue).node,Gc.create(e))})}renameColumn(e,t){return new Ji({...s(this,Ue),node:Ke.cloneWithColumnAlteration(s(this,Ue).node,Kc.create(e,t))})}addColumn(e,t,o=rr){const p=o(new $i(ut.create(e,zi(t))));return new Ji({...s(this,Ue),node:Ke.cloneWithColumnAlteration(s(this,Ue).node,Jc.create(p.toOperationNode()))})}modifyColumn(e,t,o=rr){const p=o(new $i(ut.create(e,zi(t))));return new Ji({...s(this,Ue),node:Ke.cloneWithColumnAlteration(s(this,Ue).node,Xc.create(p.toOperationNode()))})}addUniqueConstraint(e,t,o=rr){const p=o(new Po(Hi.create(t,e)));return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{addConstraint:To.create(p.toOperationNode())})})}addCheckConstraint(e,t,o=rr){const p=o(new eu(Ga.create(t.toOperationNode(),e)));return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{addConstraint:To.create(p.toOperationNode())})})}addForeignKeyConstraint(e,t,o,p,L=rr){const C=L(new Io(xi.create(t.map(bt.create),gt(o),p.map(bt.create),e)));return new Ka({...s(this,Ue),constraintBuilder:C})}addPrimaryKeyConstraint(e,t,o=rr){const p=o(new Fo(Rn.create(t,e)));return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{addConstraint:To.create(p.toOperationNode())})})}dropConstraint(e){return new Lo({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{dropConstraint:Co.create(e)})})}renameConstraint(e,t){return new Lo({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{renameConstraint:Wf.create(e,t)})})}addIndex(e){return new Ya({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{addIndex:Bn.create(e)})})}dropIndex(e){return new Dn({...s(this,Ue),node:Ke.cloneWithTableProps(s(this,Ue).node,{dropIndex:ws.create(e)})})}$call(e){return e(this)}}Ue=new WeakMap;const dn=class dn{constructor(e){z(this,vt);J(this,vt,d(e))}alterColumn(e,t){const o=t(new Zc(e));return new dn({...s(this,vt),node:Ke.cloneWithColumnAlteration(s(this,vt).node,o.toOperationNode())})}dropColumn(e){return new dn({...s(this,vt),node:Ke.cloneWithColumnAlteration(s(this,vt).node,Gc.create(e))})}renameColumn(e,t){return new dn({...s(this,vt),node:Ke.cloneWithColumnAlteration(s(this,vt).node,Kc.create(e,t))})}addColumn(e,t,o=rr){const p=o(new $i(ut.create(e,zi(t))));return new dn({...s(this,vt),node:Ke.cloneWithColumnAlteration(s(this,vt).node,Jc.create(p.toOperationNode()))})}modifyColumn(e,t,o=rr){const p=o(new $i(ut.create(e,zi(t))));return new dn({...s(this,vt),node:Ke.cloneWithColumnAlteration(s(this,vt).node,Xc.create(p.toOperationNode()))})}toOperationNode(){return s(this,vt).executor.transformQuery(s(this,vt).node,s(this,vt).queryId)}compile(){return s(this,vt).executor.compileQuery(this.toOperationNode(),s(this,vt).queryId)}async execute(){await s(this,vt).executor.executeQuery(this.compile(),s(this,vt).queryId)}};vt=new WeakMap;let Ji=dn;class tu extends Cc{transformPrimitiveValueList(e){return mo.create(e.values.map(gr.createImmediate))}transformValue(e){return gr.createImmediate(e.value)}}const Lr=class Lr{constructor(e){z(this,He);J(this,He,d(e))}ifNotExists(){return new Lr({...s(this,He),node:Xr.cloneWith(s(this,He).node,{ifNotExists:!0})})}unique(){return new Lr({...s(this,He),node:Xr.cloneWith(s(this,He).node,{unique:!0})})}nullsNotDistinct(){return new Lr({...s(this,He),node:Xr.cloneWith(s(this,He).node,{nullsNotDistinct:!0})})}on(e){return new Lr({...s(this,He),node:Xr.cloneWith(s(this,He).node,{table:gt(e)})})}column(e){return new Lr({...s(this,He),node:Xr.cloneWithColumns(s(this,He).node,[_o(e)])})}columns(e){return new Lr({...s(this,He),node:Xr.cloneWithColumns(s(this,He).node,e.map(_o))})}expression(e){return new Lr({...s(this,He),node:Xr.cloneWithColumns(s(this,He).node,[e.toOperationNode()])})}using(e){return new Lr({...s(this,He),node:Xr.cloneWith(s(this,He).node,{using:kt.createWithSql(e)})})}where(...e){const t=new tu;return new Lr({...s(this,He),node:ye.cloneWithWhere(s(this,He).node,t.transformNode(Pt(e),s(this,He).queryId))})}$call(e){return e(this)}toOperationNode(){return s(this,He).executor.transformQuery(s(this,He).node,s(this,He).queryId)}compile(){return s(this,He).executor.compileQuery(this.toOperationNode(),s(this,He).queryId)}async execute(){await s(this,He).executor.executeQuery(this.compile(),s(this,He).queryId)}};He=new WeakMap;let Xa=Lr;const bl=class bl{constructor(e){z(this,cr);J(this,cr,d(e))}ifNotExists(){return new bl({...s(this,cr),node:rc.cloneWith(s(this,cr).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,cr).executor.transformQuery(s(this,cr).node,s(this,cr).queryId)}compile(){return s(this,cr).executor.compileQuery(this.toOperationNode(),s(this,cr).queryId)}async execute(){await s(this,cr).executor.executeQuery(this.compile(),s(this,cr).queryId)}};cr=new WeakMap;let Za=bl;function Rf(r){if(md.includes(r))return r;throw new Error(`invalid OnCommitAction ${r}`)}const ur=class ur{constructor(e){z(this,Qe);J(this,Qe,d(e))}temporary(){return new ur({...s(this,Qe),node:ir.cloneWith(s(this,Qe).node,{temporary:!0})})}onCommit(e){return new ur({...s(this,Qe),node:ir.cloneWith(s(this,Qe).node,{onCommit:Rf(e)})})}ifNotExists(){return new ur({...s(this,Qe),node:ir.cloneWith(s(this,Qe).node,{ifNotExists:!0})})}addColumn(e,t,o=rr){const p=o(new $i(ut.create(e,zi(t))));return new ur({...s(this,Qe),node:ir.cloneWithColumn(s(this,Qe).node,p.toOperationNode())})}addPrimaryKeyConstraint(e,t,o=rr){const p=o(new Fo(Rn.create(t,e)));return new ur({...s(this,Qe),node:ir.cloneWithConstraint(s(this,Qe).node,p.toOperationNode())})}addUniqueConstraint(e,t,o=rr){const p=o(new Po(Hi.create(t,e)));return new ur({...s(this,Qe),node:ir.cloneWithConstraint(s(this,Qe).node,p.toOperationNode())})}addCheckConstraint(e,t,o=rr){const p=o(new eu(Ga.create(t.toOperationNode(),e)));return new ur({...s(this,Qe),node:ir.cloneWithConstraint(s(this,Qe).node,p.toOperationNode())})}addForeignKeyConstraint(e,t,o,p,L=rr){const C=L(new Io(xi.create(t.map(bt.create),gt(o),p.map(bt.create),e)));return new ur({...s(this,Qe),node:ir.cloneWithConstraint(s(this,Qe).node,C.toOperationNode())})}modifyFront(e){return new ur({...s(this,Qe),node:ir.cloneWithFrontModifier(s(this,Qe).node,e.toOperationNode())})}modifyEnd(e){return new ur({...s(this,Qe),node:ir.cloneWithEndModifier(s(this,Qe).node,e.toOperationNode())})}as(e){return new ur({...s(this,Qe),node:ir.cloneWith(s(this,Qe).node,{selectQuery:Vi(e)})})}$call(e){return e(this)}toOperationNode(){return s(this,Qe).executor.transformQuery(s(this,Qe).node,s(this,Qe).queryId)}compile(){return s(this,Qe).executor.compileQuery(this.toOperationNode(),s(this,Qe).queryId)}async execute(){await s(this,Qe).executor.executeQuery(this.compile(),s(this,Qe).queryId)}};Qe=new WeakMap;let el=ur;const Js=class Js{constructor(e){z(this,Ft);J(this,Ft,d(e))}on(e){return new Js({...s(this,Ft),node:ws.cloneWith(s(this,Ft).node,{table:gt(e)})})}ifExists(){return new Js({...s(this,Ft),node:ws.cloneWith(s(this,Ft).node,{ifExists:!0})})}cascade(){return new Js({...s(this,Ft),node:ws.cloneWith(s(this,Ft).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Ft).executor.transformQuery(s(this,Ft).node,s(this,Ft).queryId)}compile(){return s(this,Ft).executor.compileQuery(this.toOperationNode(),s(this,Ft).queryId)}async execute(){await s(this,Ft).executor.executeQuery(this.compile(),s(this,Ft).queryId)}};Ft=new WeakMap;let tl=Js;const Ho=class Ho{constructor(e){z(this,zt);J(this,zt,d(e))}ifExists(){return new Ho({...s(this,zt),node:Na.cloneWith(s(this,zt).node,{ifExists:!0})})}cascade(){return new Ho({...s(this,zt),node:Na.cloneWith(s(this,zt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,zt).executor.transformQuery(s(this,zt).node,s(this,zt).queryId)}compile(){return s(this,zt).executor.compileQuery(this.toOperationNode(),s(this,zt).queryId)}async execute(){await s(this,zt).executor.executeQuery(this.compile(),s(this,zt).queryId)}};zt=new WeakMap;let rl=Ho;const Jo=class Jo{constructor(e){z(this,Vt);J(this,Vt,d(e))}ifExists(){return new Jo({...s(this,Vt),node:qa.cloneWith(s(this,Vt).node,{ifExists:!0})})}cascade(){return new Jo({...s(this,Vt),node:qa.cloneWith(s(this,Vt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Vt).executor.transformQuery(s(this,Vt).node,s(this,Vt).queryId)}compile(){return s(this,Vt).executor.compileQuery(this.toOperationNode(),s(this,Vt).queryId)}async execute(){await s(this,Vt).executor.executeQuery(this.compile(),s(this,Vt).queryId)}};Vt=new WeakMap;let il=Jo;const Ei=d({is(r){return r.kind==="CreateViewNode"},create(r){return d({kind:"CreateViewNode",name:Zr.create(r)})},cloneWith(r,e){return d({...r,...e})}});class Bf{constructor(){z(this,Go,new tu)}transformQuery(e){return s(this,Go).transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}Go=new WeakMap;const Fi=class Fi{constructor(e){z(this,mt);J(this,mt,d(e))}temporary(){return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{temporary:!0})})}materialized(){return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{materialized:!0})})}ifNotExists(){return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{ifNotExists:!0})})}orReplace(){return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{orReplace:!0})})}columns(e){return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{columns:e.map(fc)})})}as(e){const t=e.withPlugin(new Bf).toOperationNode();return new Fi({...s(this,mt),node:Ei.cloneWith(s(this,mt).node,{as:t})})}$call(e){return e(this)}toOperationNode(){return s(this,mt).executor.transformQuery(s(this,mt).node,s(this,mt).queryId)}compile(){return s(this,mt).executor.compileQuery(this.toOperationNode(),s(this,mt).queryId)}async execute(){await s(this,mt).executor.executeQuery(this.compile(),s(this,mt).queryId)}};mt=new WeakMap;let nl=Fi;const Wo=d({is(r){return r.kind==="DropViewNode"},create(r){return d({kind:"DropViewNode",name:Zr.create(r)})},cloneWith(r,e){return d({...r,...e})}}),Gs=class Gs{constructor(e){z(this,Wt);J(this,Wt,d(e))}materialized(){return new Gs({...s(this,Wt),node:Wo.cloneWith(s(this,Wt).node,{materialized:!0})})}ifExists(){return new Gs({...s(this,Wt),node:Wo.cloneWith(s(this,Wt).node,{ifExists:!0})})}cascade(){return new Gs({...s(this,Wt),node:Wo.cloneWith(s(this,Wt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Wt).executor.transformQuery(s(this,Wt).node,s(this,Wt).queryId)}compile(){return s(this,Wt).executor.compileQuery(this.toOperationNode(),s(this,Wt).queryId)}async execute(){await s(this,Wt).executor.executeQuery(this.compile(),s(this,Wt).queryId)}};Wt=new WeakMap;let sl=Gs;const ru=d({is(r){return r.kind==="CreateTypeNode"},create(r){return d({kind:"CreateTypeNode",name:r})},cloneWithEnum(r,e){return d({...r,enum:mo.create(e.map(gr.createImmediate))})}}),Nl=class Nl{constructor(e){z(this,dr);J(this,dr,d(e))}toOperationNode(){return s(this,dr).executor.transformQuery(s(this,dr).node,s(this,dr).queryId)}asEnum(e){return new Nl({...s(this,dr),node:ru.cloneWithEnum(s(this,dr).node,e)})}$call(e){return e(this)}compile(){return s(this,dr).executor.compileQuery(this.toOperationNode(),s(this,dr).queryId)}async execute(){await s(this,dr).executor.executeQuery(this.compile(),s(this,dr).queryId)}};dr=new WeakMap;let ol=Nl;const iu=d({is(r){return r.kind==="DropTypeNode"},create(r){return d({kind:"DropTypeNode",name:r})},cloneWith(r,e){return d({...r,...e})}}),ql=class ql{constructor(e){z(this,fr);J(this,fr,d(e))}ifExists(){return new ql({...s(this,fr),node:iu.cloneWith(s(this,fr).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,fr).executor.transformQuery(s(this,fr).node,s(this,fr).queryId)}compile(){return s(this,fr).executor.compileQuery(this.toOperationNode(),s(this,fr).queryId)}async execute(){await s(this,fr).executor.executeQuery(this.compile(),s(this,fr).queryId)}};fr=new WeakMap;let al=ql;function nu(r){const e=".";if(r.includes(e)){const t=r.split(e).map(Mf);if(t.length===2)return Zr.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${r}`)}else return Zr.create(r)}function Mf(r){return r.trim()}const Do=d({is(r){return r.kind==="RefreshMaterializedViewNode"},create(r){return d({kind:"RefreshMaterializedViewNode",name:Zr.create(r)})},cloneWith(r,e){return d({...r,...e})}}),Ks=class Ks{constructor(e){z(this,Dt);J(this,Dt,d(e))}concurrently(){return new Ks({...s(this,Dt),node:Do.cloneWith(s(this,Dt).node,{concurrently:!0,withNoData:!1})})}withData(){return new Ks({...s(this,Dt),node:Do.cloneWith(s(this,Dt).node,{withNoData:!1})})}withNoData(){return new Ks({...s(this,Dt),node:Do.cloneWith(s(this,Dt).node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return s(this,Dt).executor.transformQuery(s(this,Dt).node,s(this,Dt).queryId)}compile(){return s(this,Dt).executor.compileQuery(this.toOperationNode(),s(this,Dt).queryId)}async execute(){await s(this,Dt).executor.executeQuery(this.compile(),s(this,Dt).queryId)}};Dt=new WeakMap;let ll=Ks;const Ys=class Ys{constructor(e){z(this,At);J(this,At,e)}createTable(e){return new el({queryId:ze(),executor:s(this,At),node:ir.create(gt(e))})}dropTable(e){return new il({queryId:ze(),executor:s(this,At),node:qa.create(gt(e))})}createIndex(e){return new Xa({queryId:ze(),executor:s(this,At),node:Xr.create(e)})}dropIndex(e){return new tl({queryId:ze(),executor:s(this,At),node:ws.create(e)})}createSchema(e){return new Za({queryId:ze(),executor:s(this,At),node:rc.create(e)})}dropSchema(e){return new rl({queryId:ze(),executor:s(this,At),node:Na.create(e)})}alterTable(e){return new Df({queryId:ze(),executor:s(this,At),node:Ke.create(gt(e))})}createView(e){return new nl({queryId:ze(),executor:s(this,At),node:Ei.create(e)})}refreshMaterializedView(e){return new ll({queryId:ze(),executor:s(this,At),node:Do.create(e)})}dropView(e){return new sl({queryId:ze(),executor:s(this,At),node:Wo.create(e)})}createType(e){return new ol({queryId:ze(),executor:s(this,At),node:ru.create(nu(e))})}dropType(e){return new al({queryId:ze(),executor:s(this,At),node:iu.create(nu(e))})}withPlugin(e){return new Ys(s(this,At).withPlugin(e))}withoutPlugins(){return new Ys(s(this,At).withoutPlugins())}withSchema(e){return new Ys(s(this,At).withPluginAtFront(new Cn(e)))}};At=new WeakMap;let cl=Ys;class Uf{ref(e){return new vd(e)}table(e){return new Tf(e)}}class Qf{constructor(e){z(this,as);J(this,as,e)}async provideConnection(e){const t=await s(this,as).acquireConnection();try{return await e(t)}finally{await s(this,as).releaseConnection(t)}}}as=new WeakMap;const fn=class fn extends Wc{constructor(t,o,p,L=[]){super(L);z(this,$r);z(this,Hr);z(this,di);J(this,$r,t),J(this,Hr,o),J(this,di,p)}get adapter(){return s(this,Hr)}compileQuery(t,o){return s(this,$r).compileQuery(t,o)}provideConnection(t){return s(this,di).provideConnection(t)}withPlugins(t){return new fn(s(this,$r),s(this,Hr),s(this,di),[...this.plugins,...t])}withPlugin(t){return new fn(s(this,$r),s(this,Hr),s(this,di),[...this.plugins,t])}withPluginAtFront(t){return new fn(s(this,$r),s(this,Hr),s(this,di),[t,...this.plugins])}withConnectionProvider(t){return new fn(s(this,$r),s(this,Hr),t,[...this.plugins])}withoutPlugins(){return new fn(s(this,$r),s(this,Hr),s(this,di),[])}};$r=new WeakMap,Hr=new WeakMap,di=new WeakMap;let ul=fn;function dl(){return typeof performance<"u"&&tr(performance.now)?performance.now():Date.now()}class jf{constructor(e,t){z(this,$t);z(this,Rt);z(this,Wi);z(this,fi);z(this,ls);z(this,hi);z(this,Xs,new WeakSet);J(this,ls,!1),J(this,Rt,e),J(this,Wi,t)}async init(){if(s(this,hi))throw new Error("driver has already been destroyed");s(this,fi)||J(this,fi,s(this,Rt).init().then(()=>{J(this,ls,!0)}).catch(e=>(J(this,fi,void 0),Promise.reject(e)))),await s(this,fi)}async acquireConnection(){if(s(this,hi))throw new Error("driver has already been destroyed");s(this,ls)||await this.init();const e=await s(this,Rt).acquireConnection();return s(this,Xs).has(e)||(be(this,$t,Au).call(this)&&be(this,$t,Ou).call(this,e),s(this,Xs).add(e)),e}async releaseConnection(e){await s(this,Rt).releaseConnection(e)}beginTransaction(e,t){return s(this,Rt).beginTransaction(e,t)}commitTransaction(e){return s(this,Rt).commitTransaction(e)}rollbackTransaction(e){return s(this,Rt).rollbackTransaction(e)}savepoint(e,t,o){if(s(this,Rt).savepoint)return s(this,Rt).savepoint(e,t,o);throw new Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,o){if(s(this,Rt).rollbackToSavepoint)return s(this,Rt).rollbackToSavepoint(e,t,o);throw new Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,o){if(s(this,Rt).releaseSavepoint)return s(this,Rt).releaseSavepoint(e,t,o);throw new Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){s(this,fi)&&(await s(this,fi),s(this,hi)||J(this,hi,s(this,Rt).destroy().catch(e=>(J(this,hi,void 0),Promise.reject(e)))),await s(this,hi))}}Rt=new WeakMap,Wi=new WeakMap,fi=new WeakMap,ls=new WeakMap,hi=new WeakMap,Xs=new WeakMap,$t=new WeakSet,Au=function(){return s(this,Wi).isLevelEnabled("query")||s(this,Wi).isLevelEnabled("error")},Ou=function(e){const t=e.executeQuery,o=e.streamQuery,p=this;e.executeQuery=async L=>{var le,$;let C;const ne=dl();try{return await t.call(e,L)}catch(fe){throw C=fe,await be(le=p,$t,Dl).call(le,fe,L,ne),fe}finally{C||await be($=p,$t,Rl).call($,L,ne)}},e.streamQuery=async function*(L,C){var $,fe;let ne;const le=dl();try{for await(const U of o.call(e,L,C))yield U}catch(U){throw ne=U,await be($=p,$t,Dl).call($,U,L,le),U}finally{ne||await be(fe=p,$t,Rl).call(fe,L,le,!0)}}},Dl=async function(e,t,o){await s(this,Wi).error(()=>({level:"error",error:e,query:t,queryDurationMillis:be(this,$t,Bl).call(this,o)}))},Rl=async function(e,t,o=!1){await s(this,Wi).query(()=>({level:"query",isStream:o,query:e,queryDurationMillis:be(this,$t,Bl).call(this,t)}))},Bl=function(e){return dl()-e};const zf=()=>{};class fl{constructor(e){z(this,Ko);z(this,Zs);z(this,Di);J(this,Zs,e)}async provideConnection(e){for(;s(this,Di);)await s(this,Di).catch(zf);return J(this,Di,be(this,Ko,ku).call(this,e).finally(()=>{J(this,Di,void 0)})),s(this,Di)}}Zs=new WeakMap,Di=new WeakMap,Ko=new WeakSet,ku=async function(e){return await e(s(this,Zs))};const Vf=["read only","read write"],$f=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function su(r){if(r.accessMode&&!Vf.includes(r.accessMode))throw new Error(`invalid transaction access mode ${r.accessMode}`);if(r.isolationLevel&&!$f.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}d(["query","error"]);class Hf{constructor(e){z(this,Ri);z(this,hn);tr(e)?(J(this,hn,e),J(this,Ri,d({query:!0,error:!0}))):(J(this,hn,Jf),J(this,Ri,d({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Ri)[e]}async query(e){s(this,Ri).query&&await s(this,hn).call(this,e())}async error(e){s(this,Ri).error&&await s(this,hn).call(this,e())}}Ri=new WeakMap,hn=new WeakMap;function Jf(r){if(r.level==="query"){const e=`kysely:query:${r.isStream?"stream:":""}`;console.log(`${e} ${r.query.sql}`),console.log(`${e} duration: ${r.queryDurationMillis.toFixed(1)}ms`)}else r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:r.error,query:r.query.sql,queryDurationMillis:r.queryDurationMillis})}`))}function Gf(r){return Sr(r)&&tr(r.compile)}Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const cs=class cs extends xo{constructor(t){let o,p;if(Kf(t))o={executor:t.executor},p={...t};else{const L=t.dialect,C=L.createDriver(),ne=L.createQueryCompiler(),le=L.createAdapter(),$=new Hf(t.log??[]),fe=new jf(C,$),U=new Qf(fe),he=new ul(ne,le,U,t.plugins??[]);o={executor:he},p={config:t,executor:he,dialect:L,driver:fe}}super(o);z(this,Ct);J(this,Ct,d(p))}get schema(){return new cl(s(this,Ct).executor)}get dynamic(){return new Uf}get introspection(){return s(this,Ct).dialect.createIntrospector(this.withoutPlugins())}case(t){return new Uc({node:Mr.create(wi(t)?void 0:Vi(t))})}get fn(){return Mc()}transaction(){return new hl({...s(this,Ct)})}startTransaction(){return new pl({...s(this,Ct)})}connection(){return new Yf({...s(this,Ct)})}withPlugin(t){return new cs({...s(this,Ct),executor:s(this,Ct).executor.withPlugin(t)})}withoutPlugins(){return new cs({...s(this,Ct),executor:s(this,Ct).executor.withoutPlugins()})}withSchema(t){return new cs({...s(this,Ct),executor:s(this,Ct).executor.withPluginAtFront(new Cn(t))})}withTables(){return new cs({...s(this,Ct)})}async destroy(){await s(this,Ct).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,Ct).executor}executeQuery(t,o=ze()){const p=Gf(t)?t.compile():t;return this.getExecutor().executeQuery(p,o)}async[Symbol.asyncDispose](){await this.destroy()}};Ct=new WeakMap;let Ps=cs;const us=class us extends Ps{constructor(t){super(t);z(this,Pr);J(this,Pr,t)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(t){return new us({...s(this,Pr),executor:s(this,Pr).executor.withPlugin(t)})}withoutPlugins(){return new us({...s(this,Pr),executor:s(this,Pr).executor.withoutPlugins()})}withSchema(t){return new us({...s(this,Pr),executor:s(this,Pr).executor.withPluginAtFront(new Cn(t))})}withTables(){return new us({...s(this,Pr)})}};Pr=new WeakMap;let Ro=us;function Kf(r){return Sr(r)&&Sr(r.config)&&Sr(r.driver)&&Sr(r.executor)&&Sr(r.dialect)}class Yf{constructor(e){z(this,pn);J(this,pn,d(e))}async execute(e){return s(this,pn).executor.provideConnection(async t=>{const o=s(this,pn).executor.withConnectionProvider(new fl(t)),p=new Ps({...s(this,pn),executor:o});return await e(p)})}}pn=new WeakMap;const Yo=class Yo{constructor(e){z(this,br);J(this,br,d(e))}setAccessMode(e){return new Yo({...s(this,br),accessMode:e})}setIsolationLevel(e){return new Yo({...s(this,br),isolationLevel:e})}async execute(e){const{isolationLevel:t,accessMode:o,...p}=s(this,br),L={isolationLevel:t,accessMode:o};return su(L),s(this,br).executor.provideConnection(async C=>{const ne=s(this,br).executor.withConnectionProvider(new fl(C)),le=new Ro({...p,executor:ne});try{await s(this,br).driver.beginTransaction(C,L);const $=await e(le);return await s(this,br).driver.commitTransaction(C),$}catch($){throw await s(this,br).driver.rollbackTransaction(C),$}})}};br=new WeakMap;let hl=Yo;const Xo=class Xo{constructor(e){z(this,Jr);J(this,Jr,d(e))}setAccessMode(e){return new Xo({...s(this,Jr),accessMode:e})}setIsolationLevel(e){return new Xo({...s(this,Jr),isolationLevel:e})}async execute(){const{isolationLevel:e,accessMode:t,...o}=s(this,Jr),p={isolationLevel:e,accessMode:t};su(p);const L=await Fc(s(this,Jr).executor);return await s(this,Jr).driver.beginTransaction(L.connection,p),new _l({...o,connection:L,executor:s(this,Jr).executor.withConnectionProvider(new fl(L.connection))})}};Jr=new WeakMap;let pl=Xo;const pi=class pi extends Ro{constructor(t){const o={isCommitted:!1,isRolledBack:!1};t={...t,executor:new ml(t.executor,o)};const{connection:p,...L}=t;super(L);z(this,st);z(this,_n);z(this,hr);J(this,st,d(t)),J(this,hr,o);const C=ze();J(this,_n,ne=>t.executor.compileQuery(ne,C))}get isCommitted(){return s(this,hr).isCommitted}get isRolledBack(){return s(this,hr).isRolledBack}commit(){return Gi(s(this,hr)),new Fs(async()=>{await s(this,st).driver.commitTransaction(s(this,st).connection.connection),s(this,hr).isCommitted=!0,s(this,st).connection.release()})}rollback(){return Gi(s(this,hr)),new Fs(async()=>{await s(this,st).driver.rollbackTransaction(s(this,st).connection.connection),s(this,hr).isRolledBack=!0,s(this,st).connection.release()})}savepoint(t){return Gi(s(this,hr)),new Fs(async()=>{var o,p;return await((p=(o=s(this,st).driver).savepoint)==null?void 0:p.call(o,s(this,st).connection.connection,t,s(this,_n))),new pi({...s(this,st)})})}rollbackToSavepoint(t){return Gi(s(this,hr)),new Fs(async()=>{var o,p;return await((p=(o=s(this,st).driver).rollbackToSavepoint)==null?void 0:p.call(o,s(this,st).connection.connection,t,s(this,_n))),new pi({...s(this,st)})})}releaseSavepoint(t){return Gi(s(this,hr)),new Fs(async()=>{var o,p;return await((p=(o=s(this,st).driver).releaseSavepoint)==null?void 0:p.call(o,s(this,st).connection.connection,t,s(this,_n))),new pi({...s(this,st)})})}withPlugin(t){return new pi({...s(this,st),executor:s(this,st).executor.withPlugin(t)})}withoutPlugins(){return new pi({...s(this,st),executor:s(this,st).executor.withoutPlugins()})}withSchema(t){return new pi({...s(this,st),executor:s(this,st).executor.withPluginAtFront(new Cn(t))})}withTables(){return new pi({...s(this,st)})}};st=new WeakMap,_n=new WeakMap,hr=new WeakMap;let _l=pi;class Fs{constructor(e){z(this,eo);J(this,eo,e)}async execute(){return await s(this,eo).call(this)}}eo=new WeakMap;function Gi(r){if(r.isCommitted)throw new Error("Transaction is already committed");if(r.isRolledBack)throw new Error("Transaction is already rolled back")}const Bi=class Bi{constructor(e,t){z(this,Lt);z(this,Fr);e instanceof Bi?J(this,Lt,s(e,Lt)):J(this,Lt,e),J(this,Fr,t)}get adapter(){return s(this,Lt).adapter}get plugins(){return s(this,Lt).plugins}transformQuery(e,t){return s(this,Lt).transformQuery(e,t)}compileQuery(e,t){return s(this,Lt).compileQuery(e,t)}provideConnection(e){return s(this,Lt).provideConnection(e)}executeQuery(e,t){return Gi(s(this,Fr)),s(this,Lt).executeQuery(e,t)}stream(e,t,o){return Gi(s(this,Fr)),s(this,Lt).stream(e,t,o)}withConnectionProvider(e){return new Bi(s(this,Lt).withConnectionProvider(e),s(this,Fr))}withPlugin(e){return new Bi(s(this,Lt).withPlugin(e),s(this,Fr))}withPlugins(e){return new Bi(s(this,Lt).withPlugins(e),s(this,Fr))}withPluginAtFront(e){return new Bi(s(this,Lt).withPluginAtFront(e),s(this,Fr))}withoutPlugins(){return new Bi(s(this,Lt).withoutPlugins(),s(this,Fr))}};Lt=new WeakMap,Fr=new WeakMap;let ml=Bi;const to=class to{constructor(e){z(this,Nr);z(this,Ht);J(this,Ht,d(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Xf(this,e)}$castTo(){return new to({...s(this,Ht)})}$notNull(){return new to(s(this,Ht))}withPlugin(e){return new to({...s(this,Ht),plugins:s(this,Ht).plugins!==void 0?d([...s(this,Ht).plugins,e]):d([e])})}toOperationNode(){return be(this,Nr,Ml).call(this,be(this,Nr,la).call(this))}compile(e){return be(this,Nr,Ul).call(this,be(this,Nr,la).call(this,e))}async execute(e){const t=be(this,Nr,la).call(this,e);return t.executeQuery(be(this,Nr,Ul).call(this,t),s(this,Ht).queryId)}};Ht=new WeakMap,Nr=new WeakSet,la=function(e){const t=e!==void 0?e.getExecutor():vo;return s(this,Ht).plugins!==void 0?t.withPlugins(s(this,Ht).plugins):t},Ml=function(e){return e.transformQuery(s(this,Ht).rawNode,s(this,Ht).queryId)},Ul=function(e){return e.compileQuery(be(this,Nr,Ml).call(this,e),s(this,Ht).queryId)};let yl=to;function Si(r){return new yl(r)}class Xf{constructor(e,t){z(this,mn);z(this,Mi);J(this,mn,e),J(this,Mi,t)}get expression(){return s(this,mn)}get alias(){return s(this,Mi)}get rawBuilder(){return s(this,mn)}toOperationNode(){return ei.create(s(this,mn).toOperationNode(),jt(s(this,Mi))?s(this,Mi).toOperationNode():Xe.create(s(this,Mi)))}}mn=new WeakMap,Mi=new WeakMap;const ou=Object.assign((r,...e)=>Si({queryId:ze(),rawNode:kt.create(r,(e==null?void 0:e.map(au))??[])}),{ref(r){return Si({queryId:ze(),rawNode:kt.createWithChild(ni(r))})},val(r){return Si({queryId:ze(),rawNode:kt.createWithChild(xt(r))})},value(r){return this.val(r)},table(r){return Si({queryId:ze(),rawNode:kt.createWithChild(gt(r))})},id(...r){const e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",Si({queryId:ze(),rawNode:kt.create(e,r.map(Xe.create))})},lit(r){return Si({queryId:ze(),rawNode:kt.createWithChild(gr.createImmediate(r))})},literal(r){return this.lit(r)},raw(r){return Si({queryId:ze(),rawNode:kt.createWithSql(r)})},join(r,e=ou`, `){const t=new Array(Math.max(2*r.length-1,0)),o=e.toOperationNode();for(let p=0;p<r.length;++p)t[2*p]=au(r[p]),p!==r.length-1&&(t[2*p+1]=o);return Si({queryId:ze(),rawNode:kt.createWithChildren(t)})}});function au(r){return jt(r)?r.toOperationNode():xt(r)}class Zf{constructor(){Zt(this,"nodeStack",[]);z(this,Zo,d({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)}));Zt(this,"visitNode",e=>{this.nodeStack.push(e),s(this,Zo)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Zo=new WeakMap;const eh=/'/g;class th extends Zf{constructor(){super(...arguments);z(this,ds,"");z(this,yn,[])}get numParameters(){return s(this,yn).length}compileQuery(t,o){return J(this,ds,""),J(this,yn,[]),this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(t),d({query:t,queryId:o,sql:this.getSql(),parameters:[...s(this,yn)]})}getSql(){return s(this,ds)}visitSelectQuery(t){var p,L;const o=this.parentNode!==void 0&&!An.is(this.parentNode)&&!It.is(this.parentNode)&&!ir.is(this.parentNode)&&!Ei.is(this.parentNode)&&!Rc.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),o&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("select"),t.distinctOn&&(this.append(" "),this.compileDistinctOn(t.distinctOn)),(p=t.frontModifiers)!=null&&p.length&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.top&&(this.append(" "),this.visitNode(t.top)),t.selections&&(this.append(" "),this.compileList(t.selections)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.groupBy&&(this.append(" "),this.visitNode(t.groupBy)),t.having&&(this.append(" "),this.visitNode(t.having)),t.setOperations&&(this.append(" "),this.compileList(t.setOperations," ")),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.offset&&(this.append(" "),this.visitNode(t.offset)),t.fetch&&(this.append(" "),this.visitNode(t.fetch)),(L=t.endModifiers)!=null&&L.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...t.endModifiers])," ")),o&&this.append(")")}visitFrom(t){this.append("from "),this.compileList(t.froms)}visitSelection(t){this.visitNode(t.selection)}visitColumn(t){this.visitNode(t.column)}compileDistinctOn(t){this.append("distinct on ("),this.compileList(t),this.append(")")}compileList(t,o=", "){const p=t.length-1;for(let L=0;L<=p;L++)this.visitNode(t[L]),L<p&&this.append(o)}visitWhere(t){this.append("where "),this.visitNode(t.where)}visitHaving(t){this.append("having "),this.visitNode(t.having)}visitInsertQuery(t){var L;const o=this.nodeStack.find(ye.is),p=o!==t;!p&&t.explain&&(this.visitNode(t.explain),this.append(" ")),p&&!Kt.is(o)&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append(t.replace?"replace":"insert"),t.ignore&&(bs("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),t.orAction&&(this.append(" "),this.visitNode(t.orAction)),t.top&&(this.append(" "),this.visitNode(t.top)),t.into&&(this.append(" into "),this.visitNode(t.into)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.output&&(this.append(" "),this.visitNode(t.output)),t.values&&(this.append(" "),this.visitNode(t.values)),t.defaultValues&&(this.append(" "),this.append("default values")),t.onConflict&&(this.append(" "),this.visitNode(t.onConflict)),t.onDuplicateKey&&(this.append(" "),this.visitNode(t.onDuplicateKey)),t.returning&&(this.append(" "),this.visitNode(t.returning)),p&&!Kt.is(o)&&this.append(")"),(L=t.endModifiers)!=null&&L.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitValues(t){this.append("values "),this.compileList(t.values)}visitDeleteQuery(t){var p;const o=this.nodeStack.find(ye.is)!==t;!o&&t.explain&&(this.visitNode(t.explain),this.append(" ")),o&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("delete "),t.top&&(this.visitNode(t.top),this.append(" ")),this.visitNode(t.from),t.output&&(this.append(" "),this.visitNode(t.output)),t.using&&(this.append(" "),this.visitNode(t.using)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),o&&this.append(")"),(p=t.endModifiers)!=null&&p.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitReturning(t){this.append("returning "),this.compileList(t.selections)}visitAlias(t){this.visitNode(t.node),this.append(" as "),this.visitNode(t.alias)}visitReference(t){t.table&&(this.visitNode(t.table),this.append(".")),this.visitNode(t.column)}visitSelectAll(t){this.append("*")}visitIdentifier(t){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(t),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(t){if(!Qt(t.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(t.name))}visitAnd(t){this.visitNode(t.left),this.append(" and "),this.visitNode(t.right)}visitOr(t){this.visitNode(t.left),this.append(" or "),this.visitNode(t.right)}visitValue(t){t.immediate?this.appendImmediateValue(t.value):this.appendValue(t.value)}visitValueList(t){this.append("("),this.compileList(t.values),this.append(")")}visitTuple(t){this.append("("),this.compileList(t.values),this.append(")")}visitPrimitiveValueList(t){this.append("(");const{values:o}=t;for(let p=0;p<o.length;++p)this.appendValue(o[p]),p!==o.length-1&&this.append(", ");this.append(")")}visitParens(t){this.append("("),this.visitNode(t.node),this.append(")")}visitJoin(t){this.append(ih[t.joinType]),this.append(" "),this.visitNode(t.table),t.on&&(this.append(" "),this.visitNode(t.on))}visitOn(t){this.append("on "),this.visitNode(t.on)}visitRaw(t){const{sqlFragments:o,parameters:p}=t;for(let L=0;L<o.length;++L)this.append(o[L]),p.length>L&&this.visitNode(p[L])}visitOperator(t){this.append(t.operator)}visitTable(t){this.visitNode(t.table)}visitSchemableIdentifier(t){t.schema&&(this.visitNode(t.schema),this.append(".")),this.visitNode(t.identifier)}visitCreateTable(t){this.append("create "),t.frontModifiers&&t.frontModifiers.length>0&&(this.compileList(t.frontModifiers," "),this.append(" ")),t.temporary&&this.append("temporary "),this.append("table "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.table),t.selectQuery?(this.append(" as "),this.visitNode(t.selectQuery)):(this.append(" ("),this.compileList([...t.columns,...t.constraints??[]]),this.append(")"),t.onCommit&&(this.append(" on commit "),this.append(t.onCommit)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," ")))}visitColumnDefinition(t){t.ifNotExists&&this.append("if not exists "),this.visitNode(t.column),this.append(" "),this.visitNode(t.dataType),t.unsigned&&this.append(" unsigned"),t.frontModifiers&&t.frontModifiers.length>0&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.generated&&(this.append(" "),this.visitNode(t.generated)),t.identity&&this.append(" identity"),t.defaultTo&&(this.append(" "),this.visitNode(t.defaultTo)),t.notNull&&this.append(" not null"),t.unique&&this.append(" unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.primaryKey&&this.append(" primary key"),t.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),t.references&&(this.append(" "),this.visitNode(t.references)),t.check&&(this.append(" "),this.visitNode(t.check)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(t){this.append("references "),this.visitNode(t.table),this.append(" ("),this.compileList(t.columns),this.append(")"),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitDropTable(t){this.append("drop table "),t.ifExists&&this.append("if exists "),this.visitNode(t.table),t.cascade&&this.append(" cascade")}visitDataType(t){this.append(t.dataType)}visitOrderBy(t){this.append("order by "),this.compileList(t.items)}visitOrderByItem(t){this.visitNode(t.orderBy),t.collation&&(this.append(" "),this.visitNode(t.collation)),t.direction&&(this.append(" "),this.visitNode(t.direction)),t.nulls&&(this.append(" nulls "),this.append(t.nulls))}visitGroupBy(t){this.append("group by "),this.compileList(t.items)}visitGroupByItem(t){this.visitNode(t.groupBy)}visitUpdateQuery(t){var L;const o=this.nodeStack.find(ye.is),p=o!==t;if(!p&&t.explain&&(this.visitNode(t.explain),this.append(" ")),p&&!Kt.is(o)&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("update "),t.top&&(this.visitNode(t.top),this.append(" ")),t.table&&(this.visitNode(t.table),this.append(" ")),this.append("set "),t.updates&&this.compileList(t.updates),t.output&&(this.append(" "),this.visitNode(t.output)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins){if(!t.from)throw new Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(t.joins," ")}t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),p&&!Kt.is(o)&&this.append(")"),(L=t.endModifiers)!=null&&L.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitColumnUpdate(t){this.visitNode(t.column),this.append(" = "),this.visitNode(t.value)}visitLimit(t){this.append("limit "),this.visitNode(t.limit)}visitOffset(t){this.append("offset "),this.visitNode(t.offset)}visitOnConflict(t){this.append("on conflict"),t.columns?(this.append(" ("),this.compileList(t.columns),this.append(")")):t.constraint?(this.append(" on constraint "),this.visitNode(t.constraint)):t.indexExpression&&(this.append(" ("),this.visitNode(t.indexExpression),this.append(")")),t.indexWhere&&(this.append(" "),this.visitNode(t.indexWhere)),t.doNothing===!0?this.append(" do nothing"):t.updates&&(this.append(" do update set "),this.compileList(t.updates),t.updateWhere&&(this.append(" "),this.visitNode(t.updateWhere)))}visitOnDuplicateKey(t){this.append("on duplicate key update "),this.compileList(t.updates)}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.using&&(this.append(" using "),this.visitNode(t.using)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.where&&(this.append(" "),this.visitNode(t.where))}visitDropIndex(t){this.append("drop index "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.cascade&&this.append(" cascade")}visitCreateSchema(t){this.append("create schema "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.schema)}visitDropSchema(t){this.append("drop schema "),t.ifExists&&this.append("if exists "),this.visitNode(t.schema),t.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("primary key ("),this.compileList(t.columns),this.append(")"),this.buildDeferrable(t)}buildDeferrable(t){t.deferrable!==void 0&&(t.deferrable?this.append(" deferrable"):this.append(" not deferrable")),t.initiallyDeferred!==void 0&&(t.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(t.columns),this.append(")"),this.buildDeferrable(t)}visitCheckConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("check ("),this.visitNode(t.expression),this.append(")")}visitForeignKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("foreign key ("),this.compileList(t.columns),this.append(") "),this.visitNode(t.references),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate)),this.buildDeferrable(t)}visitList(t){this.compileList(t.items)}visitWith(t){this.append("with "),t.recursive&&this.append("recursive "),this.compileList(t.expressions)}visitCommonTableExpression(t){this.visitNode(t.name),this.append(" as "),uo(t.materialized)&&(t.materialized||this.append("not "),this.append("materialized ")),this.visitNode(t.expression)}visitCommonTableExpressionName(t){this.visitNode(t.table),t.columns&&(this.append("("),this.compileList(t.columns),this.append(")"))}visitAlterTable(t){this.append("alter table "),this.visitNode(t.table),this.append(" "),t.renameTo&&(this.append("rename to "),this.visitNode(t.renameTo)),t.setSchema&&(this.append("set schema "),this.visitNode(t.setSchema)),t.addConstraint&&this.visitNode(t.addConstraint),t.dropConstraint&&this.visitNode(t.dropConstraint),t.renameConstraint&&this.visitNode(t.renameConstraint),t.columnAlterations&&this.compileColumnAlterations(t.columnAlterations),t.addIndex&&this.visitNode(t.addIndex),t.dropIndex&&this.visitNode(t.dropIndex)}visitAddColumn(t){this.append("add column "),this.visitNode(t.column)}visitRenameColumn(t){this.append("rename column "),this.visitNode(t.column),this.append(" to "),this.visitNode(t.renameTo)}visitDropColumn(t){this.append("drop column "),this.visitNode(t.column)}visitAlterColumn(t){this.append("alter column "),this.visitNode(t.column),this.append(" "),t.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(t.dataType),t.dataTypeExpression&&(this.append("using "),this.visitNode(t.dataTypeExpression))),t.setDefault&&(this.append("set default "),this.visitNode(t.setDefault)),t.dropDefault&&this.append("drop default"),t.setNotNull&&this.append("set not null"),t.dropNotNull&&this.append("drop not null")}visitModifyColumn(t){this.append("modify column "),this.visitNode(t.column)}visitAddConstraint(t){this.append("add "),this.visitNode(t.constraint)}visitDropConstraint(t){this.append("drop constraint "),t.ifExists&&this.append("if exists "),this.visitNode(t.constraintName),t.modifier==="cascade"?this.append(" cascade"):t.modifier==="restrict"&&this.append(" restrict")}visitRenameConstraint(t){this.append("rename constraint "),this.visitNode(t.oldName),this.append(" to "),this.visitNode(t.newName)}visitSetOperation(t){this.append(t.operator),this.append(" "),t.all&&this.append("all "),this.visitNode(t.expression)}visitCreateView(t){this.append("create "),t.orReplace&&this.append("or replace "),t.materialized&&this.append("materialized "),t.temporary&&this.append("temporary "),this.append("view "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),this.append(" "),t.columns&&(this.append("("),this.compileList(t.columns),this.append(") ")),t.as&&(this.append("as "),this.visitNode(t.as))}visitRefreshMaterializedView(t){this.append("refresh materialized view "),t.concurrently&&this.append("concurrently "),this.visitNode(t.name),t.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(t){this.append("drop "),t.materialized&&this.append("materialized "),this.append("view "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.cascade&&this.append(" cascade")}visitGenerated(t){this.append("generated "),t.always&&this.append("always "),t.byDefault&&this.append("by default "),this.append("as "),t.identity&&this.append("identity"),t.expression&&(this.append("("),this.visitNode(t.expression),this.append(")")),t.stored&&this.append(" stored")}visitDefaultValue(t){this.append("default "),this.visitNode(t.defaultValue)}visitSelectModifier(t){t.rawModifier?this.visitNode(t.rawModifier):this.append(rh[t.modifier]),t.of&&(this.append(" of "),this.compileList(t.of,", "))}visitCreateType(t){this.append("create type "),this.visitNode(t.name),t.enum&&(this.append(" as enum "),this.visitNode(t.enum))}visitDropType(t){this.append("drop type "),t.ifExists&&this.append("if exists "),this.visitNode(t.name)}visitExplain(t){this.append("explain"),(t.options||t.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),t.options&&(this.visitNode(t.options),t.format&&this.append(this.getExplainOptionsDelimiter())),t.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(t.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(t){this.append("default")}visitAggregateFunction(t){this.append(t.func),this.append("("),t.distinct&&this.append("distinct "),this.compileList(t.aggregated),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),this.append(")"),t.withinGroup&&(this.append(" within group ("),this.visitNode(t.withinGroup),this.append(")")),t.filter&&(this.append(" filter("),this.visitNode(t.filter),this.append(")")),t.over&&(this.append(" "),this.visitNode(t.over))}visitOver(t){this.append("over("),t.partitionBy&&(this.visitNode(t.partitionBy),t.orderBy&&this.append(" ")),t.orderBy&&this.visitNode(t.orderBy),this.append(")")}visitPartitionBy(t){this.append("partition by "),this.compileList(t.items)}visitPartitionByItem(t){this.visitNode(t.partitionBy)}visitBinaryOperation(t){this.visitNode(t.leftOperand),this.append(" "),this.visitNode(t.operator),this.append(" "),this.visitNode(t.rightOperand)}visitUnaryOperation(t){this.visitNode(t.operator),this.isMinusOperator(t.operator)||this.append(" "),this.visitNode(t.operand)}isMinusOperator(t){return Ni.is(t)&&t.operator==="-"}visitUsing(t){this.append("using "),this.compileList(t.tables)}visitFunction(t){this.append(t.func),this.append("("),this.compileList(t.arguments),this.append(")")}visitCase(t){this.append("case"),t.value&&(this.append(" "),this.visitNode(t.value)),t.when&&(this.append(" "),this.compileList(t.when," ")),t.else&&(this.append(" else "),this.visitNode(t.else)),this.append(" end"),t.isStatement&&this.append(" case")}visitWhen(t){this.append("when "),this.visitNode(t.condition),t.result&&(this.append(" then "),this.visitNode(t.result))}visitJSONReference(t){this.visitNode(t.reference),this.visitNode(t.traversal)}visitJSONPath(t){t.inOperator&&this.visitNode(t.inOperator),this.append("'$");for(const o of t.pathLegs)this.visitNode(o);this.append("'")}visitJSONPathLeg(t){const o=t.type==="ArrayLocation";this.append(o?"[":"."),this.append(String(t.value)),o&&this.append("]")}visitJSONOperatorChain(t){for(let o=0,p=t.values.length;o<p;o++)o===p-1?this.visitNode(t.operator):this.append("->"),this.visitNode(t.values[o])}visitMergeQuery(t){var o;t.with&&(this.visitNode(t.with),this.append(" ")),this.append("merge "),t.top&&(this.visitNode(t.top),this.append(" ")),this.append("into "),this.visitNode(t.into),t.using&&(this.append(" "),this.visitNode(t.using)),t.whens&&(this.append(" "),this.compileList(t.whens," ")),t.returning&&(this.append(" "),this.visitNode(t.returning)),t.output&&(this.append(" "),this.visitNode(t.output)),(o=t.endModifiers)!=null&&o.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitMatched(t){t.not&&this.append("not "),this.append("matched"),t.bySource&&this.append(" by source")}visitAddIndex(t){this.append("add "),t.unique&&this.append("unique "),this.append("index "),this.visitNode(t.name),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.using&&(this.append(" using "),this.visitNode(t.using))}visitCast(t){this.append("cast("),this.visitNode(t.expression),this.append(" as "),this.visitNode(t.dataType),this.append(")")}visitFetch(t){this.append("fetch next "),this.visitNode(t.rowCount),this.append(` rows ${t.modifier}`)}visitOutput(t){this.append("output "),this.compileList(t.selections)}visitTop(t){this.append(`top(${t.expression})`),t.modifiers&&this.append(` ${t.modifiers}`)}visitOrAction(t){this.append(t.action)}visitCollate(t){this.append("collate "),this.visitNode(t.collation)}append(t){J(this,ds,s(this,ds)+t)}appendValue(t){this.addParameter(t),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(t){const o=this.getLeftIdentifierWrapper(),p=this.getRightIdentifierWrapper();let L="";for(const C of t)L+=C,C===o?L+=o:C===p&&(L+=p);return L}sanitizeStringLiteral(t){return t.replace(eh,"''")}addParameter(t){s(this,yn).push(t)}appendImmediateValue(t){if(Qt(t))this.appendStringLiteral(t);else if(co(t)||uo(t))this.append(t.toString());else if(wa(t))this.append("null");else if(_d(t))this.appendImmediateValue(t.toISOString());else if(ba(t))this.appendImmediateValue(t.toString());else throw new Error(`invalid immediate value ${t}`)}appendStringLiteral(t){this.append("'"),this.append(this.sanitizeStringLiteral(t)),this.append("'")}sortSelectModifiers(t){return t.sort((o,p)=>o.modifier&&p.modifier?lu[o.modifier]-lu[p.modifier]:1),d(t)}compileColumnAlterations(t){this.compileList(t)}announcesNewColumnDataType(){return!0}}ds=new WeakMap,yn=new WeakMap;const rh=d({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),lu=d({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),ih=d({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"});class nh{async init(){}async acquireConnection(){return new sh}async beginTransaction(){}async commitTransaction(){}async rollbackTransaction(){}async releaseConnection(){}async destroy(){}async releaseSavepoint(){}async rollbackToSavepoint(){}async savepoint(){}}class sh{async executeQuery(){return{rows:[]}}async*streamQuery(){}}class oh{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}const ah=/"/g;class lh extends th{visitOrAction(e){this.append("or "),this.append(e.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ah,'""')}visitDefaultInsertValue(e){this.append("null")}}const ch="kysely_migration",uh="kysely_migration_lock";d({__noMigrations__:!0});class dh{constructor(e){z(this,gn);z(this,fs);J(this,fs,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await be(this,gn,Iu).call(this,e)}async getMetadata(e){return{tables:await this.getTables(e)}}}fs=new WeakMap,gn=new WeakSet,Ql=function(e,t){let o=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return t.withInternalKyselyTables||(o=o.where("name","!=",ch).where("name","!=",uh)),o},Iu=async function(e){var L;const t=await be(this,gn,Ql).call(this,s(this,fs),e).execute(),o=await s(this,fs).with("table_list",C=>be(this,gn,Ql).call(this,C,e)).selectFrom(["table_list as tl",ou`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),p={};for(const C of o)p[L=C.table]??(p[L]=[]),p[C.table].push(C);return t.map(({name:C,sql:ne,type:le})=>{var U,he,qe,Be,Me;let $=(Me=(Be=(qe=(he=(U=ne==null?void 0:ne.split(/[\(\),]/))==null?void 0:U.find(Oe=>Oe.toLowerCase().includes("autoincrement")))==null?void 0:he.trimStart())==null?void 0:qe.split(/\s+/))==null?void 0:Be[0])==null?void 0:Me.replace(/["`]/g,"");const fe=p[C]??[];if(!$){const Oe=fe.filter(yt=>yt.pk>0);Oe.length===1&&Oe[0].type.toLowerCase()==="integer"&&($=Oe[0].name)}return{name:C,isView:le==="view",columns:fe.map(Oe=>({name:Oe.name,dataType:Oe.type,isNullable:!Oe.notnull,isAutoIncrementing:Oe.name===$,hasDefaultValue:Oe.dflt_value!=null,comment:void 0}))}})};class fh extends oh{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}function hh(r){return r.split("/").pop()}function ph(r){if(typeof r!="object")throw new Error(`migrations.preprocess: That's not an object: ${typeof r}`);if(!("id"in r&&"resourceType"in r))throw new Error(`migrations.preprocess: I don't know how to preprocess that: (has_id=${"id"in r}, has_resourceType=${"resourceType"in r})`);return r}function _h(r,e,t,o,p=L=>!L.startsWith("_")&&L!=="id"){const L=t.schema.createTable(r).ifNotExists().addColumn("id","text",le=>le.primaryKey()),C=new Array;return C.push({name:"id",dataType:"text",fhirType:"string"}),{sql:e.reduce((le,[$,fe])=>{if(typeof fe=="boolean")throw new Error;if(!p($))return le;let U="text",he="string";return fe.$ref&&(he=hh(fe.$ref),U=o[he]??"text"),C.push({name:$,dataType:U,fhirType:he}),le.addColumn($,U)},L).compile().sql+`;
`,columnKeys:C}}function mh(r,e,t,o){const p=e.definitions;if(!p)throw new Error("Bad json schema");o||(o=Object.keys(e.discriminator.mapping));const L=new Map;return{migrations:o.map(le=>{const $=p[le];if(!$||!$.properties)throw new Error(`That resource key doesn't exist: "${le}"`);const fe=$.properties,U=_h(le,Object.entries(fe),r,t);return L.set(le,U.columnKeys),[le,U.sql]}),index:(le,$)=>(ph(le),L.has(le.resourceType)?L.get(le.resourceType).map(he=>{let qe=le[he.name];if(qe&&typeof qe=="object")switch(he.fhirType){case"Reference":{qe=qe.reference??null;break}default:qe=JSON.stringify(qe)}return{value:qe??null,dataType:he.dataType}})[$]:{value:null,dataType:"text"})}}async function yh(r,e,t){return dd().then(o=>mh(r,o,e,t))}const gh={boolean:"integer",base64Binary:"blob",canonical:"text",code:"text",id:"text",oid:"text",string:"text",url:"text",uri:"text",uuid:"text",date:"text",dateTime:"text",instant:"text",time:"text",decimal:"real",integer:"integer",positiveInt:"integer",unsignedInt:"integer"};function wh(r){return new Worker("/docs/assets/sqlite-wasm.block-AGk3dtiM.js",{name:r==null?void 0:r.name})}const bh=new Ps({dialect:{createAdapter:()=>new fh,createDriver:()=>new nh,createIntrospector:r=>new dh(r),createQueryCompiler:()=>new lh}}),Bo="medfetch/sqlite-wasm",gl=r=>`[${Bo}] > ${r}`,Nh=new wh({name:"sqlite-wasm.block"});Bu().then(async r=>{await pd(Nh);const e=new Mu,t=[],o=new Set;Ru(r,async(p,L)=>{var C,ne,le;if(((C=p.data)==null?void 0:C.type)==="open"){const $=(ne=p.data.aux)==null?void 0:ne.baseURL,fe=((le=p.data.aux)==null?void 0:le.scope)??null;if(!$)throw new Error(gl("Need a base URL to open a medfetch database, but got nothing."));const U=await yh(bh,gh,fe);if(typeof $!="string"&&!($ instanceof File))throw new Error(gl(`Can't handle that baseURL ${$}`));const he=Be=>{const Me=tc(`${$}/${Be}`),Oe=function*(){yield Me};return new ga(Oe(),yt=>function*(){yield tc(yt)}())};console.log(gl(`Received init message with baseURL: ${$}`));const qe=e.set();t[qe]=ct(he,r,U)}if(p.data.type==="exec"){if(!p.data.dbId)throw new Error(`[${Bo}] > Can't query database with an undefined "dbId"`);const $=t[qh(p.data.dbId)],fe=vh(p.data.dbId);if(!o.has(fe)){if(!$)throw new Error(`[${Bo}] > `);for(const[U,he]of Object.entries($))r.capi.sqlite3_create_module(fe,U,he.pointer,0);o.add(fe)}}L()}),console.log(`[${Bo}] > sqlite-wasm binary loaded and medfetch ready.`)});function qh(r){return parseInt(r.split("#")[1][0])-1}function vh(r){const e=r.split("@");return parseInt(e[e.length-1])}})();
